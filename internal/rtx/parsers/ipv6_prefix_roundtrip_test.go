// Code generated by specgen. DO NOT EDIT.
// Source: specs/ipv6/prefix.yaml
// This file tests RTX <-> Terraform round-trip conversions using actual parsers

package parsers

import (
	"testing"
)

// TestIPv6PrefixRoundTrip_Parse tests RTX command -> Terraform value conversion
func TestIPv6PrefixRoundTrip_Parse(t *testing.T) {
	parser := NewIPv6PrefixParser()

	testCases := []struct {
		name      string
		rtx       string
		checkFunc func(t *testing.T, prefixes []IPv6Prefix)
	}{
		{
			name: "static_prefix",
			rtx:  "ipv6 prefix 1 2001:db8::/64",
			checkFunc: func(t *testing.T, prefixes []IPv6Prefix) {
				if len(prefixes) != 1 {
					t.Errorf("Prefixes count = %v, want 1", len(prefixes))
					return
				}
				if prefixes[0].ID != 1 {
					t.Errorf("ID = %v, want 1", prefixes[0].ID)
				}
				if prefixes[0].Source != "static" {
					t.Errorf("Source = %v, want static", prefixes[0].Source)
				}
				if prefixes[0].PrefixLength != 64 {
					t.Errorf("PrefixLength = %v, want 64", prefixes[0].PrefixLength)
				}
			},
		},
		{
			name: "ra_prefix",
			rtx:  "ipv6 prefix 2 ra-prefix@lan1::/64",
			checkFunc: func(t *testing.T, prefixes []IPv6Prefix) {
				if len(prefixes) != 1 {
					t.Errorf("Prefixes count = %v, want 1", len(prefixes))
					return
				}
				if prefixes[0].ID != 2 {
					t.Errorf("ID = %v, want 2", prefixes[0].ID)
				}
				if prefixes[0].Source != "ra" {
					t.Errorf("Source = %v, want ra", prefixes[0].Source)
				}
				if prefixes[0].Interface != "lan1" {
					t.Errorf("Interface = %v, want lan1", prefixes[0].Interface)
				}
				if prefixes[0].PrefixLength != 64 {
					t.Errorf("PrefixLength = %v, want 64", prefixes[0].PrefixLength)
				}
			},
		},
		{
			name: "dhcpv6_pd_prefix",
			rtx:  "ipv6 prefix 3 dhcp-prefix@lan2::/48",
			checkFunc: func(t *testing.T, prefixes []IPv6Prefix) {
				if len(prefixes) != 1 {
					t.Errorf("Prefixes count = %v, want 1", len(prefixes))
					return
				}
				if prefixes[0].ID != 3 {
					t.Errorf("ID = %v, want 3", prefixes[0].ID)
				}
				if prefixes[0].Source != "dhcpv6-pd" {
					t.Errorf("Source = %v, want dhcpv6-pd", prefixes[0].Source)
				}
				if prefixes[0].Interface != "lan2" {
					t.Errorf("Interface = %v, want lan2", prefixes[0].Interface)
				}
				if prefixes[0].PrefixLength != 48 {
					t.Errorf("PrefixLength = %v, want 48", prefixes[0].PrefixLength)
				}
			},
		},
		{
			name: "multiple_prefixes",
			rtx: `ipv6 prefix 1 2001:db8::/64
ipv6 prefix 2 ra-prefix@lan1::/64`,
			checkFunc: func(t *testing.T, prefixes []IPv6Prefix) {
				if len(prefixes) != 2 {
					t.Errorf("Prefixes count = %v, want 2", len(prefixes))
				}
			},
		},
		{
			name: "empty_config",
			rtx:  "",
			checkFunc: func(t *testing.T, prefixes []IPv6Prefix) {
				if len(prefixes) != 0 {
					t.Errorf("Prefixes count = %v, want 0", len(prefixes))
				}
			},
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			prefixes, err := parser.ParseIPv6PrefixConfig(tc.rtx)
			if err != nil {
				t.Fatalf("ParseIPv6PrefixConfig(%q) error = %v", tc.rtx, err)
			}
			tc.checkFunc(t, prefixes)
		})
	}
}

// TestIPv6PrefixRoundTrip_Build tests Terraform value -> RTX command conversion
func TestIPv6PrefixRoundTrip_Build(t *testing.T) {
	testCases := []struct {
		name        string
		buildFunc   func() string
		expectedRTX string
	}{
		{
			name: "static_prefix",
			buildFunc: func() string {
				return BuildIPv6PrefixCommand(IPv6Prefix{
					ID:           1,
					Prefix:       "2001:db8::",
					PrefixLength: 64,
					Source:       "static",
				})
			},
			expectedRTX: "ipv6 prefix 1 2001:db8::/64",
		},
		{
			name: "ra_prefix",
			buildFunc: func() string {
				return BuildIPv6PrefixCommand(IPv6Prefix{
					ID:           2,
					PrefixLength: 64,
					Source:       "ra",
					Interface:    "lan1",
				})
			},
			expectedRTX: "ipv6 prefix 2 ra-prefix@lan1::/64",
		},
		{
			name: "dhcpv6_pd_prefix",
			buildFunc: func() string {
				return BuildIPv6PrefixCommand(IPv6Prefix{
					ID:           3,
					PrefixLength: 48,
					Source:       "dhcpv6-pd",
					Interface:    "lan2",
				})
			},
			expectedRTX: "ipv6 prefix 3 dhcp-prefix@lan2::/48",
		},
		{
			name: "delete_prefix",
			buildFunc: func() string {
				return BuildDeleteIPv6PrefixCommand(1)
			},
			expectedRTX: "no ipv6 prefix 1",
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			got := tc.buildFunc()
			if got != tc.expectedRTX {
				t.Errorf("Build() = %q, want %q", got, tc.expectedRTX)
			}
		})
	}
}

// TestIPv6PrefixRoundTrip_ParseBuildParse tests full round-trip
func TestIPv6PrefixRoundTrip_ParseBuildParse(t *testing.T) {
	parser := NewIPv6PrefixParser()

	testCases := []struct {
		name   string
		prefix IPv6Prefix
	}{
		{
			name: "static_prefix",
			prefix: IPv6Prefix{
				ID:           1,
				Prefix:       "2001:db8::",
				PrefixLength: 64,
				Source:       "static",
			},
		},
		{
			name: "ra_prefix",
			prefix: IPv6Prefix{
				ID:           2,
				PrefixLength: 64,
				Source:       "ra",
				Interface:    "lan1",
			},
		},
		{
			name: "dhcpv6_pd_prefix",
			prefix: IPv6Prefix{
				ID:           3,
				PrefixLength: 48,
				Source:       "dhcpv6-pd",
				Interface:    "lan2",
			},
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			// Build command
			rtx := BuildIPv6PrefixCommand(tc.prefix)

			// Parse command
			prefixes, err := parser.ParseIPv6PrefixConfig(rtx)
			if err != nil {
				t.Fatalf("ParseIPv6PrefixConfig error: %v", err)
			}

			if len(prefixes) != 1 {
				t.Fatalf("Expected 1 prefix, got %d", len(prefixes))
			}

			// Verify parsed values match original
			if prefixes[0].ID != tc.prefix.ID {
				t.Errorf("ID = %d, want %d", prefixes[0].ID, tc.prefix.ID)
			}
			if prefixes[0].Source != tc.prefix.Source {
				t.Errorf("Source = %q, want %q", prefixes[0].Source, tc.prefix.Source)
			}
			if prefixes[0].PrefixLength != tc.prefix.PrefixLength {
				t.Errorf("PrefixLength = %d, want %d", prefixes[0].PrefixLength, tc.prefix.PrefixLength)
			}

			// Rebuild command
			rebuilt := BuildIPv6PrefixCommand(prefixes[0])

			// Verify
			if rebuilt != rtx {
				t.Errorf("Round-trip failed:\n  Original: %q\n  Rebuilt:  %q", rtx, rebuilt)
			}
		})
	}
}

// TestIPv6PrefixRoundTrip_Validation tests validation functions
func TestIPv6PrefixRoundTrip_Validation(t *testing.T) {
	testCases := []struct {
		name      string
		prefix    IPv6Prefix
		wantError bool
	}{
		{
			name: "valid_static",
			prefix: IPv6Prefix{
				ID:           1,
				Prefix:       "2001:db8::",
				PrefixLength: 64,
				Source:       "static",
			},
			wantError: false,
		},
		{
			name: "valid_ra",
			prefix: IPv6Prefix{
				ID:           2,
				PrefixLength: 64,
				Source:       "ra",
				Interface:    "lan1",
			},
			wantError: false,
		},
		{
			name: "valid_dhcpv6_pd",
			prefix: IPv6Prefix{
				ID:           3,
				PrefixLength: 48,
				Source:       "dhcpv6-pd",
				Interface:    "lan2",
			},
			wantError: false,
		},
		{
			name: "invalid_id_zero",
			prefix: IPv6Prefix{
				ID:           0,
				Prefix:       "2001:db8::",
				PrefixLength: 64,
				Source:       "static",
			},
			wantError: true,
		},
		{
			name: "invalid_id_too_high",
			prefix: IPv6Prefix{
				ID:           256,
				Prefix:       "2001:db8::",
				PrefixLength: 64,
				Source:       "static",
			},
			wantError: true,
		},
		{
			name: "invalid_prefix_length_zero",
			prefix: IPv6Prefix{
				ID:           1,
				Prefix:       "2001:db8::",
				PrefixLength: 0,
				Source:       "static",
			},
			wantError: true,
		},
		{
			name: "invalid_prefix_length_too_high",
			prefix: IPv6Prefix{
				ID:           1,
				Prefix:       "2001:db8::",
				PrefixLength: 129,
				Source:       "static",
			},
			wantError: true,
		},
		{
			name: "invalid_source",
			prefix: IPv6Prefix{
				ID:           1,
				Prefix:       "2001:db8::",
				PrefixLength: 64,
				Source:       "invalid",
			},
			wantError: true,
		},
		{
			name: "static_missing_prefix",
			prefix: IPv6Prefix{
				ID:           1,
				Prefix:       "",
				PrefixLength: 64,
				Source:       "static",
			},
			wantError: true,
		},
		{
			name: "ra_missing_interface",
			prefix: IPv6Prefix{
				ID:           1,
				PrefixLength: 64,
				Source:       "ra",
				Interface:    "",
			},
			wantError: true,
		},
		{
			name: "dhcpv6_pd_missing_interface",
			prefix: IPv6Prefix{
				ID:           1,
				PrefixLength: 48,
				Source:       "dhcpv6-pd",
				Interface:    "",
			},
			wantError: true,
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			err := ValidateIPv6Prefix(tc.prefix)
			if (err != nil) != tc.wantError {
				t.Errorf("ValidateIPv6Prefix() error = %v, wantError %v", err, tc.wantError)
			}
		})
	}
}
