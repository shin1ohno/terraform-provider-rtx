// Code generated by specgen. DO NOT EDIT.
// Source: specs/dhcp/scope.yaml
// Command: dhcp_scope
// Reference: 12.1.4

package parsers

import (
	"reflect"
	"testing"
)

// TestSpecDhcpScopeParse tests parsing of dhcp_scope commands from spec
func TestSpecDhcpScopeParse(t *testing.T) {
	parser := NewDHCPScopeParser()

	tests := []struct {
		name     string
		input    string
		expected []DHCPScope
		skip     string // reason to skip, empty if not skipped
	}{
		{
			name:  "basic_scope_cidr24",
			input: `dhcp scope 1 192.168.1.0/24`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "basic_scope_cidr16",
			input: `dhcp scope 2 192.168.0.0/16`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       2,
					Network:       "192.168.0.0/16",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "basic_scope_cidr8",
			input: `dhcp scope 3 10.0.0.0/8`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       3,
					Network:       "10.0.0.0/8",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_ip_range_format",
			input: `dhcp scope 1 192.168.1.20-192.168.1.99/24`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					RangeStart:    "192.168.1.20",
					RangeEnd:      "192.168.1.99",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_ip_range_format_16",
			input: `dhcp scope 1 192.168.1.20-192.168.1.99/16`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.0.0/16",
					RangeStart:    "192.168.1.20",
					RangeEnd:      "192.168.1.99",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_with_gateway_legacy",
			input: `dhcp scope 1 192.168.1.0/24 gateway 192.168.1.1`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					ExcludeRanges: []ExcludeRange{},
					Options:       DHCPScopeOptions{Routers: []string{"192.168.1.1"}},
				},
			},
		},
		{
			name:  "scope_ip_range_with_gateway",
			input: `dhcp scope 1 192.168.1.20-192.168.1.99/16 gateway 192.168.1.253`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.0.0/16",
					RangeStart:    "192.168.1.20",
					RangeEnd:      "192.168.1.99",
					ExcludeRanges: []ExcludeRange{},
					Options:       DHCPScopeOptions{Routers: []string{"192.168.1.253"}},
				},
			},
		},
		{
			name:  "scope_with_expire_hours_minutes",
			input: `dhcp scope 1 192.168.1.0/24 expire 24:00`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					LeaseTime:     "24h",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_with_expire_72h",
			input: `dhcp scope 1 192.168.1.0/24 expire 72:00`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					LeaseTime:     "72h",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_with_expire_minutes",
			input: `dhcp scope 1 192.168.1.0/24 expire 0:30`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					LeaseTime:     "30m",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_with_expire_infinity",
			input: `dhcp scope 1 192.168.1.0/24 expire infinity`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					LeaseTime:     "infinity",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_with_maxexpire",
			input: `dhcp scope 1 192.168.1.0/24 expire 72:00 maxexpire 168:00`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					LeaseTime:     "72h",
					MaxLeaseTime:  "168h",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_full_with_maxexpire",
			input: `dhcp scope 1 192.168.1.0/24 gateway 192.168.1.1 expire 72:00 maxexpire 168:00`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					LeaseTime:     "72h",
					MaxLeaseTime:  "168h",
					ExcludeRanges: []ExcludeRange{},
					Options:       DHCPScopeOptions{Routers: []string{"192.168.1.1"}},
				},
			},
		},
		{
			name:  "scope_with_gateway_and_expire",
			input: `dhcp scope 1 192.168.1.0/24 gateway 192.168.1.1 expire 72:00`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.1.0/24",
					LeaseTime:     "72h",
					ExcludeRanges: []ExcludeRange{},
					Options:       DHCPScopeOptions{Routers: []string{"192.168.1.1"}},
				},
			},
		},
		{
			name:  "scope_ip_range_with_gateway_and_expire",
			input: `dhcp scope 1 192.168.1.20-192.168.1.99/16 gateway 192.168.1.253 expire 12:00`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       1,
					Network:       "192.168.0.0/16",
					RangeStart:    "192.168.1.20",
					RangeEnd:      "192.168.1.99",
					LeaseTime:     "12h",
					ExcludeRanges: []ExcludeRange{},
					Options:       DHCPScopeOptions{Routers: []string{"192.168.1.253"}},
				},
			},
		},
		{
			name:  "scope_max_id",
			input: `dhcp scope 65535 192.168.1.0/24`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       65535,
					Network:       "192.168.1.0/24",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
		{
			name:  "scope_large_id",
			input: `dhcp scope 10000 10.0.0.0/16`,
			expected: []DHCPScope{
				DHCPScope{
					ScopeID:       10000,
					Network:       "10.0.0.0/16",
					ExcludeRanges: []ExcludeRange{},
				},
			},
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if tt.skip != "" {
				t.Skip(tt.skip)
			}

			result, err := parser.ParseScopeConfig(tt.input)
			if err != nil {
				t.Fatalf("unexpected error: %v", err)
			}

			if len(result) != len(tt.expected) {
				t.Fatalf("expected %d scopes, got %d", len(tt.expected), len(result))
			}

			// Create map for easier comparison (order may vary)
			resultMap := make(map[int]DHCPScope)
			for _, s := range result {
				resultMap[s.ScopeID] = s
			}

			for _, expected := range tt.expected {
				got, ok := resultMap[expected.ScopeID]
				if !ok {
					t.Errorf("scope %d not found in result", expected.ScopeID)
					continue
				}

				if got.Network != expected.Network {
					t.Errorf("Network: got %q, want %q", got.Network, expected.Network)
				}
				if got.RangeStart != expected.RangeStart {
					t.Errorf("RangeStart: got %q, want %q", got.RangeStart, expected.RangeStart)
				}
				if got.RangeEnd != expected.RangeEnd {
					t.Errorf("RangeEnd: got %q, want %q", got.RangeEnd, expected.RangeEnd)
				}
				if got.LeaseTime != expected.LeaseTime {
					t.Errorf("LeaseTime: got %q, want %q", got.LeaseTime, expected.LeaseTime)
				}
				// Compare Options
				if !reflect.DeepEqual(got.Options.DNSServers, expected.Options.DNSServers) {
					t.Errorf("Options.DNSServers: got %v, want %v", got.Options.DNSServers, expected.Options.DNSServers)
				}
				if !reflect.DeepEqual(got.Options.Routers, expected.Options.Routers) {
					t.Errorf("Options.Routers: got %v, want %v", got.Options.Routers, expected.Options.Routers)
				}
				if got.Options.DomainName != expected.Options.DomainName {
					t.Errorf("Options.DomainName: got %q, want %q", got.Options.DomainName, expected.Options.DomainName)
				}
				// Compare ExcludeRanges
				if len(got.ExcludeRanges) != len(expected.ExcludeRanges) {
					t.Errorf("ExcludeRanges count: got %d, want %d", len(got.ExcludeRanges), len(expected.ExcludeRanges))
				}
			}
		})
	}
}

// TestSpecDhcpScopeBuild tests building of dhcp_scope commands from spec
func TestSpecDhcpScopeBuild(t *testing.T) {
	tests := []struct {
		name     string
		scope    DHCPScope
		expected string
		skip     string
	}{
		{
			name: "basic_scope_cidr24",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.1.0/24",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.0/24`,
		},
		{
			name: "basic_scope_cidr16",
			scope: DHCPScope{
				ScopeID:       2,
				Network:       "192.168.0.0/16",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 2 192.168.0.0/16`,
		},
		{
			name: "basic_scope_cidr8",
			scope: DHCPScope{
				ScopeID:       3,
				Network:       "10.0.0.0/8",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 3 10.0.0.0/8`,
		},
		{
			name: "scope_ip_range_format",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.1.0/24",
				RangeStart:    "192.168.1.20",
				RangeEnd:      "192.168.1.99",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.20-192.168.1.99/24`,
		},
		{
			name: "scope_ip_range_format_16",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.0.0/16",
				RangeStart:    "192.168.1.20",
				RangeEnd:      "192.168.1.99",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.20-192.168.1.99/16`,
		},
		{
			name: "scope_with_expire_hours_minutes",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.1.0/24",
				LeaseTime:     "24h",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.0/24 expire 24:00`,
		},
		{
			name: "scope_with_expire_72h",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.1.0/24",
				LeaseTime:     "72h",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.0/24 expire 72:00`,
		},
		{
			name: "scope_with_expire_minutes",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.1.0/24",
				LeaseTime:     "30m",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.0/24 expire 0:30`,
		},
		{
			name: "scope_with_expire_infinity",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.1.0/24",
				LeaseTime:     "infinity",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.0/24 expire infinity`,
		},
		{
			name: "scope_with_maxexpire",
			scope: DHCPScope{
				ScopeID:       1,
				Network:       "192.168.1.0/24",
				LeaseTime:     "72h",
				MaxLeaseTime:  "168h",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 1 192.168.1.0/24 expire 72:00 maxexpire 168:00`,
		},
		{
			name: "scope_max_id",
			scope: DHCPScope{
				ScopeID:       65535,
				Network:       "192.168.1.0/24",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 65535 192.168.1.0/24`,
		},
		{
			name: "scope_large_id",
			scope: DHCPScope{
				ScopeID:       10000,
				Network:       "10.0.0.0/16",
				ExcludeRanges: []ExcludeRange{},
			},
			expected: `dhcp scope 10000 10.0.0.0/16`,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if tt.skip != "" {
				t.Skip(tt.skip)
			}

			result := BuildDHCPScopeCommand(tt.scope)
			if result != tt.expected {
				t.Errorf("BuildDHCPScopeCommand() = %q, want %q", result, tt.expected)
			}
		})
	}
}
