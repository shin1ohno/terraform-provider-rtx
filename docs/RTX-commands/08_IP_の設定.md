# 第8章: IP の設定

> 元PDFページ: 140-201

---

第 8 章
IP の設定
8.1 インタフェース共通の設定
8.1.1 IP パケットを扱うか否かの設定
[書式 ]
ip routing  routing
no ip routing  [routing ]
[設定値及び初期値 ]
•routing
• [設定値 ] :
設定値 説明
on IP パケットを処理対象として扱う
off IP パケットを処理対象として扱わない
• [初期値 ] : on
[説明 ]
IP パケットをルーティングするかどうかを設定する。
[ノート ]
off の場合でも  TELNET による設定や  TFTP によるアクセス、 PING 等は可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.2 IP アドレスの設定
[書式 ]
ip interface  address  ip_address /mask  [broadcast broadcast_ip ]
ip interface  address  dhcp
ip wan address  dhcp
ip pp address  ip_address [/mask ]
ip loopback  address  ip_address [/mask ]
ip bridge_interface  address  ip_address /mask  [broadcast broadcast_ip ]
ip bridge_interface  address  dhcp [autoip= switch ]
no ip interface  address  [ip_address /mask  [broadcast broadcast_ip ]]
no ip interface  address  [dhcp]
no ip wan address  [dhcp]
no ip pp address  [ip_address [/mask ]]
no ip loopback  address  [ip_address [/mask ]]
no ip bridge_interface  address  [ip_address /mask  [broadcast broadcast_ip ]]
no ip bridge_interface  address  [dhcp]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インターフェース名
• [初期値 ] : -
•wan
• [設定値 ] :
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能140 | コマンドリファレンス  | IP の設定

• [初期値 ] : -
•loopback
• [設定値 ] : LOOPBACK インタフェース名
• [初期値 ] : -
•bridge_interface
• [設定値 ] : ブリッジインタフェース名
• [初期値 ] : -
•ip_address
• [設定値 ] : IP アドレス  xxx.xxx.xxx.xxx(xxx は十進数  )
• [初期値 ] : -
• dhcp : DHCP クライアントとして  IP アドレスを取得することを示すキーワード
• [初期値 ] : -
•mask
• [設定値 ] :
• xxx.xxx.xxx.xxx(xxx は十進数  )
• 0x に続く十六進数
•マスクビット数
• [初期値 ] : -
•broadcast_ip
• [設定値 ] : ブロードキャスト  IP アドレス
• [初期値 ] : -
•switch
• [設定値 ] :
設定値 説明
on AutoIP 機能を使う
off AutoIP 機能を使わない
• [初期値 ] : off
[説明 ]
インタフェースの  IP アドレスとネットマスクを設定する。 “broadcast broadcast_ip " を指定すると、ブロードキャスト
アドレスを指定できる。省略した場合には、 RFC3021 に対応している機種ではネットマスクのマスクビット数が  31
ビットならリミテッドブロードキャストアドレスが、それ以外ならディレクティッドブロードキャストアドレスが
使われる。
dhcp を指定すると、設定直後に  DHCP クライアントとして  IP アドレスを取得する。また  dhcp を指定している場合
にno ip  interface  address  を入力すると、取得していた  IP アドレスの開放メッセージを  DHCP サーバーに送る。
AutoIP 機能を使うに設定し、 ip bridge_interface  dhcp retry  設定で  dhcp の retry 回数が有限に設定してあると、 dhcp
でのアドレスの割り当てが失敗した場合に自動的に  169.254.0.0/16 のアドレスが決定される。
[ノート ]
LAN インタフェースに  IP アドレスを設定していない場合には、 RARP により  IP アドレスを得ようとする。
PP インタフェースに  IP アドレスを設定していない場合には、そのインタフェースは  unnumbered として動作する。
DHCP クライアントとして動作させた場合に取得したクライアント  ID は、 show status dhcpc  コマンドで確認するこ
とができる。
ブリッジインタフェースは、 vRX Amazon EC2 版、および  RTX5000 / RTX3500 Rev.14.00.11 以前では指定不可能。
工場出荷状態および cold start  コマンド実行後の本コマンドの設定値については「 1.7 工場出荷状態またはデプロイ
後の初期状態における設定値」を参照してください。
以下の機種は  RFC3021 に対応している。
RTX1300 Rev.23.00.17 以降
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | IP の設定  | 141

8.1.3 セカンダリ  IP アドレスの設定
[書式 ]
ip interface  secondary  address  ip_address [/mask ]
ip interface  secondary  address  dhcp
no ip interface  secondary  address  [ip_address /mask ]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•ip_address
• [設定値 ] : セカンダリ  IP アドレス  xxx.xxx.xxx.xxx(xxx は十進数  )
• [初期値 ] : -
• dhcp : DHCP クライアントとして  IP アドレスを取得することを示すキーワード
• [初期値 ] : -
•mask
• [設定値 ] :
• xxx.xxx.xxx.xxx(xxx は十進数  )
• 0x に続く十六進数
•マスクビット数
• [初期値 ] : -
[説明 ]
LAN 側のセカンダリ  IP アドレスとネットマスクを設定する。
dhcp を指定すると、設定直後に  DHCP クライアントとして  IP アドレスを取得する。
[ノート ]
セカンダリのネットワークでのブロードキャストアドレスは必ずディレクティッドブロードキャストアドレスが使
われる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.4 インタフェースの  MTU の設定
[書式 ]
ip interface  mtu mtu0
ip pp mtu mtu1
ip tunnel  mtu mtu2
no ip interface  mtu [mtu0 ]
no ip pp mtu [mtu1 ]
no ip tunnel  mtu [mtu2 ]
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•mtu0,mtu1,mtu2
• [設定値 ] : MTU の値  (64..1500 ；RTX5000 、RTX3500 の LAN インタフェースは  64..9578、RTX3510 、RTX1300
の LAN インターフェースは  64..10218)
• [初期値 ] :
• mtu0=1500
• mtu1=1500142 | コマンドリファレンス  | IP の設定

• mtu2=1280
[説明 ]
各インタフェースの  MTU の値を設定する。
[ノート ]
実際にはこの設定が適用されるのは  IP パケットだけである。他のプロトコルには適用されず、それらではデフォル
トのまま  1500 の MTU となる。
L2TP 接続ではトンネルインターフェースや  PP インターフェースの  MTU 設定は無視してカプセル化し、送信する
物理インターフェースの  MTU 設定に従ってカプセル化後のパケットをフラグメントする。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.5 同一インタフェースに折り返すパケットを送信するか否かの設定
[書式 ]
ip interface  rebound  switch
ip pp rebound  switch
ip tunnel  rebound  switch
no ip interface  rebound  [switch ]
no ip pp rebound  [switch ]
no ip tunnel  rebound  [switch ]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•switch
• [設定値 ] :
設定値 説明
on 折り返すパケットを送信する
off 折り返すパケットを送信しない
• [初期値 ] :
• off (PP インタフェースの場合 )
• on (その他のインタフェースの場合 )
[説明 ]
同一インタフェースに折り返すパケットを送信するか否かを設定する。
折り返すパケットを送信しない場合にはそのパケットを廃棄し、送信元へ ICMP Destination Unreachable を送信す
る。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.6 echo,discard,time サービスを動作させるか否かの設定
[書式 ]
ip simple-service  service
no ip simple-service  [service ]
[設定値及び初期値 ]
•service
• [設定値 ] :
設定値 説明
on TCP/UDP の各種サービスを動作させるコマンドリファレンス  | IP の設定  | 143

設定値 説明
off サービスを停止させる
• [初期値 ] : off
[説明 ]
TCP/UDP の echo(7)、discard(9) 、time(37) の各種サービスを動作させるか否かを設定する。サービスを停止すると該
当のポートも閉じる。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.7 IP の静的経路情報の設定
[書式 ]
ip route  network  gateway gateway1  [parameter ] [gateway gateway2  [parameter ]...]
no ip route  network  [gateway...]
[設定値及び初期値 ]
•network
• [設定値 ] :
設定値 説明
default デフォルト経路
IP アドレス 送り先のホスト /マスクビット数 (省略時は  32)
• [初期値 ] : -
•gateway1, gateway2
• [設定値 ] :
• IP アドレス
• xxx.xxx.xxx.xxx (xxx は十進数  )
• pp peer_num  [dlci= dlci] : PP インタフェースへの経路。 "dlci=dlci" が指定された場合は、フレームリレーの
DLCI への経路
•peer_num  : 相手先情報番号
• pp anonymous name= name
設定値 説明
name PAP/CHAP による名前
• dhcp interface
設定値 説明
interfaceDHCP にて与えられるデフォルトゲートウェイを
使う場合の、 DHCP クライアントとして動作する
LAN インタフェース名、 WAN インタフェース名、
ブリッジインタフェース名
• tunnel tunnel_num  : トンネルインタフェースへの経路
• LOOPBACK インタフェース名、 NULL インタフェース名
• [初期値 ] : -
•parameter  : 以下のパラメータを空白で区切り複数設定可能
• [設定値 ] :
設定値 説明
filter number  [number ..]フィルタ型経路の指定
•number
•フィルタの番号  (1..21474836) ( 空白で区切り
複数設定可能  )144 | コマンドリファレンス  | IP の設定

設定値 説明
dpi number  [number ..]フィルタ型経路の指定
•number
• DPI フィルタの番号  (1..2147483647) ( 空白で区
切り複数設定可能  )
metric metricメトリックの指定
•metric
•メトリック値  (1..15)
•省略時は  1
hide出力インタフェースが  LAN インタフェース、または
WAN インタフェース、 PP インタフェース、 TUNNEL
インタフェースの場合のみ有効なオプションで、 相手
先が接続されている場合だけ経路が有効になること
を意味する
weight weight異なる経路間の比率を表す値
•weight
•経路への重み  (0..2147483647)
•省略時は  1
keepalive keepalive_idgateway1  に到達性のあるときにだけ有効となる
•keepalive_id
•キープアライブの識別子  (1..100; vRX Amazon
EC2 版 通常モード、 vRX VMware ESXi 版 通常
モード、および  vRX さくらのクラウド版  は
1..6000; RTX5000 、RTX3510 は 1...3000; vRX
Amazon EC2 版 コンパクトモード、 vRX
VMware ESXi 版 コンパクトモード、および
RTX3500 は 1...1000)
• [初期値 ] : -
[説明 ]
IP の静的経路を設定する。
gateway  のパラメータとしてフィルタ型経路を指定した場合には、記述されている順にフィルタを適用していき、適
合したゲートウェイが選択される。
適合するゲートウェイが存在しない場合や、フィルタ型経路が指定されているゲートウェイが一つも記述されてい
ない場合には、フィルタ型経路が指定されていないゲートウェイが選択される。
フィルタ型経路が指定されていないゲートウェイも存在しない場合には、その経路は存在しないものとして処理が
継続される。
フィルタ型経路が指定されていないゲートウェイが複数記述された場合の経路の選択は、それらの経路を使用する
時点でラウンドロビンにより決定される。
filter が指定されていないゲートウェイが複数記述されている場合で、それらの経路を使うべき時にどちらを使うか
は、始点 /終点  IP アドレス、プロトコル、始点 / 終点ポート番号により識別されるストリームにより決定される。同
じストリームのパケットは必ず同じゲートウェイに送出される。 weight  で値  ( 例えば回線速度の比率  ) が指定され
ている場合には、その値の他のゲートウェイの weight  値に対する比率に比例して、その経路に送出されるストリー
ムの比率が上がる。
いずれの場合でも、 hide キーワードが指定されているゲートウェイは､回線が接続している場合のみ有効で、回線が
接続していない場合には評価されない。なお  LOOPBACK インタフェース、 NULL インタフェースは常にアップ状態
なので、 hide オプションは指定はできるものの意味はない。
複数のゲートウェイを設定した時に、ロードバランスをせずに特定のゲートウェイだけを優先的に使用するには、
weight  オプションで  0 を設定する。コマンドリファレンス  | IP の設定  | 145

[ノート ]
既に存在する経路を上書きすることができる。
ブリッジインタフェースは、 vRX Amazon EC2 版、および  RTX5000 / RTX3500 Rev.14.00.11 以前では指定不可能。
WAN インタフェースは、 vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能。
parameter  パラメータの  dpi キーワードは  RTX1300 、RTX840、および  RTX830 Rev.15.02.13 以降で指定可能。
最初の gatewayキーワードより後のキーワードとパラメーターは合計 129個まで設定可能。
[設定例 ]
•デフォルトゲートウェイを  192.168.0.1 とする。
# ip route default gateway 192.168.0.1
• PP1 で接続している相手のネットワークは  192.168.1.0/24 である。
# ip route 192.168.1.0/24 gateway pp 1
•マルチホーミングによる負荷分散を行う。デフォルトゲートウェイとして  2 経路持ち、 PP1 には専用線  128k で、
PP2 には専用線  64k で接続しており、かつ各専用線ダウン時の経路を無効としてパケットロスを防ぐ。
※ NAT 機能と専用線キープアライブの併用が必要となる。
# ip route default gateway pp 1 weight 2 hide gateway pp 2 weight 1 hide
• PP1 が有効な時には  PP1 のみが使われる。 PP1 がダウンすると  PP2 が使われる。
# ip route 192.168.0.1/24 gateway pp 1 hide gateway pp 2 weight 0
•ソフトウェア更新関係のパケットは  PP1 インターフェース経由で、その他は  TUNNEL1 経由で送信する。
# dpi group set 100 name=sw_update 
windows_update,apple_update,ios_ota_update,adobe_update
# ip dpi filter 1 pass * * 100
# ip route default gateway pp 1 dpi 1 gateway tunnel 1
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
•peer_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 150
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.8 DHCP でIPアドレスを取得したときにデフォルト経路を自動的に追加するか否かを設定
[書式 ]
ip interface  dhcp  auto  default-route-add  switch
no ip interface  dhcp  auto  default-route-add  [switch ]146 | コマンドリファレンス  | IP の設定

[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インターフェース名
• WAN インターフェース名
• vRX シリーズ  では指定不可能
•ブリッジインターフェース名
• [初期値 ] : -
•switch
• [設定値 ] :
設定値 説明
on DHCPでIPアドレスを取得したときにデフォルト経
路を自動的に追加する
off DHCPでIPアドレスを取得したときにデフォルト経
路を自動的には追加しない
• [初期値 ] : on
[説明 ]
指定したインターフェースを使用中、 DHCPでIPアドレスを取得したときにデフォルト経路を自動的に追加するか
否かを設定する。
すでに DHCPでIPアドレスを取得しているインターフェースに対してこのコマンドの設定が変更された場合、次に
DHCPでIPアドレスを取得した時点から新しい設定が反映される。
[ノート ]
ブリッジインターフェースは、 vRX Amazon EC2 版 では指定不可能。
RTX1210 は Rev.14.01.28 以降で使用可能。
RTX830 は Rev.15.02.03 以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX3510, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.9 DHCP でIPアドレスを取得したときに implicit経路を自動的に追加するか否かを設定
[書式 ]
ip interface  dhcp  auto  interface-route-add  switch
no ip interface  dhcp  auto  interface-route-add  [switch ]
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インターフェース名
• WAN インターフェース名
• vRX シリーズ  では指定不可能
•ブリッジインターフェース名
• [初期値 ] : -
•switch
• [設定値 ] :
設定値 説明
on DHCPでIPアドレスを取得したときに implicit経路
を自動的に追加する
off DHCPでIPアドレスを取得したときに implicit経路
を自動的には追加しない
• [初期値 ] : onコマンドリファレンス  | IP の設定  | 147

[説明 ]
指定したインターフェースを使用中、 DHCPでIPアドレスを取得したときにアドレスを取得したインターフェース
のimplicitなネットワーク経路を自動的に追加するか否かを設定する。
すでに DHCPでIPアドレスを取得しているインターフェースに対してこのコマンドの設定が変更された場合、次に
DHCPでIPアドレスを取得した時点から新しい設定が反映される。
[ノート ]
ブリッジインターフェースは、 vRX Amazon EC2 版 では指定不可能。
RTX1210 は Rev.14.01.28 以降で使用可能。
RTX830 は Rev.15.02.03 以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX3510, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.10 IP パケットのフィルターの設定
[書式 ]
ip filter  filter_num  pass_reject  src_addr [/mask ] [dest_addr [/mask ] [protocol  [src_port_list  [dest_port_list ]]]]
no ip filter  filter_num  [pass_reject ]
[設定値及び初期値 ]
•filter_num
• [設定値 ] : 静的フィルター番号  (1..21474836)
• [初期値 ] : -
•pass_reject
• [設定値 ] :
設定値 説明
pass 一致すれば通す  ( ログに記録しない  )
pass-log 一致すれば通す  ( ログに記録する  )
pass-nolog 一致すれば通す  ( ログに記録しない  )
reject 一致すれば破棄する  ( ログに記録する  )
reject-log 一致すれば破棄する  ( ログに記録する  )
reject-nolog 一致すれば破棄する  ( ログに記録しない  )
restrict 回線が接続されていれば通し、 切断されていれば破棄
する  ( 破棄する場合のみログに記録する  )
restrict-log 回線が接続されていれば通し、 切断されていれば破棄
する  ( ログに記録する  )
restrict-nolog 回線が接続されていれば通し、 切断されていれば破棄
する  ( ログに記録しない  )
• [初期値 ] : -
•src_addr  : IP パケットの始点アドレス
• [設定値 ] :
• IPアドレス
• A.B.C.D (A ～D: 0～255もしくは *)
•上記表記で A～Dを*とすると、該当する 8ビット分についてはすべての値に対応する
•間に  - を挟んだ  2 つの上項目、 - を前につけた上項目、 - を後ろにつけた上項目、これらは範囲を指定す
る。
• , を区切りとして複数設定することができる。
• FQDN
•任意の文字列  (半角  255 文字以内。 / ： は使用できない。 , は区切り文字として使われるため、使用でき
ない )148 | コマンドリファレンス  | IP の設定

• * から始まる  FQDN は * より後ろの文字列を後方一致条件として判断する  例えば  *.example.co.jp は
www.example.co.jp 、mail.example.co.jp などと一致する
• , を区切りとして複数設定することができる。
• map-e
• MAP-E のマップルールにより生成されたグローバル IPv4アドレスを表すキーワード
• hb46pp
• IPv6 マイグレーション技術の国内標準プロビジョニング方式により取得した  IP アドレスを表すキーワ
ード
•アプリケーション名を表すニーモニック
• "@" から始まる任意の文字列  (半角  32 文字以内。 A-Z a-z 0-9 _ - のみ使用可能 )
• , を区切りとして複数設定することができる。
• * (すべての IPアドレスに対応 )
• [初期値 ] : -
•dest_addr  : IP パケットの終点アドレス
• [設定値 ] :
•src_addr  と同じ形式
•省略した場合は一個の  * と同じ
• [初期値 ] : -
•mask  : IP アドレスのビットマスク  (src_addr  および  dest_addr  がネットワークアドレスの場合のみ指定可  )
• [設定値 ] :
• A.B.C.D (A ～D: 0～255)
• 0x に続く十六進数
•マスクビット数
•省略時は  0xffffffff と同じ
• [初期値 ] : -
•protocol  : フィルタリングするパケットの種類
• [設定値 ] :
•プロトコルを表す十進数  (0..255)
•プロトコルを表すニーモニック
ニーモニック 十進数 説明
icmp 1 ICMP パケット
tcp 6 TCP パケット
udp 17 UDP パケット
ipv6 41 IPv6 パケット
gre 47 GRE パケット
esp 50 ESP パケット
ah 51 AH パケット
icmp6 58 ICMP6 パケット
•上項目のカンマで区切った並び
•特殊指定
icmp-errorTYPE が 3、4、5、11、12、31、32 のいずれかであ
る ICMP パケット
icmp-infoTYPE が 0、8～10、13～18、30、33～36 のいずれか
である  ICMP パケット
tcpsyn SYN フラグの立っている  tcp パケット
tcpfin FIN フラグの立っている  tcp パケット
tcprst RST フラグの立っている  tcp パケットコマンドリファレンス  | IP の設定  | 149

establishedACK フラグの立っている  tcp パケット内から外へ
の接続は許可するが、外から内への接続は拒否する
機能
tcpflag= value/mask TCP フラグの値と  mask  の値の論理積  (AND) が、
value  に一致、または不一致である  TCP パケット
value  と mask  は 0x に続く十六進数で  0x0000～
0xfffftcpflag!= value/mask
* すべてのプロトコル
•省略時は  * と同じ。
• [初期値 ] : -
•src_port_list  : protocol  に、 TCP(tcp/tcpsyn/tcpfin/tcprst/established/tcpflag) 、UDP(udp) のいずれかが含まれる場合は、
TCP/UDP のソースポート番号。 protocol  が ICMP(icmp) 単独の場合には、 ICMP タイプ。
• [設定値 ] :
•ポート番号、タイプを表す十進数
•ポート番号を表すニーモニック  ( 一部  )
ニーモニック ポート番号
ftp 20,21
ftpdata 20
telnet 23
smtp 25
domain 53
gopher 70
finger 79
www 80
pop3 110
sunrpc 111
ident 113
ntp 123
nntp 119
snmp 161
syslog 514
printer 515
talk 517
route 520
uucp 540
submission 587
•間に  - を挟んだ  2 つの上項目、 - を前につけた上項目、 - を後ろにつけた上項目、これらは範囲を指定する。
•上項目のカンマで区切った並び  (10 個以内  )
• * ( すべてのポート、タイプ  )
•省略時は  * と同じ。
• [初期値 ] : -
•dest_port_list
• [設定値 ] : protocol  に、 TCP(tcp/tcpsyn/tcpfin/tcprst/established/tcpflag) 、UDP(udp) のいずれかが含まれる場合は、
TCP/UDP のデスティネーションポート番号。 protocol  が ICMP(icmp) 単独の場合には、 ICMP コード
• [初期値 ] : -150 | コマンドリファレンス  | IP の設定

[説明 ]
IP パケットのフィルターを設定する。本コマンドで設定されたフィルターは ip filter directed-broadcast 、ip filter
dynamic、ip filter set 、ip forward filter 、ip fragment remove df-bit 、ip interface  rip filter、ip interface  secure filter 、お
よび ip route  コマンドで用いられる。
[ノート ]
restrict-log 及び  restrict-nolog を使ったフィルターは、回線が接続されている時だけ通せば十分で、そのために回線に
発信するまでもないようなパケットに有効である。例えば、時計を合わせるための  NTP パケットがこれに該当す
る。 ICMP パケットに対して、 ICMP タイプと  ICMP コードをフィルターでチェックしたい場合には、 protocol  には
'icmp' だけを単独で指定する。 protocol  が 'icmp' 単独である場合にのみ、 src_port_list  は ICMP タイプ、 dest_port_list
は ICMP コードと見なされる。 protocol  に 'icmp' と他のプロトコルを列挙した場合には  src_port_list  と dest_port_list
の指定は  TCP/UDP のポート番号と見なされ、 ICMP パケットとの比較は行われない。また、 protocol  に 'icmp-error'
や 'icmpinfo' を指定した場合には、 src_port_list  と dst_port_list  の指定は無視される。 protocol  に '*' を指定するか、
TCP/UDP を含む複数のプロトコルを列挙している場合には、 src_port_list  と dest_port_list  の指定は  TCP/UDP のポー
ト番号と見なされ、 パケットが  TCP または  UDP である場合のみポート番号がフィルターが比較される。パケットが
その他のプロトコル  (ICMP を含む ) の場合には、 src_port_list  と dest_port_list  の指定は存在しないものとしてフィル
ターと比較される。
src_addr  および  dest_addr  は IP アドレス、 FQDN、map-e、hb46pp、およびアプリケーション名を表すニーモニック
を混合することも可能。
src_addr  および  dest_addr  への  FQDN の指定は  RTX5000 Rev.14.00.26 以降、 RTX3500 Rev.14.00.26 以降、 RTX1210
Rev.14.01.26 以降、 RTX830 Rev.15.02.03 以降、および  Rev.15.04 系以降で指定可能。
src_addr  および  dest_addr  に FQDN を指定することによって、固定  IP アドレスではないサーバーや  1 つの  FQDN に
対して複数の固定  IP アドレスを持つサーバーを対象にしたフィルタリングを行うことができる。 FQDN を使用す
る場合、ルーター自身が  DNS リカーシブサーバーとして動作し、ルーター配下の端末は  DNS サーバーとして本機
を指定する必要がある。
指定した  FQDN に一致する通信が発生した場合、 設定した  FQDN に該当する  IP アドレスの情報が保持される。保持
される期間は、  ip filter fqdn timer  コマンドで指定できる。
src_addr  および  dest_addr  への  map-e の指定は、 vRX シリーズ、 RTX5000 Rev.14.00.31 以前、 RTX3500 Rev.14.00.31
以前、 RTX1210 Rev.14.01.39 以前、および  RTX830 Rev.15.02.19 以前では不可能。
src_addr  および  dest_addr  への  hb46pp の指定は、 vRX シリーズ、 RTX5000 、RTX3510 Rev.23.01.01 、RTX3500 、RTX1300
Rev.23.00.11 以前、 RTX1220 Rev.15.04.06 以前、 RTX1210 、および  RTX830 Rev.15.02.30 以前では不可能。
src_addr  および  dest_addr  へのアプリケーション名を表すニーモニックの指定は、 vRX シリーズ、 RTX5000 、
RTX3510 、RTX3500 、RTX1300 、RTX1220 、RTX1210 、および  RTX830 では不可能。
アプリケーション名を表すニーモニックには、通信先リストに記載されたニーモニックを指定する。
以下の状態では、アプリケーション名を表すニーモニックは評価されない。
• LBO の状態が "正常動作中 "でないとき
•指定されたニーモニックが、通信先リストに含まれていないとき
[設定例 ]
• LAN1 で送受信される  IPv4 ICMP ECHO/REPLY を pass-log で記録する
# ip lan1 secure filter in 1 2 100
# ip lan1 secure filter out 1 2 100
# ip filter 1 pass-log * * icmp 8
# ip filter 2 pass-log * * icmp 0
# ip filter 100 pass * *
• LAN2 から送信される  IPv4 Redirect のうち、 "for the Host" だけを通さない
# ip lan2 secure filter out 1 100
# ip filter 1 reject * * icmp 5 1
# ip filter 100 pass * *
• Microsoft 365 および  Windows Update のパケットは  PP1 経由で、その他は  TUNNEL1 経由で送信する
# ip route default gateway pp 1 filter 1 gateway tunnel 1
# ip filter 1 pass * @m365,@windows_update * *コマンドリファレンス  | IP の設定  | 151

[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.11 フィルタセットの定義
[書式 ]
ip filter  set name  direction  filter_list  [filter_list  ...]
no ip filter  set name  [direction  ...]
[設定値及び初期値 ]
•name
• [設定値 ] : フィルタセットの名前を表す文字列
• [初期値 ] : -
•direction
• [設定値 ] :
設定値 説明
in 入力方向のフィルタ
out 出力方向のフィルタ
• [初期値 ] : -
•filter_list
• [設定値 ] : 空白で区切られたフィルタ番号の並び  (1001 個以内  )
• [初期値 ] : -
[説明 ]
フィルタセットを定義する。フィルタセットは、 in/out のフィルタをそれぞれ定義し、 RADIUS による指定や、 ip
interface  secure filter  コマンドによりインタフェースに適用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.12 Source-route オプション付き  IP パケットをフィルタアウトするか否かの設定
[書式 ]
ip filter  source-route  filter_out
no ip filter  source-route  [filter_out ]
[設定値及び初期値 ]
•filter_out
• [設定値 ] :
設定値 説明
on フィルタアウトする
off フィルタアウトしない
• [初期値 ] : on
[説明 ]
Source-route オプション付き  IP パケットをフィルタアウトするか否かを設定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.13 ディレクテッドブロードキャストパケットをフィルタアウトするか否かの設定
[書式 ]
ip filter  directed-broadcast  filter_out
ip filter  directed-broadcast  filter filter_num  [filter_num  ...]
no ip filter  directed-broadcast152 | コマンドリファレンス  | IP の設定

[設定値及び初期値 ]
•filter_out
• [設定値 ] :
設定値 説明
on フィルタアウトする
off フィルタアウトしない
• [初期値 ] : on
•filter_num
• [設定値 ] : 静的フィルタ番号  (1..21474836)
• [初期値 ] : -
[説明 ]
終点  IP アドレスがディレクテッドブロードキャストアドレス宛になっている  IP パケットをルーターが接続されて
いるネットワークにブロードキャストするか否かを設定する。
on を指定した場合には、ディレクティッドブロードキャストパケットはすべて破棄する。
off を指定した場合には、ディレクティッドブロードキャストパケットはすべて通過させる。
filter を指定した場合には、 ip filter  コマンドで設定したフィルタでパケットを検査し、 PASS フィルタにマッチした
場合のみパケットを通過させる。
[ノート ]
このコマンドでのチェックよりも、 ip interface  wol relay  コマンドのチェックの方が優先される。 ip interface  wol relay
コマンドでのチェックにより通過させることができなかったパケットのみが、このコマンドでのチェックを受ける。
いわゆる  smurf 攻撃を防止するためには  on にしておく。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.14 動的フィルターの定義
[書式 ]
ip filter  dynamic  dyn_filter_num  srcaddr [/mask ] dstaddr [/mask ] protocol  [option  ...]
ip filter  dynamic  dyn_filter_num  srcaddr [/mask ] dstaddr [/mask ] filter filter_list  [in filter_list ] [out filter_list ] [option ...]
no ip filter  dynamic  dyn_filter_num
[設定値及び初期値 ]
•dyn_filter_num
• [設定値 ] : 動的フィルター番号  (1..21474836)
• [初期値 ] : -
•srcaddr  : IP パケットの始点アドレス
• [設定値 ] :
•ip filter  コマンドの  src_addr  と同じ形式
• [初期値 ] : -
•dstaddr  : IP パケットの終点アドレス
• [設定値 ] :
•srcaddr  と同じ形式
• [初期値 ] : -
•mask  : IP アドレスのビットマスク  (srcaddr  および  dstaddr  がネットワークアドレスの場合のみ指定可  )
• [初期値 ] : -
•protocol  : プロトコルのニーモニック
• [設定値 ] :
• tcp/udp/ftp/tftp/domain/www/smtp/pop3/telnet/netmeeting
• echo/discard/daytime/chargen/ftp/ssh/telnet/smtp/time/whois/dns/domain/
• tftp/gopher/finger/http/www/pop3/sunrpc/ident/nntp/ntp/ms-rpc/コマンドリファレンス  | IP の設定  | 153

• netbios_ns/netbios_dgm/netbios_ssn/imap/snmp/snmptrap/bgp/imap3/ldap/
• https/ms-ds/ike/rlogin/rwho/rsh/syslog/printer/rip/ripng/
• ms-sql/radius/l2tp/pptp/nfs/msblast/ipsec-nat-t/sip/
• ping/ping6/tcp/udp
• submission
以下は設定できますが、動的フィルターとして動作しません
• dhcpc/dhcps/dhcpv6c/dhcpv6s
• [初期値 ] : -
•filter_list
• [設定値 ] : ip filter  コマンドで登録されたフィルター番号のリスト
• [初期値 ] : -
•option
• [設定値 ] :
• syslog= switch
設定値 説明
on コネクションの通信履歴を  SYSLOG に残す
off コネクションの通信履歴を  SYSLOG に残さない
• timeout= time
設定値 説明
timeデータが流れなくなったときにコネクション情報
を解放するまでの秒数
• [初期値 ] : syslog=on
[説明 ]
動的フィルターを定義する。第  1 書式では、あらかじめルーターに登録されているアプリケーション名を指定する。
第 2 書式では、ユーザーがアクセス制御のルールを記述する。キーワードの  filter、in、out の後には、 ip filter  コマ
ンドで定義されたフィルター番号を設定する。
filter キーワードの後に記述されたフィルターに該当するコネクション  ( トリガー  ) を検出したら、それ以降  in キー
ワードと  out キーワードの後に記述されたフィルターに該当するコネクションを通過させる。 in キーワードはトリ
ガーの方向に対して逆方向のアクセスを制御し、 out キーワードは動的フィルターと同じ方向のアクセスを制御す
る。なお、 ip filter  コマンドの  IP アドレスは無視される。  pass/reject の引数も同様に無視される。
プロトコルとして  tcp や udp を指定した場合には、 アプリケーションに固有な処理は実施されない。特定のアプリケ
ーションを扱う必要がある場合には、アプリケーション名を指定する。
[ノート ]
src_addr  および  dstaddr  は IP アドレス、 FQDN、map-e、hb46pp、およびアプリケーション名を表すニーモニックを
混合することも可能。
srcaddr  および  dstaddr  への  FQDN の指定は、 RTX5000 / RTX3500 Rev.14.00.25 以前、 RTX1210 Rev.14.01.25 以前、お
よび  RTX830 Rev.15.02.02 以前では不可能。
srcaddr  および  dstaddr  への  map-e の指定は、 vRX シリーズ、 RTX5000 / RTX3500 Rev.14.00.31 以前、 RTX1210
Rev.14.01.39 以前、および  RTX830 Rev.15.02.19 以前では不可能。
src_addr  および  dstaddr  への  hb46pp の指定は、 vRX シリーズ、 RTX5000 、RTX3510 Rev.23.01.01 、RTX3500 、RTX1300
Rev.23.00.11 以前、 RTX1220 Rev.15.04.06 以前、 RTX1210 、および  RTX830 Rev.15.02.30 以前では不可能。
src_addr  および  dstaddr  へのアプリケーション名を表すニーモニックの指定は、 vRX シリーズ、 RTX5000 、
RTX3510 、RTX3500 、RTX1300 、RTX1220 、RTX1210 、および  RTX830 では不可能。
アプリケーション名を表すニーモニックには、通信先リストに記載されたニーモニックを指定する。
以下の状態では、アプリケーション名を表すニーモニックは評価されない。
• LBO の状態が "正常動作中 "でないとき
•指定されたニーモニックが、通信先リストに含まれていないとき154 | コマンドリファレンス  | IP の設定

[設定例 ]
# ip filter 10 pass * * udp * snmp
# ip filter dynamic 1 * * filter 10
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.15 動的フィルタのタイムアウトの設定
[書式 ]
ip filter  dynamic  timer  option =timeout  [option =timeout ...]
no ip filter  dynamic  timer
[設定値及び初期値 ]
•option  : オプション名
• [設定値 ] :
設定値 説明
tcp-syn-timeout SYN を受けてから設定された時間内にコネクション
が確立しなければセッションを切断する
tcp-fin-timeout FIN を受けてから設定された時間が経てばコネクシ
ョンを強制的に解放する
tcp-idle-time 設定された時間内に  TCP コネクションのデータが流
れなければコネクションを切断する
udp-idle-time 設定された時間内に  UDP コネクションのデータが流
れなければコネクションを切断する
dns-timeout DNS の要求を受けてから設定された時間内に応答を
受けなければコネクションを切断する
• [初期値 ] :
• tcp-syn-timeout=30
• tcp-fin-timeout=5
• tcp-idle-time=3600
• udp-idle-time=30
• dns-timeout=5
•timeout
• [設定値 ] : 待ち時間  ( 秒 )
• [初期値 ] : -
[説明 ]
動的フィルタのタイムアウトを設定する。
[ノート ]
本設定はすべての検査において共通に使用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.16 FQDN フィルターで使用するキャッシュのタイマーの設定
[書式 ]
ip filter  fqdn  timer  time [auto =switch ]
no ip filter  fqdn  timer  [time]
[設定値及び初期値 ]
•time
• [設定値 ] : 秒数  (1..2147483647)
• [初期値 ] : 600
•switchコマンドリファレンス  | IP の設定  | 155

• [設定値 ] :
設定値 説明
on 自動設定を使用する
off 自動設定を使用しない
• [初期値 ] : on
[説明 ]
FQDN フィルターで使用するキャッシュのタイマーを設定する。
ip filter  コマンド、および  ipv6 filter  コマンドで、始点アドレスおよび、終点アドレスに  FQDN を設定している場
合、  指定した  FQDN に一致する通信が発生したとき、タイマーが動作する。  time に指定した秒数の間、 FQDN フィ
ルターに一致する通信がない場合、 FQDN と IP アドレスを対応づけるキャッシュを削除する。
auto=on の場合、タイマーには以下の値が設定される。
•ファストパスを使用する通信のとき、ファストパスのフローテーブルで使用されるタイマーの中で、最も大きい
値が本タイマーの値として自動で設定される。
•ファストパスを使用しない通信のとき、 time の値がタイマーとして設定される。
auto=off の場合は、常に  time の値がタイマーとして設定される。
[ノート ]
RTX5000 は Rev.14.00.26 以降、 RTX3500 は Rev.14.00.26 以降、 RTX1210 は Rev.14.01.26 以降、 RTX830 は Rev.15.02.03
以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.17 侵入検知機能の動作の設定
[書式 ]
ip interface  intrusion  detection  direction  [type] switch  [option ]
ip pp intrusion  detection  direction  [type] switch  [option ]
ip tunnel  intrusion  detection  direction  [type] switch  [option ]
no ip interface  intrusion  detection  direction  [type] switch  [option ]
no ip pp intrusion  detection  direction  [type] switch  [option ]
no ip tunnel  intrusion  detection  direction  [type] switch  [option ]
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•direction  : 観察するパケット・コネクションの方向
• [設定値 ] :
設定値 説明
in インタフェースの内向き
out インタフェースの外向き
• [初期値 ] : -
•type : 観察するパケット・コネクションの種類
• [設定値 ] :156 | コマンドリファレンス  | IP の設定

設定値 説明
ip IP ヘッダ
ip-option IP オプションヘッダ
fragment フラグメント
icmp ICMP
udp UDP
tcp TCP
ftp FTP
winny Winny
share Share
( vRX シリーズ  では指定不可能  )
default 設定していないものすべて
• [初期値 ] : -
•switch
• [設定値 ] :
設定値 説明
on 実行する
off 実行しない
• [初期値 ] :
• TYPE を指定しないとき =off
• TYPE を指定したとき =on
•option
• [設定値 ] :
設定値 説明
reject=on 不正なパケットを破棄する
reject=off 不正なパケットを破棄しない
• [初期値 ] : off
[説明 ]
指定したインタフェースで、指定された向きのパケットやコネクションについて異常を検知する。
type オプションを省略したときには、侵入検知機能の全体についての設定になる。
[ノート ]
危険性の高い攻撃については、 reject オプションの設定に関わらず、常にパケットを破棄する。
Winny については、バージョン  2 の検知が可能であり、それ以前のバージョンには対応していない。
Share については、バージョン 1.0 EX2 (ShareTCP 版) の検知が可能であり、それ以前のバージョンには対応していな
い。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.18 1 秒間に侵入検知情報を通知する頻度の設定
[書式 ]
ip interface  intrusion  detection  notice-interval  frequency
ip pp intrusion  detection  notice-interval  frequency
ip tunnel  intrusion  detection  notice-interval  frequencyコマンドリファレンス  | IP の設定  | 157

no ip interface  intrusion  detection  notice-interval
no ip pp intrusion  detection  notice-interval
no ip tunnel  intrusion  detection  notice-interval
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•frequency
• [設定値 ] : 頻度  (1...1000)
• [初期値 ] : 1
[説明 ]
1 秒間に侵入検知情報を通知する頻度を設定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.19 重複する侵入検知情報の通知抑制の設定
[書式 ]
ip interface  intrusion  detection  repeat-control  time
ip pp intrusion  detection  repeat-control  time
ip tunnel  intrusion  detection  repeat-control  time
no ip interface  intrusion  detection  repeat-control
no ip pp intrusion  detection  repeat-control
no ip tunnel  intrusion  detection  repeat-control
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•time
• [設定値 ] : 秒数  (1..1000)
• [初期値 ] : 60
[説明 ]
同じホストに対する同じ種類の攻撃を、 time 秒に  1 回のみ通知するよう抑制する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.20 侵入検知情報の最大表示件数の設定
[書式 ]
ip interface  intrusion  detection  report  num
ip pp intrusion  detection  report  num
ip tunnel  intrusion  detection  report  num
no ip interface  intrusion  detection  report
no ip pp intrusion  detection  report
no ip tunnel  intrusion  detection  report
[設定値及び初期値 ]
•interface158 | コマンドリファレンス  | IP の設定

• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•num
• [設定値 ] : 件数  (1..1000)
• [初期値 ] : 50
[説明 ]
show ip intrusion detection  コマンドで表示される侵入検知情報の最大件数を設定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.21 TCP セッションの  MSS 制限の設定
[書式 ]
ip interface  tcp mss limit  mss
ip pp tcp mss limit  mss
ip tunnel  tcp mss limit  mss
no ip interface  tcp mss limit  [mss]
no ip pp tcp mss limit  [mss]
no ip tunnel  tcp mss limit  [mss]
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•mss
• [設定値 ] :
設定値 説明
536..1460 MSS の最大長
auto 自動設定
off 設定しない
• [初期値 ] :
• auto ( vRX シリーズ、 RTX5000 / RTX3500 Rev.14.00.22 以降、 RTX1210 Rev.14.01.26 以降、 RTX830
Rev.15.02.03 以降、 Rev.15.04 系以降  )
• off ( 上記以外  )
[説明 ]
インタフェースを通過する  TCP セッションの  MSS を制限する。インタフェースを通過する  TCP パケットを監視
し、 MSS オプションの値が設定値を越えている場合には、設定値に書き換える。キーワード  auto を指定した場合に
は、インタフェースの  MTU、もしくは  PP インタフェースの場合で相手の  MRU 値が分かる場合にはその  MRU 値か
ら計算した値に書き換える。
[ノート ]
PPPoE 用の  PP インタフェースに対しては、 pppoe tcp mss limit  コマンドでも  TCP セッションの  MSS を制限するこ
とができる。このコマンドと pppoe tcp mss limit  コマンドの両方が有効な場合は、 MSS はどちらかより小さな方の
値に制限される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | IP の設定  | 159

8.1.22 TCP ウィンドウ・スケール・オプション  を変更する
[書式 ]
ip interface  tcp window-scale  sw
ip pp tcp window-scale  sw
ip tunnel  tcp window-scale  sw
no ip interface  tcp window-scale  [...]
no ip pp tcp window-scale  [...]
no ip tunnel  tcp window-scale  [...]
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•sw
• [設定値 ] :
設定値 説明
off 何もしない
remove TCP ウィンドウ・スケール・オプション  を削除する
• [初期値 ] : off
[説明 ]
インターフェースを通過する  TCP パケットのウィンドウ・スケール・オプションを強制的に変更する。
remove を指定すると、ウィンドウ・スケール・オプション  が有効になっていた場合には、無効にして転送する。
[ノート ]
RTX5000 、RTX3500 は Rev.14.00.21 以降で使用可能。
RTX1210 は Rev.14.01.16 以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.23 ルーターが端点となる  TCP のセッション数の設定
[書式 ]
tcp session  limit  limit
no tcp session  limit  [limit]
[設定値及び初期値 ]
•limit : 制限値
• [設定値 ] :
設定値 説明
32～65535 セッション数
none 制限しない
• [初期値 ] :
• 15000 (RTX5000 / RTX3500 Rev.14.00.12 以降、 Rev.14.01 系以降 )
• 1000 ( 上記以外 )
[説明 ]
ルーターが端点となる  TCP のセッション数を制限する。160 | コマンドリファレンス  | IP の設定

none を選択した場合には制限を設けない。
[ノート ]
ルーターと直接通信しない場合にはこの制限は適用されない。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.24 IPv4 の経路情報に変化があった時にログに記録するか否かの設定
[書式 ]
ip route  change  log log
no ip route  change  log [log]
[設定値及び初期値 ]
•log
• [設定値 ] :
設定値 説明
on IPv4 経路の変化をログに記録する
off IPv4 経路の変化をログに記録しない
• [初期値 ] : off
[説明 ]
IPv4 の経路情報に変化があった時にそれをログに記録するか否かを設定する。
ログは  INFO レベルで記録される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.25 フィルタリングによるセキュリティーの設定
[書式 ]
ip interface  secure  filter  direction  [filter_list ...] [dynamic filter_list ...]
ip pp secure  filter  direction  [filter_list ...] [dynamic filter_list ...]
ip tunnel  secure  filter  direction  [filter_list ...] [dynamic filter_list ...]
ip interface  secure  filter  name  set_name
ip pp secure  filter  name  set_name
ip tunnel  secure  filter  name  set_name
no ip interface  secure  filter  direction  [filter_list ]
no ip pp secure  filter  direction  [filter_list ]
no ip tunnel  secure  filter  direction  [filter_list ]
no ip interface  secure  filter  name  [set_name ]
no ip pp secure  filter  name  [set_name ]
no ip tunnel  secure  filter  name  [set_name ]
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インターフェース名
• WAN インターフェース名
• vRX シリーズ  では指定不可能
• LOOPBACK インターフェース名
• NULL インターフェース名
•ブリッジインターフェース名
• [初期値 ] : -
•direction
• [設定値 ] :コマンドリファレンス  | IP の設定  | 161

設定値 説明
in 受信したパケットのフィルタリング
out 送信するパケットのフィルタリング
• [初期値 ] : -
•filter_list
• [設定値 ] : 空白で区切られたフィルター番号の並び  ( 静的フィルターと動的フィルターの数の合計として、
vRX シリーズ、 RTX5000 、RTX3510 、および  RTX3500 は 300 個以内、他の機種は  129 個以内  )
• [初期値 ] : -
•set_name
• [設定値 ] : フィルターセットの名前を表す文字列
• [初期値 ] : -
• dynamic : キーワード後に動的フィルターの番号を記述する
• [初期値 ] : -
[説明 ]
ip filter  コマンドによるパケットのフィルターを組み合わせて、インターフェースで送受信するパケットの種類を制
限する
方向を指定する書式では、それぞれの方向に対して適用するフィルター列をフィルター番号で指定する。指定され
た番号のフィルターが順番に適用され、パケットにマッチするフィルターが見つかればそのフィルターにより通過 /
破棄が決定する。それ以降のフィルターは調べられない。すべてのフィルターにマッチしないパケットは破棄され
る。
フィルターセットの名前を指定する書式では、指定されたフィルターセットが適用される。フィルターを調べる順
序などは方向を指定する書式の方法に準ずる。定義されていないフィルターセットの名前が指定された場合には、
フィルターは設定されていないものとして動作する。
[ノート ]
フィルターリストを走査して、一致すると通過、破棄が決定する。
# ip filter 1 pass 192.168.0.0/24 *
# ip filter 2 reject 192.168.0.1
# ip lan1 secure filter in 1 2
この設定では、始点  IP アドレスが  192.168.0.1 であるパケットは、最初のフィルター  1 で通過が決定してしまうた
め、フィルター  2 での検査は行われない。そのため、フィルター  2 は何も意味を持たない。
フィルターリストを操作した結果、どのフィルターにも一致しないパケットは破棄される。
PP Anonymous で認証に  RADIUS を利用する場合で、 RADIUS サーバーから送られた  Access-Response にアトリビュ
ート  'Filter-Id' がついていた場合には、その値に指定されたフィルターセットを適用し、 ip pp secure filter  コマンド
の設定は無視される。
ただしアトリビュート  "Filter-Id" が存在しない場合には、 ip pp secure filter  コマンドの設定がフィルターとして利用
される。
LOOPBACK インターフェースと  NULL インターフェースでは動的フィルターは使用できない。
NULL インターフェースで direction  に 'in' は指定できない。
ブリッジインターフェースは、 vRX Amazon EC2 版、および  RTX5000 / RTX3500 Rev.14.00.11 以前では指定不可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.26 ルールに一致する  IP パケットの  DF ビットを  0 に書き換えるか否かの設定
[書式 ]
ip fragment  remove  df-bit  rule
no ip fragment  remove  df-bit  [rule]
[設定値及び初期値 ]
•rule
• [設定値 ] :162 | コマンドリファレンス  | IP の設定

設定値 説明
filter filter_num filter_num はip filter  コマンドで登録されたフィルタ
番号
• [初期値 ] : -
[説明 ]
フォワーディングする  IP パケットの内、 ruleに一致するものは  DF ビットを  0 に書き換える。
[ノート ]
DF ビットは経路  MTU 探索アルゴリズムで利用されるが、経路の途中に  ICMP パケットをフィルタするファイアウ
ォールなどがあるとアルゴリズムがうまく動作せず、特定の通信相手とだけは通信ができないなどの現象になるこ
とがある。この様な現象は、 「経路  MTU 探索ブラックホール  (Path MTU Discovery Blackhole) 」と呼ばれている。こ
の経路  MTU 探索ブラックホールがある場合には、このコマンドでそのような相手との通信に関して  DF ビットを  0
に書き換えてしまえば、経路  MTU 探索は正しく動作しなくなるものの、通信できなくなるということはなくなる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.27 IP パケットの  TOS フィールドの書き換えの設定
[書式 ]
ip tos supersede  id tos [precedence= precedence ] filter_num  [filter_num_list ]
no ip tos supersede  id [tos]
[設定値及び初期値 ]
•id
• [設定値 ] : 識別番号  (1..65535)
• [初期値 ] : -
•tos
• [設定値 ] :
•書き換える  TOS 値 (0..15)
•以下のニーモニックが利用できる
ニーモニック TOS 値
normal 0
min-monetary-cost 1
max-reliability 2
max-throughput 4
min-delay 8
• [初期値 ] : -
•precedence
• [設定値 ] :
• precedence 値 (0..7)
• precedence を省略した場合､ PRECEDENCE 値は変更しない
• [初期値 ] : -
•filter_num
• [設定値 ] : 静的フィルタの番号  (1..21474836)
• [初期値 ] : -
•filter_num_list
• [設定値 ] : 静的フィルタの番号  (1..21474836) の並び
• [初期値 ] : -
[説明 ]
IP パケットを中継する場合に  TOS フィールドを指定した値に書き換える。コマンドリファレンス  | IP の設定  | 163

識別番号順にリストをチェックし、 filter_num  リストのフィルタを順次適用していく。そして、最初にマッチした  IP
フィルタが  pass、pass-log、pass-nolog 、restrict、restrict-log 、restrict-nolog のいずれかであれば  TOS フィールドが書き
換えられる。
reject、reject-log または  reject-nolog である場合は書き換えずに処理を終わる。
ip dscp supersede  コマンドの設定と本コマンドの設定で条件が同じ場合、 ip dscp supersede  コマンドの設定が優先さ
れる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.28 代理  ARP の設定
[書式 ]
ip interface  proxyarp  proxyarp
ip interface  proxyarp  vrrp  vrid
no ip interface  proxyarp  [proxyarp ]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名、ブリッジインタフェース名
• [初期値 ] : -
•proxyarp
• [設定値 ] :
設定値 説明
on 代理  ARP 動作をする
off 代理  ARP 動作をしない
• [初期値 ] : off
•vrid
• [設定値 ] : VRRP グループ  ID (1..255)
• [初期値 ] : -
[説明 ]
代理  ARP 動作をするか否か設定する。 on を設定した時には、代理  ARP 動作を行う。この時利用する  MAC アドレ
スは、 LAN インタフェースの実  MAC アドレスとなる。  ブリッジインタフェースを指定した時には、  ブリッジイン
タフェースに収容された実  LAN インタフェースにおいて、代理  ARP 動作をするか否か設定する。この時利用する
MAC アドレスは  ARP を受信した実  LAN インタフェースの  MAC アドレスとなる。
第 2 書式を設定した時には、指定された  VRID での  VRRP の状態がマスターである場合のみ代理  ARP 動作を行う。
利用する  MAC アドレスは指定された  VRID の仮想  MAC アドレスとなる。
[ノート ]
第 2 書式は、 vRX Amazon EC2 版、および  vRX さくらのクラウド版  では使用不可能。
ブリッジインタフェースは、 vRX Amazon EC2 版、および  RTX5000 / RTX3500 Rev.14.00.11 以前では指定不可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.29 ARP エントリの寿命の設定
[書式 ]
ip arp timer  timer  [retry ]
no ip arp timer  [timer  [retry ]]
[設定値及び初期値 ]
•timer
• [設定値 ] : ARP エントリの寿命秒数  (30..32767)
• [初期値 ] : 1200
•retry164 | コマンドリファレンス  | IP の設定

• [設定値 ] : ARP リクエスト再送回数  (4..100)
• [初期値 ] : 4
[説明 ]
ARP エントリの寿命を設定する。 ARP 手順で得られた  IP アドレスと  MAC アドレスの組は  ARP エントリとして記
憶するが、このコマンドで設定した時間だけ経過すると再度  ARP 手順が実行し、その  ARP に応答が無い場合にエ
ントリを消す。
retryパラメーターで  ARP リクエストの再送回数を設定できる。 ARP リクエストの再送間隔は初回は  2 秒、 その後は
1 秒である。
retryパラメーターについては、通常は初期値から変更する必要はない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.30 静的  ARP エントリの設定
[書式 ]
ip interface  arp static  ip_address  mac_address  [mtu= mtu]
no ip interface  arp static  ip_address [...]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•ip_address
• [設定値 ] : IP アドレス
• [初期値 ] : -
•mac_address
• [設定値 ] : MAC アドレス
• [初期値 ] : -
•mtu
• [設定値 ] :
設定値 説明
interface インタフェースの  MTU の値を利用する
discovery MTU 探索機能を使用して値を設定する
64..9578 (RTX5000 、RTX3500 の LAN インタフェー
ス )
MTU 値 64..10218 (RTX3510 、RTX1300 の LAN インタフェー
ス )
64..1500 ( 上記以外  )
• [初期値 ] : -
[説明 ]
ARP エントリを静的に設定する。このコマンドで設定された  ARP エントリは、 show arp  コマンドで  TTL が
'permanent' と表示され、常に有効となる。また、 clear arp  コマンドを実行してもエントリは消えない。
mtu オプションに  discovery を設定すると、 ARP による  MTU 探索機能が動作する。
mtu オプションを省略した時には、インタフェースの  MTU を固定で利用する。
[ノート ]
mtu オプションは、 RTX5000 、RTX3510 、RTX3500 、RTX1300 で指定可能。
mtu オプションに  discovery を設定した場合には、探索を行う時に対象のホストと通信できる状況になっている必要コマンドリファレンス  | IP の設定  | 165

があるため、その時点で対象のホストが接続されていないなど通信できない状況の場合には、 MTU 探索に失敗し、
デフォルトである  1500 バイトを  MTU として利用するようになる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.31 ARP が解決されるまでの間に送信を保留しておくパケットの数を制御する
[書式 ]
ip interface  arp queue  length  len
no ip interface  arp queue  length  [len]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•len
• [設定値 ] : キュー長  (0..10000)
• [初期値 ] :
• 200 (1000BASE-T インタフェース対応機種  )
• 40 ( ファストパス機能対応機種  )
• 200 ( ファストパス機能未対応機種  )
[説明 ]
ARP が解決していないホストに対してパケットを送信しようとした時に、 ARP が解決するか、タイムアウトにより
ARP が解決できないことが確定するまで、インタフェース毎に送信を保留しておくことのできるパケットの最大数
を設定する。
0 を設定するとパケットを保留しなくなるため、例えば  ARP が解決していない相手に  ping を実行すると必ず最初の
1 パケットは失敗するようになる。
[ノート ]
このコマンドが新設される以前のバージョンでは、送信を保留する数の上限は設定されておらず、いくらでも保留
することができた。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.32 ARP エントリの変化をログに残すか否かの設定
[書式 ]
ip interface  arp log switch
no ip interface  arp log [switch ]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on 記録する
off 記録しない
• [初期値 ] : off
[説明 ]
ARP エントリの変更をログに記録するか否かを設定する
[ノート ]
show log | grep ARP: を実行することによって、過去の  ARP エントリ履歴を確認することができる。166 | コマンドリファレンス  | IP の設定

[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.33 implicit 経路の優先度の設定
[書式 ]
ip implicit-route  preference  preference
no ip implicit-route  preference  [preference ]
[設定値及び初期値 ]
•preference
• [設定値 ] : implicit 経路の優先度  (1..2147483647)
• [初期値 ] : 10000
[説明 ]
implicit 経路の優先度を設定する。
優先度は  1 以上の整数で示され、数字が大きいほど優先度が高い。
implicit 経路が動的経路制御プロトコルで得られた経路または ip route  コマンドで設定された静的な経路と食い違う
場合には、優先度が高い方が採用される。静的な経路と優先度が同じ場合には、静的な経路が優先される。
動的経路制御プロトコルで得られた経路と優先度が同じ場合には、時間的に先に採用された経路が有効となる。
なお、 ip implicit-route preference  コマンドで  implicit 経路の優先度を変更しても、その時点で既にルーティングテー
ブルに登録されている  implicit 経路の優先度は変更されない。
[ノート ]
implicit 経路とは、 IP アドレスを設定したインタフェースが有効な状態になったときに暗黙のうちに登録されるその
インタフェースを経由する経路のことである。例えば、 IP アドレスを設定した  LAN インタフェースがリンクアップ
状態のときには、設定した  IP アドレスとネットマスクの組み合わせから決定されるネットワークアドレスが、その
LAN インタフェースを経由する  implicit 経路として登録されている。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.34 フローテーブルの各エントリの寿命を設定する
[書式 ]
ip flow timer  protocol  time
no ip flow timer  protocol  [time]
[設定値及び初期値 ]
•protocol  : 寿命を指定するプロトコル
• [設定値 ] :
設定値 説明
tcp TCP パケット
udp UDP パケット
icmp ICMP パケット
slow FIN/RST ビットのセットされた  TCP パケット
• [初期値 ] :
• tcp = 900
• udp = 30
• icmp = 30
• slow =
• 5 ( 下記以外  )
• 30 ( vRX Amazon EC2 版、 vRX VMware ESXi 版、 RTX5000 、RTX3500 、RTX1300 Rev.23.00.04 以前、
RTX1220 、RTX1210 、および  RTX830 Rev.15.02.26 以前  )
•time
• [設定値 ] : 秒数  (1-21474836)コマンドリファレンス  | IP の設定  | 167

• [初期値 ] : -
[説明 ]
フローテーブルの各エントリの寿命をプロトコル毎に設定する。
FIN/RST の通過したエントリには  'slow' が適用される。
NAT や動的フィルタを使用している場合には、それらのエントリの寿命が適用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.35 フローテーブルのエントリー数の設定
[書式 ]
ip flow limit  limit
no ip flow limit  [limit]
[設定値及び初期値 ]
•limit : エントリー数の制限値
• [設定値 ] :
設定値 説明
10..1000000 vRX Amazon EC2 版 通常モード、 vRX VMware ESXi
版 通常モード、 vRX さくらのクラウド版、 RTX3510
で設定可能
10..500000 RTX1300 で設定可能
10..300000 RTX840 で設定可能
10..131072 上記以外の機種で設定可能
• [初期値 ] :
• 1000000 (vRX Amazon EC2 版 通常モード、 vRX VMware ESXi 版 通常モード、 RTX3510)
• 500000 (RTX1300)
• 300000 (RTX840)
• 131072 ( 上記以外 )
[説明 ]
IPv4 ファストパスまたは  IPv6 ファストパスのそれぞれで使用可能なフローテーブルのエントリー数を設定する。
ファストパス機能使用時でも本制限値を超える分のフローはノーマルパスで処理される。
[ノート ]
RTX5000 / RTX3500 Rev.14.00.11 以前では使用不可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.36 フラグメントパケットを再構成するために保持しておく時間を設定
[書式 ]
ip reassembly  hold-time  time
no ip reassembly  hold-time  [time]
[設定値及び初期値 ]
•time
• [設定値 ] :
設定値 説明
秒数  ( 1 .. 255 ) フラグメントパケットを再構成するために保持して
おく時間
• [初期値 ] : 15 秒168 | コマンドリファレンス  | IP の設定

[説明 ]
IPv4 のフラグメントパケットを再構成するために保持しておく時間。
設定した時間が経過しても再構成ができなかった場合、保持していたパケットは破棄される。
コマンド実行時にすでに保持していたパケットについては変更しない。
[ノート ]
RTX5000 、RTX3500 は Rev.14.00.29 以降で使用可能。
RTX1210 は Rev.14.01.34 以降で使用可能。
RTX830 は Rev.15.02.10 以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.1.37 IP パケットの  DS フィールドの書き換えの設定
[書式 ]
ip dscp  supersede  id dscp filter_num  [filter_num_list ]
no ip dscp  supersede  id [dscp]
[設定値及び初期値 ]
•id
• [設定値 ] : 識別番号  (1..65535)
• [初期値 ] : -
•dscp
• [設定値 ] :
•書き換える  DSCP 値 (0..63)
•以下のニーモニックが利用できる
ニーモニック DSCP 値
default 0
cs1 8
cs2 16
cs3 24
cs4 32
cs5 40
cs6 48
cs7 56
af11 10
af12 12
af13 14
af21 18
af22 20
af23 22
af31 26
af32 28
af33 30
af41 34
af42 36コマンドリファレンス  | IP の設定  | 169

ニーモニック DSCP 値
af43 38
ef 46
• [初期値 ] : -
•filter_num
• [設定値 ] : 静的フィルターの番号  (1..21474836)
• [初期値 ] : -
•filter_num_list
• [設定値 ] : 静的フィルターの番号  (1..21474836) の並び
• [初期値 ] : -
[説明 ]
IP パケットを中継する場合に  DS フィールドを指定した値に書き換える。
識別番号順にリストをチェックし、 filter_num  リストのフィルターを順次適用していく。そして、最初にマッチした
IP フィルターが  pass、pass-log、pass-nolog 、restrict、restrict-log 、restrict-nolog のいずれかであれば  DS フィールドが
書き換えられる。
reject、reject-log または  reject-nolog である場合は書き換えずに処理を終わる。
ip tos supersede  の設定と本コマンドの設定で条件が同じ場合、本コマンドの設定が優先される。
[ノート ]
RTX5000 / RTX3500 Rev.14.00.33 以前、 RTX1300 Rev.23.00.04 以前、 RTX1220 Rev.15.04.04 以前、 RTX1210 Rev.14.01.41
以前、および  RTX830 Rev.15.02.26 以前では使用不可能。
[適用モデル ]
vRX さくらのクラウド版 , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.2 PP 側の設定
8.2.1 PP 側 IP アドレスの設定
[書式 ]
ip pp remote  address  ip_address
ip pp remote  address  dhcpc [ interface ]
no ip pp remote  address  [ip_address ]
[設定値及び初期値 ]
•ip_address
• [設定値 ] :
設定値 説明
IP アドレス xxx.xxx.xxx.xxx (xxx は十進数  )
dhcp DHCP クライアントを利用することを示すキーワー
ド
• [初期値 ] : -
• dhcpc : DHCP クライアントを利用することを示すキーワード
• [初期値 ] : -
•interface
• [設定値 ] :
• DHCP クライアントとして動作する  LAN インタフェース名
•省略時は  lan1
• [初期値 ] : -170 | コマンドリファレンス  | IP の設定

[説明 ]
選択されている相手の  PP 側の  IP アドレスを設定する。
dhcp を設定した場合は、自分自身が  DHCP サーバーとして動作している必要がある。自分で管理している  DHCP ス
コープの中から、 IP アドレスを割り当てる。
装着されている  BRI/PRI インタフェースで利用できる  ISDN Bch の数まで設定できる。
dhcpc を設定した場合は、 interface  で指定した  LAN インタフェースが  DHCP クライアントとして  IP アドレスを取得
し、そのアドレスを  PP 側に割り当てる。取得できなかった場合は、 0.0.0.0 を割り当てる。
[設定例 ]
ルーター A 側が
no ip pp remote address
ppp ipcp ipaddress  on
と設定し、接続するルーター B 側が
ip pp remote address  yyy.yyy.yyy.yyy
と設定している場合には、実際のルーター A の PP 側の  IP アドレスは  "yyy.yyy.yyy.yyy" になる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.2.2 リモート  IP アドレスプールの設定
[書式 ]
ip pp remote  address  pool ip_address  [ip_address ...]
ip pp remote  address  pool ip_address-ip_address
ip pp remote  address  pool dhcp
ip pp remote  address  pool dhcpc [ interface ]
no ip pp remote  address  pool
[設定値及び初期値 ]
•ip_address
• [設定値 ] : anonymous のためにプールする  IP アドレス
• [初期値 ] : -
•ip_address-ip_address
• [設定値 ] : IP アドレスの範囲
• [初期値 ] : -
• dhcp : 自分自身の  DHCP サーバー機能を利用することを示すキーワード
• [初期値 ] : -
• dhcpc : DHCP クライアントを利用することを示すキーワード
• [初期値 ] : -
•interface
• [設定値 ] :
• DHCP クライアントとして動作する  LAN インタフェース名
•省略時は  lan1
• [初期値 ] : -
[説明 ]
anonymous で相手に割り当てるための  IP アドレスプールを設定する。 PP として  anonymous が選択された場合のみ
有効である。
dhcp を設定した場合は、自分自身が  DHCP サーバーとして動作している必要がある。自分で管理している  DHCP ス
コープの中から、 IP アドレスを割り当てる。
dhcpc を設定した場合は、 interface  で指定した  LAN インタフェースが  DHCP クライアントとして  IP アドレス情報の
みを取得し、そのアドレスを割り当てる。取得できなかった場合は、 0.0.0.0 を割り当てる。コマンドリファレンス  | IP の設定  | 171

[ノート ]
ip_address  として設定できる数は下記の通り。
機種 リビジョン 最大設定可能数
vRX シリーズ すべてのリビジョン 1040
RTX5000 すべてのリビジョン 3104
RTX3510 すべてのリビジョン 1104
RTX3500 すべてのリビジョン 1104
RTX1300 すべてのリビジョン 101
RTX1220 すべてのリビジョン 101
RTX1210 すべてのリビジョン 103
RTX840 すべてのリビジョン 32
RTX830 すべてのリビジョン 32
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、プールできる  IPアドレス  (ip_address ) の最大個数が拡張される。
•ip_address
ライセンス名拡張後の最大個数
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 101 - - - -
YSL-VPN-EX2 301 501 701 901 1101
YSL-VPN-EX3 1541 2041 2541 3041 -
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.2.3 PP 経由のキープアライブの時間間隔の設定
[書式 ]
pp keepalive  interval  interval  [retry-interval= retry-interval ] [count= count ] [time= time]
no pp keepalive  interval  [interval  [count ]]
[設定値及び初期値 ]
•interval
• [設定値 ] : キープアライブパケットを送出する時間間隔 [秒] (1..65535)
• [初期値 ] : 30
•retry-interval
• [設定値 ] :
•キープアライブパケットの確認に一度失敗した後の送信間隔 [秒] (1..65535)
•キープアライブパケットが確認できれば、送信間隔はまた interval  に戻る
• [初期値 ] : 1
•count
• [設定値 ] : この回数連続して応答がなければ相手側のルーターをダウンしたと判定する  (3..100)
• [初期値 ] : 6
•time
• [設定値 ] :
•キープアライブパケットの確認に失敗するようになってから回線断と判断するまでの時間 [秒] ((interval  +
1)..65535)
•count  パラメータとは同時には指定できない172 | コマンドリファレンス  | IP の設定

• [初期値 ] : -
[説明 ]
PP インタフェースでのキープアライブパケットの送信間隔と、回線断と判定するまでの再送回数および時間を設定
する。
送信したキープアライブパケットに対して返事が返って来ている間は interval  で指定した間隔でキープアライブパ
ケットを送信する。一度、返事が確認できなかった時には送信間隔が  retry-interval パラメータの値に変更される。
count  パラメータに示された回数だけ連続して返事が確認できなかった時には回線断と判定する。
回線断判定までの時間を time パラメータで指定した場合には、少なくとも指定した時間の間、キープアライブパケ
ットの返事が連続して確認できない時に回線断と判定する。
[ノート ]
time パラメータを指定した場合には、その値はキープアライブの間隔と再送回数によって再計算されるため、設定
値とは異なる値が show config  で表示されることがある。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.2.4 PP 経由のキープアライブを使用するか否かの設定
[書式 ]
pp keepalive  use lcp-echo
pp keepalive  use icmp-echo dest_ip  [option =value ...] [dest_ip  [option =value ...]...]
pp keepalive  use lcp-echo icmp-echo dest_ip  [option =value ...] [dest_ip  [option =value ...]...]
pp keepalive  use off
no pp keepalive  use
[設定値及び初期値 ]
• lcp-echo : LCP Echo Request/Reply を用いる
• [初期値 ] : -
• icmp-echo : ICMP Echo/Reply を用いる
• [初期値 ] : -
•dest_ip
• [設定値 ] : キープアライブ確認先の  IP アドレス
• [初期値 ] : -
•option=value 列
• [設定値 ] :
option value 説明
upwait ミリ秒アップ検知のための許容応答時間
(1..10000)
downwait ミリ秒ダウン検知のための許容応答時間
(1..10000)
disconnect 秒 無応答切断時間  (1..21474836)
length バイトICMP Echo パケットの長さ
(64-1500)
• [初期値 ] : -
[初期設定 ]
pp keepalive use off
[説明 ]
選択した相手先に対する接続のキープアライブ動作を設定する。
lcp-echo 指定で、 LCP Echo Request/Reply を用い、 icmp-echo も指定すれば  ICMP Echo/Reply も同時に用いる。  icmp-
echo を使用する場合には、 IP アドレスの設定が必要である。コマンドリファレンス  | IP の設定  | 173

[ノート ]
このコマンドを設定していない場合でも、 pp always-on  コマンドで  on と設定していれば、 LCP Echo によるキープア
ライブが実行される。
icmp-echo で確認する  IP アドレスに対する経路は、設定される  PP インタフェースが送出先となるよう設定される必
要がある。
downwait パラメータで応答時間を制限する場合でも、 pp keepalive interval  コマンドの設定値の方が小さい場合に
は、 pp keepalive interval  コマンドの設定値が優先される。 downwait 、upwait パラメータのうち一方しか設定してい
ない場合には、他方も同じ値が設定されたものとして動作する。
disconnect パラメータは、 PPPoE で使用する場合に  PPPoE レベルでの再接続が必要な場合に使用する。 disconnect パ
ラメータが設定されている場合に、設定時間内に  icmp-echo の応答がない場合、 PPPoE レベルで一度切断操作を行う
ため、 pp always-on  コマンドとの併用により再接続を行うことができる。
他のパラメータがデフォルト値の場合、 disconnect パラメータは  70 秒程度に設定しておくと、ダウン検出後の切断
動作が確実に行われる。
length パラメータで指定するのは  ICMP データ部分の長さであり、 IP パケット全体の長さではない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.2.5 PP 経由のキープアライブのログをとるか否かの設定
[書式 ]
pp keepalive  log log
no pp keepalive  log [log]
[設定値及び初期値 ]
•log
• [設定値 ] :
設定値 説明
on ログをとる
off ログをとらない
• [初期値 ] : off
[説明 ]
PP 経由のキープアライブをログにとるか否かを設定する。
[ノート ]
この設定は、すべての  PP で共通に用いられる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.2.6 専用線ダウン検出時の動作の設定
[書式 ]
leased  keepalive  down  action
no leased  keepalive  down  [action ]
[設定値及び初期値 ]
•action
• [設定値 ] :
設定値 説明
silent 何もしない
reset ルーターを再起動する
• [初期値 ] : silent
[説明 ]
キープアライブによって専用線ダウンを検出した場合のルーターの動作を設定する。174 | コマンドリファレンス  | IP の設定

[適用モデル ]
RTX5000, RTX3500, RTX1210
8.3 RIP の設定
8.3.1 RIP を使用するか否かの設定
[書式 ]
rip use use
no rip use [use]
[設定値及び初期値 ]
•use
• [設定値 ] :
設定値 説明
on RIP を使用する
off RIP を使用しない
• [初期値 ] : off
[説明 ]
RIP を使用するか否かを設定する。この機能を  OFF にすると、すべてのインタフェースに対して  RIP パケットを送
信することはなくなり、受信した  RIP パケットは無視される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.2 RIP に関して信用できるゲートウェイの設定
[書式 ]
ip interface  rip trust  gateway  [except] gateway  [gateway ...]
ip pp rip trust  gateway  [except] gateway  [gateway ...]
ip tunnel  rip trust  gateway  [except] gateway  [gateway ...]
no ip interface  rip trust  gateway  [[except] gateway  [gateway ...]]
no ip pp rip trust  gateway  [[except] gateway  [gateway ...]]
no ip tunnel  rip trust  gateway  [[except] gateway  [gateway ...]]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•gateway
• [設定値 ] : IP アドレス
• [初期値 ] : -
[説明 ]
RIP に関して信用できる、あるいは信用できないゲートウェイを設定する。
except キーワードを指定していない場合には、列挙したゲートウェイを信用できるゲートウェイとし、それらから
の RIP だけを受信する。
except キーワードを指定した場合は、列挙したゲートウェイを信用できないゲートウェイとし、それらを除いた他
のゲートウェイからの  RIP だけを受信する。
gatewayは10個まで指定可能。
[ノート ]
信用できる、あるいは信用できないゲートウェイは設定されておらず、すべてのホストからの  RIP を信用できるも
のとして扱う。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | IP の設定  | 175

8.3.3 RIP による経路の優先度の設定
[書式 ]
rip preference  preference  [invalid-route-reactivate= switch ]
no rip preference  [preference  [invalid-route-reactivate= switch ]]
[設定値及び初期値 ]
•preference
• [設定値 ] : 1 以上の数値
• [初期値 ] : 1000
•switch
• [設定値 ] :
設定値 説明
on 無効となった RIP由来の経路を削除しない
off 無効となった RIP由来の経路を削除する
• [初期値 ] : off
[説明 ]
RIP により得られた経路の優先度を設定する。経路の優先度は  1 以上の数値で表され、数字が大きい程優先度が高
い。スタティックと  RIP など複数のプロトコルで得られた経路が食い違う場合には、優先度が高い方が採用される。
優先度が同じ場合には時間的に先に採用された経路が有効となる。
RIPで他のルーターから経路を受信しているとき、 スタティックや OSPFなど RIPより優先度が高く設定されたルー
ティングプロトコルで同じ経路を受信した場合、 通常 RIPにより受信した経路は無効となって削除されるが、 invalid-
route-reactivate オプションを onで指定している場合、優先度が高い経路が消滅したときに無効になっていた RIP由
来の経路を再有効化する。
[ノート ]
スタティック経路の優先度は  10000 で固定である。
invalid-route-reactivate オプションを onで指定しているとき、再有効化した経路を RIPの発信元が広告しなくなって
も当該経路がルーティングテーブル上に残り続けることがあるため、 invalid-route-reactivate オプションは offにする
ことが望ましい。
なお、上記のルーティングテーブルに残った経路は、 RIPの使用を停止することで削除できる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.4 RIP パケットの送信に関する設定
[書式 ]
ip interface  rip send  send [version version  [broadcast ]]
ip pp rip send  send [version version  [broadcast ]]
ip tunnel  rip send  send [version version  [broadcast ]]
no ip interface  rip send  [send...]
no ip pp rip send  [send...]
no ip tunnel  rip send  [send...]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•send
• [設定値 ] :
設定値 説明
on RIP パケットを送信する
off RIP パケットを送信しない176 | コマンドリファレンス  | IP の設定

• [初期値 ] :
• off ( トンネルインタフェースの場合  )
• on ( その他のインタフェースの場合  )
•version
• [設定値 ] : 送信する  RIP のバージョン  (1,2)
• [初期値 ] :
• vRX さくらのクラウド版
• 2 ( LAN インターフェース  )
• 1 ( その他のインターフェース  )
•その他の機種
• 1
•broadcast
• [設定値 ] : ip interface  address  コマンドで指定したブロードキャスト  IP アドレス
• [初期値 ] : -
[説明 ]
指定したインタフェースに対し、 RIP パケットを送信するか否かを設定する。
"version version " で送信する  RIP のバージョンを指定できる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.5 RIP パケットの受信に関する設定
[書式 ]
ip interface  rip receive  receive  [version version  [version ]]
ip pp rip receive  receive  [version version  [version ]]
ip tunnel  rip receive  receive  [version version  [version ]]
no ip interface  rip receive  [receive ...]
no ip pp rip receive  [receive ...]
no ip tunnel  rip receive  [receive ...]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•receive
• [設定値 ] :
設定値 説明
on RIP パケットを受信する
off RIP パケットを受信しない
• [初期値 ] :
• off( トンネルインタフェースの場合  )
• on ( その他のインタフェースの場合  )
•version
• [設定値 ] : 受信する  RIP のバージョン  (1,2)
• [初期値 ] : 1 2 ( トンネルインターフェース以外の場合  )
[説明 ]
指定したインタフェースに対し、 RIP パケットを受信するか否かを設定する。
"version version " で受信する  RIP のバージョンを指定できる。指定しない場合は、 RIP1/2 ともに受信する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | IP の設定  | 177

8.3.6 RIP のフィルタリングの設定
[書式 ]
ip interface  rip filter  direction  filter_list
ip pp rip filter  direction  filter_list
ip tunnel  rip filter  direction  filter_list
no ip interface  rip filter  direction  [filter_list ]
no ip pp rip filter  direction  filter_list
no ip tunnel  rip filter  direction  filter_list
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•direction
• [設定値 ] :
設定値 説明
in 受信した  RIP のフィルタリング
out 送信する  RIP のフィルタリング
• [初期値 ] : -
•filter_list
• [設定値 ] : 空白で区切られた静的フィルタ番号の並び  (100 個以内  )
• [初期値 ] : -
[説明 ]
インタフェースで送受信する  RIP のフィルタリングを設定する。
ip filter  コマンドで設定されたフィルタの始点  IP アドレスが、送受信する  RIP の経路情報にマッチする場合は、フ
ィルタが  pass であればそれを処理し、  reject であればその経路情報だけを破棄する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.7 RIP で加算するホップ数の設定
[書式 ]
ip interface  rip hop direction  hop
ip pp rip hop direction  hop
ip tunnel  rip hop direction  hop
no ip interface  rip hop direction  hop
no ip pp rip hop direction  hop
no ip tunnel  rip hop direction  hop
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•direction
• [設定値 ] :
設定値 説明
in 受信した  RIP に加算する
out 送信する  RIP に加算する
• [初期値 ] : -
•hop
• [設定値 ] : 加算する値  (0..15)178 | コマンドリファレンス  | IP の設定

• [初期値 ] : 0
[説明 ]
インタフェースで送受信する  RIP に加算するホップ数を設定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.8 RIP2 での認証の設定
[書式 ]
ip interface  rip auth  type type
ip pp rip auth  type type
ip tunnel  rip auth  type type
no ip interface  rip auth  type [type]
no ip pp rip auth  type [type]
no ip tunnel  rip auth  type [type]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•type
• [設定値 ] :
設定値 説明
text テキスト型の認証を行う
• [初期値 ] : -
[説明 ]
RIP2 を使用する場合のインタフェースでの認証の設定をする。 text の場合はテキスト型の認証を行う。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.9 RIP2 での認証キーの設定
[書式 ]
ip interface  rip auth  key hex_key
ip pp rip auth  key hex_key
ip tunnel  rip auth  key hex_key
ip interface  rip auth  key text text_key
ip pp rip auth  key text text_key
ip tunnel  rip auth  key text text_key
no ip interface  rip auth  key
no ip pp rip auth  key
no ip tunnel  rip auth  key
no ip interface  rip auth  key text
no ip pp rip auth  key text
no ip tunnel  rip auth  key text
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•hex_key
• [設定値 ] : 十六進数の列で表現された認証キー
• [初期値 ] : -
•text_keyコマンドリファレンス  | IP の設定  | 179

• [設定値 ] : 文字列で表現された認証キー
• [初期値 ] : -
[説明 ]
RIP2 を使用する場合のインタフェースの認証キーを設定する。
[設定例 ]
# ip lan1 rip auth key text testing123
# ip pp rip auth key text "hello world"
# ip lan2 rip auth key 01 02 ff 35 8e 49 a8 3a 5e 9d
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.10 RIP2 での広告動作モードの設定
[書式 ]
rip advertise  mode  mode
no rip advertise  mode  [mode ]
[設定値及び初期値 ]
•mode
• [設定値 ] :
設定値 説明
1 RIPの送信インターフェースが属するネットワーク
アドレスと広告する経路の宛先ネットワークアドレ
スが一致し、サブネットマスクが異なる場合は、その
経路を広告しない。
2 RIPの送信インターフェースが属するネットワーク
アドレスと広告する経路の宛先ネットワークアドレ
スが一致し、サブネットマスクが異なる場合は、その
経路を広告する。
• [初期値 ] :
• 2( RTX3510 、RTX1300 、RTX840 )
• 1( 上記以外  )
[説明 ]
RIP2でRIP送信インターフェースが属するネットワークアドレスと広告する経路の宛先ネットワークアドレスが
一致し、サブネットマスクが異なる場合、当該経路の広告動作を mode  の設定値によって変更する。
本コマンドに対応していないリビジョンでは、 mode  の設定値が 1のときの動作をする。
RIP1の動作には影響はない。
[ノート ]
RTX5000 は Rev.14.00.32 以降で使用可能
RTX3500 は Rev.14.00.32 以降で使用可能
RTX1210 は Rev.14.01.36 以降で使用可能
RTX830 は Rev.15.02.15 以降で使用可能
[適用モデル ]
vRX VMware ESXi 版, vRX さくらのクラウド版 , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210,
RTX840, RTX830
8.3.11 回線切断時の経路保持の設定
[書式 ]
ip pp rip hold  routing  rip_hold
no ip pp rip hold  routing  [rip_hold ]180 | コマンドリファレンス  | IP の設定

[設定値及び初期値 ]
•rip_hold
• [設定値 ] :
設定値 説明
on 回線が切断されても  RIP による経路を保持し続ける
off 回線が切断されたら  RIP による経路を破棄する
• [初期値 ] : off
[説明 ]
PP インタフェースから  RIP で得られた経路を、回線が切断された場合に保持し続けるかどうかを設定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.12 回線接続時の  PP 側の  RIP の動作の設定
[書式 ]
ip pp rip connect  send  rip_action
no ip pp rip connect  send  [rip_action ]
[設定値及び初期値 ]
•rip_action
• [設定値 ] :
設定値 説明
interval ip pp rip connect interval  コマンドで設定された時間
間隔で  RIP を送出する
update 経路情報が変わった場合にのみ  RIP を送出する
none RIP を送出しない
• [初期値 ] : update
[説明 ]
選択されている相手について回線接続時に  RIP を送出する条件を設定する。
[設定例 ]
# ip pp rip connect interval 60
# ip pp rip connect send interval
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.13 回線接続時の  PP 側の  RIP 送出の時間間隔の設定
[書式 ]
ip pp rip connect  interval  time
no ip pp rip connect  interval  [time]
[設定値及び初期値 ]
•time
• [設定値 ] : 秒数  (30..21474836)
• [初期値 ] : 30
[説明 ]
選択されている相手について回線接続時に  RIP を送出する時間間隔を設定する。
ip pp rip send  とip pp rip receive  コマンドが  on、ip pp rip connect send  コマンドが  interval の時に有効である。コマンドリファレンス  | IP の設定  | 181

[設定例 ]
# ip pp rip connect interval 60
# ip pp rip connect send interval
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.14 回線切断時の  PP 側の  RIP の動作の設定
[書式 ]
ip pp rip disconnect  send  rip_action
no ip pp rip disconnect  send  [rip_action ]
[設定値及び初期値 ]
•rip_action
• [設定値 ] :
設定値 説明
none 回線切断時に  RIP を送出しない
interval ip pp rip disconnect interval  コマンドで設定された時
間間隔で  RIP を送出する
update 経路情報が変わった時にのみ  RIP を送出する
• [初期値 ] : none
[説明 ]
選択されている相手について回線切断時に  RIP を送出する条件を設定する。
[設定例 ]
# ip pp rip disconnect interval 1800
# ip pp rip disconnect send interval
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.15 回線切断時の  PP 側の  RIP 送出の時間間隔の設定
[書式 ]
ip pp rip disconnect  interval  time
no ip pp rip disconnect  interval  [time]
[設定値及び初期値 ]
•time
• [設定値 ] : 秒数  (30..21474836)
• [初期値 ] : 3600
[説明 ]
選択されている相手について回線切断時に  RIP を送出する時間間隔を設定する。
ip pp rip send  とip pp rip receive  コマンドが  on、ip pp rip disconnect send  コマンドで  interval の時に有効である。
[設定例 ]
# ip pp rip disconnect interval 1800
# ip pp rip disconnect send interval
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830182 | コマンドリファレンス  | IP の設定

8.3.16 バックアップ時の  RIP の送信元インタフェース切り替えの設定
[書式 ]
ip pp rip backup  interface  switch
no ip pp rip backup  interface
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on 切り替える
off 切り替えない
• [初期値 ] : off
[説明 ]
バックアップ時に  RIP の送信元インタフェースを切り替えるか否かを設定する。 RIP の送信元インタフェースは、
off のときには、バックアップ元のインタフェースであり、 on のときには、バックアップ先のインタフェースとな
る。
[ノート ]
両者の違いは、送信元の  IP アドレスの違いとなって現れる。 off のときには、バックアップ元のインタフェースのア
ドレスが選ばれ、 on のときには、バックアップ先のインタフェースのアドレスが選ばれる。なお、どちらの場合に
も、バックアップ回線を通じて  RIP が送信される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.17 RIP で強制的に経路を広告する
[書式 ]
ip interface  rip force-to-advertise  ip-address /netmask  [metric metric ]
ip pp rip force-to-advertise  ip-address /netmask  [metric metric ]
ip tunnel  rip force-to-advertise  ip-address /netmask  [metric metric ]
no ip interface  rip force-to-advertise  ip-address /netmask  [metric metric ]
no ip pp rip force-to-advertise  ip-address /netmask  [metric metric ]
no ip tunnel  rip force-to-advertise  ip-address /netmask  [metric metric ]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•ip-address/netmask
• [設定値 ] : 強制的に広告したい経路のネットワークアドレスとネットマスク長、または  'default'
• [初期値 ] : -
•metric
• [設定値 ] : 広告する際のメトリック値  (1～15)
• [初期値 ] : 1
[説明 ]
設定した経路が経路テーブルに存在しない場合でも、指定されたインタフェースに対し、 RIP で経路を強制的に広告
する。経路として  'default' を指定した場合にはデフォルト経路が広告される。
[設定例 ]
LAN1 側に、 LAN2 の一部のホストだけを広告する。
ip lan1 address 192.168.0.1/24
ip lan2 address 192.168.1.1/24コマンドリファレンス  | IP の設定  | 183

rip use on
rip filter rule with-netmask
ip lan1 rip send on version 2
ip lan1 rip receive on version 2
ip filter 1 reject 192.168.1.0/24
ip filter 100 pass *
ip lan1 rip filter out 1 100
ip lan1 rip force-to-advertise 192.168.1.28/30
ip lan1 rip force-to-advertise 192.168.1.100/32
ip lan1 rip force-to-advertise 192.168.1.101/32
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.18 RIP2 でのフィルタの比較方法
[書式 ]
rip filter  rule rule
no rip filter  rule [rule]
[設定値及び初期値 ]
•rule
• [設定値 ] :
設定値 説明
address-only ネットワークアドレスだけを比較対象とする
with-netmask RIP2 の場合、ネットワークアドレスとネットマスク
を比較対象とする
• [初期値 ] : address-only
[説明 ]
RIP フィルターで、設定されたフィルターと  RIP エントリの内容の比較方法を設定する。
rip filter rule コマンド プロトコル 比較方法
address-onlyRIP1 ネットマスク型のフィルターは範囲
指定と解釈され、 RIP エントリーのア
ドレス部がその範囲に入っているか
どうかを比較する。RIP2
with-netmaskRIP1
RIP2ネットマスク型のフィルターの、ア
ドレスとネットマスク、 RIP エントリ
ーのアドレス、ネットマスクと一致
するかどうかを比較する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.3.19 RIP のタイマーを調整する
[書式 ]
rip timer  update  [invalid  [holddown ]]
no rip timer  [update ]
[設定値及び初期値 ]
•update
• [設定値 ] : 定期的な広告の送信間隔  (10～60 ( 秒 ))
• [初期値 ] : 30 秒
•invalid
• [設定値 ] : 広告を受け取れなくなってから経路を削除するまでの時間  (30～360 ( 秒 ))
• [初期値 ] : update×6 (180 秒 )184 | コマンドリファレンス  | IP の設定

•holddown
• [設定値 ] : 経路が削除されたときにメトリック  16 で経路を広告する時間  (20～240 ( 秒 ))
• [初期値 ] : update×4 (120 秒 )
[説明 ]
RIP のタイマー値を設定する。
update、invalid、holddown  の各値の間には以下の不等式が成立している必要がある。
    update ×3 ≦ invalid  ≦ update ×6
    update ×2 ≦ holddown  ≦ update ×4
[ノート ]
PP インタフェースに対し、 ip pp rip connect/disconnect interval  コマンドが設定されているときは、そのコマンドの
設定値が rip timer  コマンドに優先する。ただし、 ip pp rip connect/disconnect interval  コマンドは update  タイマーと
invalid  タイマーの値に影響するが、 holddown  タイマーの値には影響しない。 ip pp rip connect/disconnect interval  コ
マンドの設定値を  T とした場合、各タイマーは以下のようになる。
update T
invalid T×6
holddown rip timer  コマンドの設定値  ( デフォルト  120 秒 )
PP インタフェース以外は該当するコマンドがないため、常に rip timer  コマンドの設定値が有効である。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.4 VRRP の設定
8.4.1 インタフェース毎の  VRRP の設定
[書式 ]
ip interface  vrrp  vrid ip_address  [priority= priority ] [preempt= preempt ] [auth= auth] [advertise-interval= time1 ] [down-
interval= time2 ]
no ip interface  vrrp  vrid [vrid...]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•vrid
• [設定値 ] : VRRP グループ  ID (1..255)
• [初期値 ] : -
•ip_address
• [設定値 ] : 仮想ルーターの  IP アドレス
• [初期値 ] : -
•priority
• [設定値 ] : 優先度  (1..254)
• [初期値 ] : 100
•preempt  : プリエンプトモード
• [設定値 ] :
設定値 説明
on 使用する
off 使用しない
• [初期値 ] : onコマンドリファレンス  | IP の設定  | 185

•auth
• [設定値 ] : テキスト認証文字列  (8 文字以内  )
• [初期値 ] : -
•time1
• [設定値 ] : VRRP 広告の送信間隔  (1..60秒)
• [初期値 ] : 1
•time2
• [設定値 ] : マスターがダウンしたと判定するまでの時間  (3..180秒)
• [初期値 ] : 3
[説明 ]
指定した  VRRP グループを利用することを設定する。
同じ  VRRP グループに所属するルーターの間では、 VRID および仮想ルーターの  IP アドレスを一致させておかなく
てはいけない。これらが食い違った場合の動作は予測できない。
auth パラメータを指定しない場合には、認証なしとして動作する。
time1  および time2  パラメータで、マスターが  VRRP 広告を送信する間隔と、バックアップがそれを監視してダウン
と判定するまでの時間を設定する。トラフィックが多いネットワークではこれらの値を初期値より長めに設定する
と動作が安定することがある。これらの値はすべての  VRRP ルーターで一致している必要がある。
[ノート ]
priority  および preempt  パラメータの設定は、仮想ルーターの  IP アドレスとして自分自身の  LAN インタフェースに
付与されているアドレスを指定している場合には無視される。この場合、優先度は最高の  255 となり、常にプリエ
ンプトモードで動作する。
[適用モデル ]
vRX VMware ESXi 版, RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.4.2 シャットダウントリガの設定
[書式 ]
ip interface  vrrp  shutdown  trigger  vrid interface
ip interface  vrrp  shutdown  trigger  vrid pp peer_num  [dlci= dlci]
ip interface  vrrp  shutdown  trigger  vrid tunnel tunnel_num
ip interface  vrrp  shutdown  trigger  vrid route network  [nexthop ]
no ip interface  vrrp  shutdown  trigger  vrid interface
no ip interface  vrrp  shutdown  trigger  vrid pp peer_num  [...]
no ip interface  vrrp  shutdown  trigger  vrid tunnel tunnel_num
no ip interface  vrrp  shutdown  trigger  vrid route network
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•vrid
• [設定値 ] : VRRP グループ  ID (1..255)
• [初期値 ] : -
•peer_num
• [設定値 ] : 相手先情報番号
• [初期値 ] : -
•dlci
• [設定値 ] : DLCI 番号
• [初期値 ] : -
•tunnel_num
• [設定値 ] : tunnel インターフェース  番号
• [初期値 ] : -186 | コマンドリファレンス  | IP の設定

•network
• [設定値 ] :
•ネットワークアドレス
• IP アドレス /マスク長
• default
• [初期値 ] : -
•nexthop
• [設定値 ] :
•インタフェース名
• IP アドレス
• [初期値 ] : -
[説明 ]
設定した  VRRP グループでマスタールーターとして動作している場合に、指定した条件によってシャットダウンす
ることを設定する。
形式 説明
LAN インタフェース形式指定した  LAN インタフェースがリンクダウンするか、
あるいは lan keepalive  でダウンが検知されると、シャッ
トダウンする。
pp 形式指定した相手先情報番号に該当する回線で通信できな
くなった場合にシャットダウンする。通信できなくな
るとは、ケーブルが抜けるなどレイヤ  1 が落ちた場合
と、以下の場合である。
•回線が  ISDN 回線である時は、 呼が接続されていない
場合
•回線が専用線である時には、 LCP キープアライブに
よって通信相手が落ちたと判断した場合
•回線がフレームリレーであって ”dlci= dlci”を指定して
いる場合には、 PVC 状態確認手順によって指定した
DLCI 番号が通信できないと判断した場合
•pp keepalive use  設定によりダウンが検出された場合
tunnel 形式指定した tunnel インターフェースが以下の条件により
ダウンした場合にシャットダウンする。
• IPsec トンネルで、 ipsec ike keepalive use 設定により
ダウンが検出された場合
• L2TP/IPsec 、L2TPv3、L2TPv3/IPsec のいずれかのトン
ネルで、 l2tp keepalive use 設定によりダウンが検出さ
れた場合
• PPTP トンネルで、 pptp keepalive use 設定によりダウ
ンが検出された場合
• IPIPトンネルで、 ipip keepalive use 設定によりダウン
が検出された場合
route 形式指定した経路が経路テーブルに存在しないか、 nexthop  で
指定したインタフェースもしくは  IP アドレスで指定す
るゲートウェイに向いていない場合に、シャットダウン
する。 nexthop  を省略した場合には、 経路がどのような先
を向いていても存在する限りはシャットダウンしない。
[ノート ]
第 3、第  7 書式は、 RTX5000 / RTX3500 Rev.14.00.31 以前、 RTX1210 Rev.14.01.27 以前、および  RTX830 Rev.15.02.02
以前では使用不可能。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_numコマンドリファレンス  | IP の設定  | 187

ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
•peer_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 150
[適用モデル ]
vRX VMware ESXi 版, RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5 バックアップの設定
8.5.1 プロバイダ接続がダウンした時に  PP バックアップする接続先の指定
[書式 ]
pp backup  none
pp backup  pp peer_num  [ipsec-fast-recovery= action ]
pp backup  interface  ip_address
pp backup  tunnel  tunnel_num
no pp backup
[設定値及び初期値 ]
• none : バックアップ動作しない
• [初期値 ] : none
•peer_num
• [設定値 ] : バックアップ先として  PP を使用する場合の相手先情報番号
• [初期値 ] : -
•action  : バックアップから復帰した直後に  SA の再構築を実施するか否か
• [設定値 ] :
設定値 説明
on 再構築する
off 再構築しない
• [初期値 ] : off
•interface
• [設定値 ] : バックアップ先として使用する  LAN インタフェース
• [初期値 ] : -
•ip_address
• [設定値 ] : ゲートウェイの  IP アドレス
• [初期値 ] : -
•tunnel_num
• [設定値 ] : トンネルインタフェース番号
• [初期値 ] : -188 | コマンドリファレンス  | IP の設定

[説明 ]
PP インタフェースが切断されたときにバックアップするインタフェースを指定する。
バックアップ先のインタフェースが  PP インタフェースの場合には、 ipsec-fast-recovery オプションを設定できる。こ
のオプションで  on を設定したときには、バックアップから復帰した直後に  IPsec の SA をすぐに再構築するため、
IPsec の通信が可能になるまでの時間を短縮できる。
[ノート ]
このコマンドは  PP インタフェースごとに設定できる。
PP インタフェースの切断を検知するために pp always-on  コマンドで  on を設定する必要がある。専用線の場合には
pp always-on  コマンドの代わりに、 pp keepalive use lcp-echo  コマンドを使用する。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
•peer_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 150
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5.2 バックアップからの復帰待ち時間の設定
[書式 ]
pp backup  recovery  time  time
no pp backup  recovery  time  [time]
[設定値及び初期値 ]
•time
• [設定値 ] :
設定値 説明
1..21474836 秒数
off すぐに復帰
• [初期値 ] : off
[説明 ]
バックアップから復帰する場合には、すぐに復帰させるか、設定された時間だけ待ってから復帰するかを設定する。
[ノート ]
この設定は､すべての  PP で共通に用いられる。また専用線バックアップでも  FR バックアップでもこの設定が共通
に用いられる。コマンドリファレンス  | IP の設定  | 189

[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5.3 LAN 経由でのプロバイダ接続がダウンした時にバックアップする接続先の指定
[書式 ]
lan backup  interface  none
lan backup  interface  pp peer_num
lan backup  interface  backup_interface  ip_address
lan backup  interface  tunnel  tunnel_num
no lan backup  interface
[設定値及び初期値 ]
• none : バックアップ動作しない
• [初期値 ] : none
•interface
• [設定値 ] : バックアップ対象の  LAN インタフェース名
• [初期値 ] : -
•peer_num
• [設定値 ] : バックアップとして  pp を使用する場合の相手先情報番号
• [初期値 ] : -
•backup_interface
• [設定値 ] : バックアップとして使用する  LAN インタフェース
• [初期値 ] : -
•ip_address
• [設定値 ] : ゲートウェイの  IP アドレス
• [初期値 ] : -
•tunnel_num
• [設定値 ] : トンネルインタフェース番号
• [初期値 ] : -
[説明 ]
指定する  LAN インタフェースに対して、 LAN 経由でのプロバイダ接続がダウンした場合にバックアップするイン
タフェース情報を設定する。
[ノート ]
バックアップ動作のためには、 LAN 経由での接続のダウンを検知するために lan keepalive use  コマンドでの設定が
併せて必要である。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
•peer_num190 | コマンドリファレンス  | IP の設定

ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 150
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5.4 バックアップからの復帰待ち時間の設定
[書式 ]
lan backup  recovery  time  interface  time
no lan backup  recovery  time  interface  [time]
[設定値及び初期値 ]
•interface
• [設定値 ] : バックアップ対象の  LAN インタフェース名
• [初期値 ] : -
•time
• [設定値 ] :
•秒数  (1..21474836)
• off
• [初期値 ] : off
[説明 ]
指定する  LAN インタフェースに対して、バックアップから復帰する場合に、すぐに復帰させるか、設定された時間
だけ待ってから復帰するかを設定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5.5 LAN 経由のキープアライブを使用するか否かの設定
[書式 ]
lan keepalive  use interface  icmp-echo dest_ip  [option =value ...] [dest_ip  [option =value ...]...]
lan keepalive  use interface  arp dest_ip [dest_ip ...]
lan keepalive  use interface  icmp-echo dest_ip  [option =value ...] [dest_ip  [option =value ...]...] arp dest_ip  [dest_ip ...]
lan keepalive  use interface  off
no lan keepalive  use interface  [...]
[設定値及び初期値 ]
•interface
• [設定値 ] : バックアップ対象の  LAN インタフェース名
• [初期値 ] : -
•dest_ip
• [設定値 ] : キープアライブ確認先の  IP アドレス
• [初期値 ] : -
•option = value 列
• [設定値 ] :
option value 説明
upwait ミリ秒アップ検知のための許容応答時間
(1..10000)
downwait ミリ秒ダウン検知のための許容応答時間
(1..10000)コマンドリファレンス  | IP の設定  | 191

option value 説明
length バイトICMP Echo パケットの長さ
(64-1500)
• [初期値 ] : -
[説明 ]
指定する  LAN インタフェースに対して、キープアライブ動作を行うか否かを設定する。 icmp-echo を指定すれば
ICMP Echo/Reply を用い、 arp を指定すれば  ARP Request/Reply を用いる。併記することで併用も可能である。
[ノート ]
icmp-echo で確認する  IP アドレスに対する経路は、バックアップをする  LAN インタフェースに向くことが必要であ
る。
downwait パラメータで応答時間を制限する場合でも、 lan keepalive interval  コマンドの設定値の方が小さい場合に
は、 lan keepalive interval  コマンドの設定値が優先される。 downwait 、upwait パラメータのうち一方しか設定してい
ない場合には、他方も同じ値が設定されたものとして動作する。
length パラメータで指定するのは  ICMP データ部分の長さであり、 IP パケット全体の長さではない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5.6 LAN 経由のキープアライブの時間間隔の設定
[書式 ]
lan keepalive  interval  interface  interval  [count ]
no lan keepalive  interval  interface
[設定値及び初期値 ]
•interface
• [設定値 ] : バックアップ対象の  LAN インタフェース名
• [初期値 ] : -
•interval
• [設定値 ] : キープアライブパケットを送出する時間間隔  (1..65535)
• [初期値 ] : 30
•count
• [設定値 ] : ダウン検出を判定する回数  (3..100)
• [初期値 ] : 6
[説明 ]
指定する  LAN インタフェースに対して、キープアライブパケットの送出間隔とダウン検出を判定する回数を設定す
る。  count  に設定した回数だけ連続して応答パケットを検出できない場合に、ダウンと判定する。
一度応答が返ってこないのを検出したら、その後のキープアライブパケットの送出間隔は  1 秒に短縮される。その
ため、デフォルトの設定値の場合でもダウン検出に要する時間は  35 秒程度である。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5.7 LAN 経由のキープアライブのログをとるか否かの設定
[書式 ]
lan keepalive  log interface  log
no lan keepalive  log interface
[設定値及び初期値 ]
•interface
• [設定値 ] : バックアップ対象の  LAN インタフェース名
• [初期値 ] : -
•log
• [設定値 ] :192 | コマンドリファレンス  | IP の設定

設定値 説明
on ログをとる
off ログをとらない
• [初期値 ] : off
[説明 ]
キープアライブパケットのログをとるか否かを設定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.5.8 ネットワーク監視機能の設定
[書式 ]
ip keepalive  num kind interval  count  gateway  [gateway  ...] [ option =value  ...]
no ip keepalive  num
[設定値及び初期値 ]
•num : 監視設定の識別番号
• [設定値 ] :
設定値 説明
1..6000 vRX Amazon EC2 版 通常モード、 vRX VMware ESXi
版 通常モード、 vRX さくらのクラウド版  で設定可能
1...3000 RTX5000 、RTX3510 で設定可能
1...1000 vRX Amazon EC2 版 コンパクトモード、 vRX VMware
ESXi 版 コンパクトモード、 RTX3500 で設定可能
1..100 上記以外の機種で設定可能
• [初期値 ] : -
•kind : 監視方式
• [設定値 ] :
設定値 説明
icmp-echo ICMP Echo を使用する
• [初期値 ] : -
•interval
• [設定値 ] : キープアライブの送信間隔秒数  (1..65535)
• [初期値 ] : -
•count
• [設定値 ] : 到達性がないと判断するまでに送信する回数 (3..100)
• [初期値 ] : -
•gateway  : 複数指定可  (10 個以内  )
• [設定値 ] :
• IP アドレス
• xxx.xxx.xxx.xxx (xxx は十進数  )
• dhcp interface
• RTX5000 と RTX3500 は Rev.14.00.29 以降で指定可
設定値 説明
interfaceDHCP にて与えられるデフォルトゲートウェイを
使う場合の、 DHCP クライアントとして動作する
LAN インタフェース名または  WAN インタフェー
ス名
• [初期値 ] : -コマンドリファレンス  | IP の設定  | 193

•option=value 列
• [設定値 ] :
option value 説明
logon SYSLOG を出力する
off SYSLOG を出力しない
upwait 秒数到達性があると判断するまでの待
機時間  (1..1000000)
downwait 秒数到達性がないと判断するまでの待
機時間  (1..1000000)
length バイトICMP Echo パケットの長さ
(64-1500)
local-address IP アドレス 始点  IP アドレス
ipsec-refreshセキュリティ・ゲートウェイの識
別子  (gateway_id )DOWN→UP または  UP→DOWN
に状態が変化した場合に、指定の
セキュリティ・ゲートウェイに属
する  SA を強制的に更新  ( 複数指
定する場合はカンマで区切る  )
ipsec-refresh-upセキュリティ・ゲートウェイの識
別子  (gateway_id )DOWN→UP に状態が変化した場
合のみ、指定のセキュリティ・ゲ
ートウェイに属する  SA を強制的
に更新  ( 複数指定する場合はカン
マで区切る  )
ipsec-refresh-downセキュリティ・ゲートウェイの識
別子  (gateway_id )UP→DOWN に状態が変化した場
合のみ、指定のセキュリティ・ゲ
ートウェイに属する  SA を強制的
に更新  ( 複数指定する場合はカン
マで区切る  )
gateway-selection-ruleheadICMP Echo パケットを送信する
際、該当する経路に複数のゲート
ウェイが指定されていても、必ず
最初に指定されたゲートウェイへ
送出する
normalICMP Echo パケットを送信する
際、該当する経路に複数のゲート
ウェイが指定されていたら、通常
の規則に従い送出ゲートウェイを
選択する
• [初期値 ] :
• log=off
• upwait=5
• downwait=5
• length=64
• gateway-selection-rule=head
[説明 ]
指定したゲートウェイに対して  ICMP Echo を送信し、その返事を受信できるかどうかを判定する。
[ノート ]
length パラメータで指定するのは  ICMP データ部分の長さであり、 IP パケット全体の長さではない。
ipsec-refresh 、ipsec-refresh-up 、ipsec-refresh-down パラメータは、ネットワークバックアップ機能の主系／従系回線の
切り替え時において、 IPsec 通信の復旧時間を短縮させる際に有効である。
WAN インタフェースは、 vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能。194 | コマンドリファレンス  | IP の設定

[設定例 ]
ネットワークバックアップ機能で従系回線  pp11 から主系回線  pp10 へ復旧する際に、 IPsec 接続で使用しているセキ
ュリティ・ゲートウェイの識別子  3 に属する  SA を強制的に更新させる。
# ip route 172.16.0.0/24 gateway pp 10 keepalive 1 gateway pp 11 weight 0
# ip keepalive 1 icmp-echo 5 5 172.16.0.1 ipsec-refresh-up=3
ネットワークバックアップ機能を利用して、 IP キープアライブ  1 がダウンしたのをトリガにして経路
172.16.224.0/24 を活性化させる。
# ip route 172.16.112.0/24 gateway null keepalive 1 gateway 172.16.0.1 weight 0
# ip route 172.16.224.0/24 gateway 172.16.112.1 keepalive 2
# ip keepalive 1 icmp-echo 5 5 192.168.100.101
# ip keepalive 2 icmp-echo 5 5 172.16.112.1 gateway-selection-rule=normal
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•gateway_id
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.6 受信パケット統計情報の設定
8.6.1 受信パケットの統計情報を記録するか否かの設定
[書式 ]
ip interface  traffic  list sw
ip pp traffic  list sw
ip tunnel  traffic  list sw
no ip interface  traffic  list[sw]
no ip pp traffic  list [sw]
no ip tunnel  traffic  list [sw]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•switch
• [設定値 ] :
設定値 説明
on 指定したインタフェースで受信したパケットの統計
情報を記録する
off 指定したインタフェースで受信したパケットの統計
情報を記録しない
• [初期値 ] : off
[説明 ]
指定したインタフェースで受信したパケットの統計情報を記録するか否かを設定する。コマンドリファレンス  | IP の設定  | 195

送信元  IP アドレスと送信先  IP アドレスの組み合わせが同じパケットについて、 それぞれのパケット数とオクテット
数を統計情報として記録する。
最大で３つのインタフェースについての統計情報を同時に記録することができる。
[ノート ]
ファストパスで処理されたパケットは統計情報には記録されない。
off に設定すると統計情報がクリアされ、記録が停止する。
on に設定したときにもそれまでの統計情報はいったんクリアされ、新たに記録が開始する。
NAT 設定があるインタフェースで動作させる場合に表示される  IP アドレスは、 NAT 変換可能な状態であれば  NAT
変換後の  IP アドレスが表示され、 NAT 変換ができない状態であれば  NAT 変換前の  IP アドレスが表示される。
受信フィルタで破棄される通信については記録されない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500
8.6.2 受信したパケットの統計情報のクリア
[書式 ]
clear  ip traffic  list [interface ]
clear  ip traffic  list pp [peer_num ]
clear  ip traffic  list tunnel  [tunnel_num ]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•peer_num
• [設定値 ] : 相手先情報番号、省略時は選択されている相手先情報番号
• [初期値 ] : -
•tunnel_num
• [設定値 ] : トンネル番号、省略時は選択されているトンネル番号
• [初期値 ] : -
[説明 ]
受信したパケットの統計情報をクリアする。
interface  を省略したときは、全インタフェースの統計情報をクリアする。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500
8.6.3 受信したパケットの統計情報の表示
[書式 ]
show  ip traffic  list [interface ]
show  ip traffic  list pp [peer_num ]
show  ip traffic  list tunnel  [tunnel_num ]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•peer_num
• [設定値 ] : 相手先情報番号、省略時は選択されている相手先情報番号
• [初期値 ] : -
•tunnel_num
• [設定値 ] : トンネル番号、省略時は選択されているトンネル番号
• [初期値 ] : -196 | コマンドリファレンス  | IP の設定

[説明 ]
受信したパケットの統計情報を表示する。
interface  を省略したときは、全インタフェースの統計情報を表示する。
[表示例 ]
# show ip traffic list lan1
Source IP        Destination IP     Packets        Octets
---------------------------------------------------------
192.168.200.2    133.176.200.1      1411449    1326237183
133.176.200.3    133.176.200.226      12080       2115561
192.168.200.1    192.168.100.1          802         97211
192.168.200.2    133.176.200.3           17         17348
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本
YSL-VPN-EX3 1500 2000 2500 3000
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500
8.6.4 統計情報を記録する受信パケットの分類数の設定
[書式 ]
ip interface  traffic  list threshold  value
ip pp traffic  list threshold  value
ip tunnel  traffic  list threshold  value
no ip interface  traffic  list threshold  [value ]
no ip pp traffic  list threshold  [value ]
no ip tunnel  traffic  list threshold  [value ]
[設定値及び初期値 ]
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
•value
• [設定値 ] : 統計情報に記録するパケットの最大分類数  (64..5000)
• [初期値 ] : 64
[説明 ]
指定したインタフェースにおいて、統計情報として記録する受信パケットの分類数を指定する。
[ノート ]
送信元  IP アドレスと送信先  IP アドレスの組み合わせによってパケットを分類する。
記録されている受信パケット情報の分類数が最大値に達した場合、それ以降で新規に分類された受信パケット情報
は記録されない。
このコマンドで設定を行なうとそれまでの統計情報はクリアされる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500コマンドリファレンス  | IP の設定  | 197

8.7 パケット転送フィルターの設定
8.7.1 パケット転送フィルターの定義
[書式 ]
ip forward  filter  id order  gateway gateway  filter filter_id  ... [keepalive keepalive_id  ]
no ip forward  filter  id order  [gateway gateway  [filter filter_id  ...] [keepalive keepalive_id ] ]
[設定値及び初期値 ]
•id
• [設定値 ] : パケット転送フィルターの識別子  (1..255)
• [初期値 ] : -
•order
• [設定値 ] : 評価の順番  (1..255)
• [初期値 ] : -
•gateway
• [設定値 ] :
設定値 説明
IP アドレス パケットを転送するゲートウェイの  IP アドレス
wan1 WAN インタフェース
( vRX シリーズ、 RTX5000 、および  RTX3500 では指
定不可能  )
pp peer_num PP インタフェース
tunnel tunnel_num TUNNEL インタフェース
• [初期値 ] : -
•filter_id
• [設定値 ] : ip filter  コマンドの識別子
• [初期値 ] : -
•keepalive_id
• [設定値 ] : ip keepalive  コマンドの識別子
• [初期値 ] : -
[説明 ]
パケット転送フィルターを定義する。
id パラメータは、複数のパケット転送フィルターをグループ化するための識別子である。
同じインタフェースに対して複数のパケット転送フィルターを設定するときには、それらのすべてに対して、同じ
番号を指定しなければならない。
order  パラメータは、評価の順番を示すもので、若い番号を持つものほど優先的に採用される。
filter_id  パラメータとしては、 ip filter  コマンドの識別子を最大  16 個まで指定できる。
複数の識別子を指定したときには、前にあるものが優先的に評価される。
前から順に対応する ip filter  コマンドを調べ、パケットの内容と合致すれば、その ip filter  コマンドの設定を採用す
る。
ip filter  コマンドの動作が  reject であれば、パケットを転送せずに破棄し、そうでなければ、 gateway  パラメータで指
定したゲートウェイにパケットを転送する。
keepalive_id  には、 ip keepalive  コマンドの識別子を指定する。
ここで指定した  IP キープアライブの結果が  down であれば、このゲートウェイを使用しない。
つまり、該当する ip filter  コマンドがあったとしても、該当しなかったものとして扱う。
なお、実際に動作させるためには、 ip interface  forward filter  コマンドも設定する必要がある。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num198 | コマンドリファレンス  | IP の設定

ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
•peer_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 150
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
8.7.2 インタフェースへのパケット転送フィルターの適用
[書式 ]
ip interface  forward  filter  id
ip pp forward  filter  id
ip tunnel  forward  filter  id
ip local  forward  filter  id
no ip interface  forward  filter  [id]
no ip pp forward  filter  [id]
no ip tunnel  forward  filter  [id]
no ip local  forward  filter  [id]
[設定値及び初期値 ]
•interface
• [設定値 ] :
• LAN インタフェース名
• WAN インタフェース名
• vRX シリーズ、 RTX5000 、および  RTX3500 では指定不可能
• [初期値 ] : -
•id
• [設定値 ] : ip forward filter  コマンドで指定したパケット転送フィルターの識別子  (1..255)
• [初期値 ] : -
[説明 ]
インタフェースにパケット転送フィルターを適用する。
指定したインタフェースで受信したパケットを、指定したパケット転送フィルターの設定と比較し、転送先のゲー
トウェイを決定する。
ip local forward filter  コマンドは自分自身が送信するパケットを対象にするときに指定する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | IP の設定  | 199

8.8 LAN パススルー機能ーの設定
8.8.1 LAN パススルー機能で中継するイーサタイプの設定
[書式 ]
lan pass-through  ethertype  id ethertype  [ethertype  ...]
no lan pass-through  ethertype  id [...]
[設定値及び初期値 ]
•id
• [設定値 ] : LAN パススルー機能の識別子  (1..8)
• [初期値 ] : -
•ethertype  : イーサタイプ
• [設定値 ] :
•イーサタイプを表す十進数  ( 1536..65535 )
•イーサタイプを表す十六進数  ( 0x0600..0xffff )
•イーサタイプを表すニーモニック
ニーモニック 十進数 十六進数 説明
ipv4 2048 0x0800 IPv4 パケット
arp 2054 0x0806 ARP パケット
ipv6 34525 0x86dd IPv6 パケット
• [初期値 ] : -
[説明 ]
LAN パススルー機能で中継するパケットのイーサタイプを設定する。
本設定がない場合、パケットは中継しない。
[ノート ]
IEEE802.1Q タグ付きパケットを中継させる場合であっても、  IEEE802.1Q タグを考慮する必要はない。  IEEE802.1Q
タグでカプセル化されているイーサタイプを設定する。
RTX1300 は Rev.23.00.16 以降で使用可能。
[適用モデル ]
RTX1300
8.8.2 LAN パススルー機能で使用するインタフェースの設定
[書式 ]
lan pass-through  member  id interface  interface
no lan pass-through  member  id [...]
[設定値及び初期値 ]
•id
• [設定値 ] : LAN パススルー機能の識別子  (1..8)
• [初期値 ] : -
•interface
• [設定値 ] : LAN インタフェース名
• [初期値 ] : -
[説明 ]
LAN パススルー機能で使用するインタフェースを設定する。
設定したインタフェース間で、  lan pass-through ethertype  コマンドで設定したイーサタイプのパケットを中継する。
本設定がない場合、パケットは中継しない。200 | コマンドリファレンス  | IP の設定

LAN インタフェース名には、物理  LAN インタフェースおよび  LAN 分割機能で使用するインタフェースを設定でき
る。
[ノート ]
設定した  LAN インタフェースはプロミスキャスモードで動作する。
RTX1300 は Rev.23.00.16 以降で使用可能。
[適用モデル ]
RTX1300コマンドリファレンス  | IP の設定  | 201

