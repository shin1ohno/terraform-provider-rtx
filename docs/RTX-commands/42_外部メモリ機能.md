# 第42章: 外部メモリ機能

> 元PDFページ: 569-583

---

第 42 章
外部メモリ機能
本機能は、ルーター本体へ外部メモリ  (USB メモリ、 microSD カード  ) を接続することにより、ルーターと外部メモ
リ間で各種データの操作を行います。
使用できる外部メモリは機種によって異なります。
FUNC ボタンが搭載された機種を使用する場合は、 DOWNLOAD ボタンを  FUNC ボタンに読み替えてください。
本機能により、以下の動作が可能となります。
•コマンド設定、あるいは実行コマンドによる動作
•外部メモリへ  SYSLOG メッセージを出力する。
•外部メモリへ設定ファイルをコピーする。
•外部メモリから設定ファイルをコピーする。
•外部メモリからファームウェアファイルをコピーする。
•ルーター本体の外部メモリボタンおよび  DOWNLOAD ボタンの操作による動作
•外部メモリボタンと  DOWNLOAD ボタンを同時に  3 秒以上押下し続け、外部メモリから設定ファイルおよび
ファームウェアファイルをコピーする。
•外部メモリからの起動
•バッチファイル実行機能
バッチファイル実行機能
外部メモリの中に、コマンドを羅列したファイル  ( バッチファイルと呼びます  ) を入れておき、そのファイルに記述
されたコマンドを実行する機能です。
設定によって  DOWNLOAD ボタンを押して実行させることができます。コンソールでの execute batch  コマンドに
よって実行することもできます。
コマンドの実行結果やログは、ファイルとして外部メモリに書き出します。
本機能を用いると、 PC がない環境でも  PING での疎通確認などを行うことができます。
例えばルーターの設置作業時に、必要な装置や作業手順を大幅に減らすことができます。
実行結果や設定内容、ルーターの状態などは、外部メモリにファイルとして書き出されます。
書き出されたファイルは、外部メモリを取り出して携帯電話で確認することができます。
作業ログとして利用することもできます。
本機能に関する技術情報は以下に示す  URL で公開されています。
https://www.rtpro.yamaha.co.jp
42.1 microSD カードスロットを使うか否かの設定
[書式 ]
sd use switch
no sd use [switch ]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on microSD カードスロットを使用する
off microSD カードスロットを使用しない
• [初期値 ] : onコマンドリファレンス  | 外部メモリ機能  | 569

[説明 ]
microSD カードスロットを使用するか否かを設定する。このコマンドが  off に設定されているときは  microSD カー
ドをカードスロットに差し込んでも認識されない。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.2 外部メモリ用キャッシュメモリの動作モードの設定
[書式 ]
external-memory  cache  mode  mode
no external-memory  cache  mode  [mode ]
[設定値及び初期値 ]
•mode
• [設定値 ] :
設定値 説明
write-through ライトスルーモード
copy-back1 コピーバックモード 1
copy-back2 コピーバックモード 2
• [初期値 ] : copy-back1
[説明 ]
外部メモリ用キャッシュメモリの動作モードを設定する。ライトスルーモード、コピーバックモード 1、及びコピー
バックモード 2 の3種類の動作モードをサポートしており、各モードによって  FAT、DIR、FILE の各キャッシュ上
のデータを外部メモリへ書き出すタイミングが異なる。
各動作モードについて、以下に説明する。
write-through を指定した場合、 FAT、DIR、FILE に割り当てられていたキャッシュは、ライトスルーモードで動作
し、常に外部メモリへ書き出される。最も安全性が高い。
copy-back1 を指定した場合、 FAT と DIR キャッシュはコピーバックモードで動作し、 FILE キャッシュは、ライトス
ルーモードで動作する。ライトスルーモードより高速に動作させることができる。
copy-back2 を指定した場合、 FAT、DIR、FILE キャッシュがコピーバックモードで動作する。この設定では、外部メ
モリへの書き出しが抑制されるので、最も高速に動作する。しかし、外部メモリへ書き出しが完了していない状態
が続く為、予期しない電源断が発生すると外部メモリのファイルシステムがダメージを受ける可能性が高くなる。
FAT : File Allocation Table の略
DIR : Directory Entry の略
[ノート ]
本コマンドの変更は、外部メモリを接続した時に反映される。外部メモリが既に接続されている状態でコマンドを
入力した場合は、一旦、取り外した後に再接続する必要がある。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.3 ファイルアクセス高速化用キャッシュメモリのサイズの設定
[書式 ]
external-memory  accelerator  cache  size interface  size
no external-memory  accelerator  cache  size interface  [size]
[設定値及び初期値 ]
•interface
• [設定値 ] :
設定値 説明
usb1 USB ポート  1570 | コマンドリファレンス  | 外部メモリ機能

設定値 説明
sd1 microSD カードスロット
• [初期値 ] : -
•size
• [設定値 ] :
設定値 説明
1-5 キャッシュメモリのサイズ  (数値が大きいほどメモ
リサイズが大きい )
off ファイルアクセス高速化機構を使用しない
• [初期値 ] : 1
[説明 ]
ファイルアクセスを高速化するために使用するキャッシュメモリのサイズを設定する。
size に数値を指定した場合は、ファイルアクセスを高速化するための機構が働き、特にディレクトリ数やファイル数
の多い構成での外部メモリへのアクセス性能が向上する。アクセス性能が向上しない場合は、 size を大きくすること
で向上することがある。ただし、 size が大きいほど、外部メモリを接続してから使用可能になるまでの時間が長くな
ることがある。
size に off を指定した場合は、ファイルアクセスを高速化するためのキャッシュメモリは確保されない。
なお、すべてのインタフェースに対して  size に最大値を設定した状態で、同時にすべてのインタフェースに外部メ
モリを接続して使用すると、システム全体の性能に影響を与える可能性があるため、本コマンドを設定してファイ
ルアクセスを高速化するインタフェースは一つに限定することを推奨する。
[ノート ]
本コマンドの変更は、外部メモリを接続した時に反映される。外部メモリが既に接続されている状態でコマンドを
入力した場合は、一旦、取り外した後に再接続する必要がある。
また、本コマンドで、 size を大きくしてもアクセス性能が向上しない場合は、下記に示す操作を行うことで、改善さ
れることがある。
•可能であれば、外部メモリ内のディレクトリやファイルを減らす
•外部メモリ内の総ディレクトリ数を  2,000 個以内となるように調整する
•頻繁にアクセスするディレクトリ内の総ファイル数  (ディレクトリ含む ) を 20,000 個以内となるように調整する
•ファイル名やディレクトリ名をなるべく短くする  (32文字以内を推奨 )
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.4 外部メモリに保存する統計情報のファイル名のプレフィックスの設定
[書式 ]
external-memory  statistics  filename  prefix  prefix  [crypto  password ] [max-filenum =filenum ] [interval =minute ]
no external-memory  statistics  filename  prefix  [prefix  [crypto  password ] [max-filenum =filenum ] [interval =minute ]]
[設定値及び初期値 ]
•prefix  : ファイル名のプレフィックス  ( 半角英数字のみ、 "usb1:"などのプレフィックスを含めずに  15 文字以内  )
• [設定値 ] :
設定値 説明
usb1: filename ファイル名のプレフィックス
sd1:filename ファイル名のプレフィックス
• [初期値 ] : -
•crypto  : 暗号化して保存するときの暗号アルゴリズム
• [設定値 ] :
設定値 説明
aes128 AES128 で暗号化するコマンドリファレンス  | 外部メモリ機能  | 571

設定値 説明
aes256 AES256 で暗号化する
• [初期値 ] : -
•password
• [設定値 ] : 暗号化して保存するときの暗号鍵  ASCII 文字列で表したパスワード  ( 半角  8 文字以上、 32 文字以
内 )
• [初期値 ] : -
•filenum  : 外部メモリーに保存する統計情報のファイル数の上限
• [設定値 ] :
設定値 説明
100 ... 2147483647 外部メモリーに保存する統計情報のファイル数の上
限
infinity 外部メモリーに保存する統計情報のファイル数を制
限しない
• [初期値 ] : infinity
•minute  : 統計情報を外部メモリーに書き出す間隔
• [設定値 ] :
設定値 説明
2 ... 120 統計情報を外部メモリーに書き出す間隔  (分)
• [初期値 ] : 12
[説明 ]
統計情報を書き出すファイル名のプレフィックス  ( 接頭語  ) を設定する。
実際のファイル名は、このプレフィックスをもとにして自動的に決まる。
例えば、プレフィックスを「 yamaha」と設定した場合、 LAN2 インタフェースのトラフィック量を書き出す。
ファイル名は、 yamaha_traffic_lan2_20080708.csv のようになる。
[ノート ]
統計情報のファイル数が上限を超えた場合、各種別・インターフェースの統計情報のファイルで最も古いファイル
を削除して新しいファイルを作成する。
アプリケーションのトラフィック情報に関しては、 crypto  パラメータの有無にかかわらず、暗号化されない。
実際のファイル名は、 prefix  の後に種別や日付を表す文字列が加わる。
ファイル名の書式は以下に従う。  prefix_type[_id]_yyyymm[dd].ext
•prefix
•本コマンドにより設定される任意の文字列
•type
•統計情報の種類
cpu CPU 使用率
memory メモリ使用率
flow ファストパスのフロー数
route 経路数
nat NAT テーブルのエントリー数
filter 動的フィルターのセッション数
traffic インタフェース別のトラフィック量
qos QoS のクラス別のトラフィック量
application アプリケーションのトラフィック情報
•id572 | コマンドリファレンス  | 外部メモリ機能

• id の意味は統計情報の種類によって異なる
•インタフェース別のトラフィック量 ...........インタフェースを表す
• QoS のクラス別のトラフィック量 .............インタフェースとクラスを表す
•これ以外の統計情報では  id は省略される
•yyyy
•西暦  (4 桁 )
•mm
•月 (2 桁 )
•dd
•日 (2 桁 )
•ファイルを月ごとに分割するときには、  dd は省略される
•ext
•拡張子
csv CSV
rtfg 暗号化されたファイル
外部メモリに暗号化して保存したファイルは、 PC上で  RT-FileGuard を使用して復号することができる。
アプリケーションのトラフィック情報は、暗号化して保存することはできない。
max-filenum  オプションで制限するファイル数は、すべての種別・インターフェースの統計情報を書き出したファイ
ルの合計数となる。
アプリケーションのトラフィック情報に関しては、 interval の設定によらず  1 分ごとに統計情報が書き出される。
RTX1210 は Rev.14.01.34 以降、 RTX830 は Rev.15.02.10 以降、および、 Rev.15.04 系以降のファームウェアで使用可
能。
[適用モデル ]
RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.5 外部メモリに保存する  SYSLOG ファイル名の指定
[書式 ]
external-memory  syslog  filename  name  [crypto  password ] [limit= size] [backup= num] [interval= interval ] [line= line]
no external-memory  syslog  filename  [name ]
[設定値及び初期値 ]
•name  : SYSLOG ファイル名
• [設定値 ] :
設定値 説明
usb1: filename USB メモリ内のファイル名  ( .bak 拡張子を含む名前
は指定できない  )
sd1:filename microSD カード内のファイル名  ( .bak 拡張子を含む
名前は指定できない  )
• [初期値 ] : -
•crypto  : SYSLOG を暗号化して保存する場合の暗号アルゴリズムの選択
• [設定値 ] :
設定値 説明
aes128 AES128 で暗号化する
aes256 AES256 で暗号化する
• [初期値 ] : -
•password
• [設定値 ] : ASCII 文字列で表したパスワード  ( 半角  8 文字以上、 32 文字以内  )
• [初期値 ] : -コマンドリファレンス  | 外部メモリ機能  | 573

•size
• [設定値 ] : SYSLOG ファイルの上限サイズ  ( 1 - 1024 単位 :MB)
• [初期値 ] : 10
•num
• [設定値 ] : バックアップファイルの上限数  ( 1 - 100 )
• [初期値 ] : 10
•interval
• [設定値 ] : SYSLOG を外部メモリに書き出す間隔  ( 2 - 86400 単位 :秒 )
• [初期値 ] : 2
•line
• [設定値 ] : SYSLOG を外部メモリに書き出す行数  ( 1000 - N 単位 :行 ) N ... 各機種のログ記憶容量
• [初期値 ] : 1000
[説明 ]
外部メモリ内に保存する  SYSLOG ファイル名を指定する。
name  に.bak 拡張子を含むファイル名は指定できない。また、暗号化しない場合、 name  に .rtfg 拡張子を含むファイ
ル名は指定できない。
crypto  および password  を指定した場合、 SYSLOG は暗号化してから外部メモリに書き込まれる。暗号化する場合、
name  に.rtfg 拡張子を含めるか、拡張子を省略した名前を指定する必要がある。拡張子を省略した場合、自動的にフ
ァイル名に  rtfg 拡張子が追加される。
SYSLOG ファイルが上限サイズに達すると、 SYSLOG ファイルのバックアップが行われる。このとき作成されるバ
ックアップファイルの名前はファームウェアによって異なる。
バックアップファイル名は  name  で指定されたファイル名の後にバックアップが行われた日時を表す
_yyyymmdd_hhmmss 形式の文字列が付加されたものとなる。
• yyyy ... 西暦  (4 桁)
• mm ... 月 (2 桁)
• dd ... 日 (2 桁)
• hh ... 時 (2 桁)
• mm ... 分 (2 桁)
• ss ... 秒 (2 桁)
バックアップファイル数が  num で指定される上限数に達した場合、もしくは外部メモリに空き容量がなくなった場
合は、最も古いバックアップファイルを削除してから新しいバックアップファイルが作成される。
name  に拡張子が含まれている場合
•暗号化しないで保存する  ... 拡張子を  .bak に置き換える
•暗号化して保存する  ... 拡張子の前に  _bak を追加する
name  に拡張子が含まれていない場合  ... .bak という拡張子を追加する
interval  で指定した時間が経過した場合、もしくは  line で指定した行数だけ  SYSLOG が出力された場合に、外部メモ
リに  SYSLOG を書き出す。  lineで指定可能な各機種のログ記憶容量は以下のとおり。
• RTX5000 / RTX3510 / RTX3500 ... 20000
• RTX1300 / RTX1220 / RTX1210 / RTX840 / RTX830 ... 10000
本コマンドが設定されていないときは  SYSLOG は外部メモリに書き込まれない。
[ノート ]
以下の変更を行う場合、 name  を変更しなければならない。
• SYSLOG を暗号化しないで保存するから、暗号化して保存するに変更する場合
• SYSLOG を暗号化して保存するから、暗号化しないで保存するに変更する場合
•暗号アルゴリズムまたは、パスワードを変更する場合574 | コマンドリファレンス  | 外部メモリ機能

外部メモリに暗号化して保存したファイルは、 PC上で  RT-FileGuard を使用して復号することができる。
name  は半角  99 文字以内。
interval  オプションと  line オプションは、 RTX5000/RTX3500 Rev.14.00.18 以降のファームウェアおよび、 Rev.14.01 系
以降のすべてのファームウェアで使用可能。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.6 外部メモリボタンと  DOWNLOAD ボタンの同時押下による設定ファイル、ファームウェ
アファイ  ルのコピー操作を許可するか否かの設定
[書式 ]
operation  external-memory  download  permit  switch
no operation  external-memory  download  permit  [switch ]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on 許可する
off 許可しない
• [初期値 ] : on
[説明 ]
外部メモリボタンと  DOWNLOAD ボタンの同時押下による、設定ファイルとファームウェアファイルのコピー操作
を許可するか否かを設定する。
[適用モデル ]
RTX3510, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.7 外部メモリ内のファイルからの起動を許可するか否かの設定
[書式 ]
external-memory  boot  permit  switch
no external-memory  boot  permit  [switch ]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on 許可する
off 許可しない
• [初期値 ] : on
[説明 ]
外部メモリ内のファイルからの起動を許可するか否かを設定する。この設定を  OFF に設定すると外部メモリ内のフ
ァイルからの起動はできなくなる。
起動時に読み込む設定ファイルとファームウェアファイルの名前はそれぞれ、 external-memory config filename  コマ
ンドと external-memory exec filename  コマンドで設定できる。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | 外部メモリ機能  | 575

42.8 ルーター起動時に外部メモリを検出するまでのタイムアウトを設定する
[書式 ]
external-memory  boot  timeout  time
no external-memory  boot  timeout  [time]
[設定値及び初期値 ]
•time
• [設定値 ] : タイムアウト秒数  (1..30)
• [初期値 ] :
• 1 (RTX840 、RTX830)
• 2 (上記以外 )
[説明 ]
ルーター起動時に外部メモリを検出するまでのタイムアウト時間を設定する。
external-memory boot permit on  コマンドによって、外部メモリ内のファイルからの起動を許可するに設定されてい
る場合に有効である。
接続認識が遅いデバイスの場合、タイムアウト時間を大きくすることで認識されるようになることがある。
[ノート ]
外部メモリ性能測定コマンドで、 boot device attach で表示される時間を目安にして設定するとよい。
[適用モデル ]
RTX3510, RTX1300, RTX840, RTX830
42.9 起動時、あるいは外部メモリボタンと  DOWNLOAD ボタン同時押下により読み込まれ
る、ファームウェアファイル名の指定
[書式 ]
external-memory  exec filename  from [to]
external-memory  exec filename  off
no external-memory  exec filename  [from] [to]
no external-memory  exec filename  [off]
[設定値及び初期値 ]
•from : 外部メモリとファームウェアファイル名
• [設定値 ] :
設定値 説明
usb1: filename USB メモリ内のファームウェアファイル名
sd1:filename microSD カード内のファームウェアファイル名
*:filename USB メモリおよび  microSD カード内のファームウェ
アファイル名
• [初期値 ] :
• *:(機種名 ).bin (RTX5000 、RTX3500 以外の機種 )
• sd1:(機種名 ).bin (RTX5000 、RTX3500)
•to : コピー先ファイル名
• [設定値 ] :
設定値 説明
0～1 内部ストレージ  ( 内蔵フラッシュ  ROM 等 ) の実行形
式ファームウェアファイル番号  (省略時は  0)
• [初期値 ] : 0
[説明 ]
外部メモリを差して起動した時、あるいは外部メモリボタンと  DOWNLOAD ボタンを同時に押下した時に読み込ま
れる、外部メモリ上のファームウェアファイル名を指定する。576 | コマンドリファレンス  | 外部メモリ機能

外部メモリボタンと  DOWNLOAD ボタンを同時に押下した時は、ファームウェアファイルは内部ストレージ  ( 内蔵
フラッシュ  ROM 等 ) にコピーされるが、 その時のコピー先の内部ストレージのファームウェアファイル番号も指定
できる。
外部メモリに "*"を指定した場合、指定するファイルの検索はまず  microSD カードから行われ、指定したファイルが
なければ  USB メモリが検索される。ボタン操作の場合は該当するボタンの外部メモリだけがファイル検索の対象
となる。
filename  は絶対パスを使って指定するかファイル名のみを指定する。ファイル名のみを指定した場合は指定された
外部メモリ内から検索される。 filename  は半角  99 文字以内。
検索の結果複数のファイルが該当する場合、ディレクトリ階層上最もルートディレクトリに近く、アルファベット
順に先のディレクトリにあるファイルが選ばれる。
off に指定した場合、ファームウェアファイルの検索と読み込みを行わない。
[ノート ]
外部メモリのディレクトリ構成やファイル数によっては、ファイルの検索に時間がかかることがある。
検索時間を短くするためには、階層の深いディレクトリの作成は避けてルートに近い位置にファイルを格納したり、
ファイルを絶対パスで直接指定することが望ましい。
自動検索のタイムアウトの時間は external-memory auto-search time  コマンドで設定できる。
[設定例 ]
• microSD カード内から  "rtx1220.bin" を検索し、ファームウェアファイルとして読み込む
# external-memory exec filename sd1:rtx1220.bin
• microSD カード内のディレクトリ  "test" から  "rtx1220.bin" を検索し、ファームウェアファイルとして読み込む
# external-memory exec filename sd1:/test/rtx1220.bin
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.10 起動時、あるいは外部メモリボタンと  DOWNLOAD ボタン同時押下により読み込まれ
る、設定ファイル名の指定
[書式 ]
external-memory  config  filename  from[,from] [to] [password ]
external-memory  config  filename  off
no external-memory  config  filename  [from] [to] [password ]
no external-memory  config  filename  [off]
[設定値及び初期値 ]
•from : 外部メモリと設定ファイル名
• [設定値 ] :
設定値 説明
usb1: filename USB メモリ内の設定ファイル名
sd1:filename microSD カード内の設定ファイル名
*:filename USB メモリおよび  microSD カード内の設定ファイル
名
• [初期値 ] :
• *:config.rtfg,*:config.txt (RTX5000 、RTX3500 以外の機種 )
• sd1:config.rtfg,sd1:config.txt (RTX5000 、RTX3500)
•to : コピー先ファイル名
• [設定値 ] :
設定値 説明
0～4 内部ストレージ  ( 内蔵フラッシュ  ROM 等 ) の設定フ
ァイル番号  (省略時は  0)コマンドリファレンス  | 外部メモリ機能  | 577

• [初期値 ] : 0
•password
• [設定値 ] : 復号パスワード  (ASCII 文字列で半角  8 文字以上、 32 文字以内  )
• [初期値 ] : -
[説明 ]
外部メモリを差して起動した時、あるいは外部メモリボタンと  DOWNLOAD ボタンを同時に押下した時に読み込ま
れる、外部メモリ上の設定ファイル名を指定する。
また外部メモリボタンと  DOWNLOAD ボタンを同時に押下した時は、設定ファイルは内部ストレージ  ( 内蔵フラッ
シュ  ROM 等 ) にコピーされるが、その時のコピー先の内部ストレージの設定ファイル番号も指定できる。
外部メモリに  "*" を指定した場合、指定するファイルの検索はまず  microSD カードから行われ、指定したファイル
がなければ  USB メモリが検索される。ボタン操作の場合は該当するボタンの外部メモリだけがファイル検索の対
象となる。
filename  は絶対パスを使って指定するかファイル名のみを指定する。ファイル名のみを指定した場合は指定された
外部メモリ内から検索される。 filename  は半角  99 文字以内。
検索の結果複数のファイルが該当する場合、ディレクトリ階層上最もルートディレクトリに近く、アルファベット
順に先のディレクトリにあるファイルが選ばれる。
パスワードを指定して暗号化されている設定ファイルを復号して読み込む場合は、 password  に暗号化したときのパ
スワードを設定する。
off に指定した場合、設定ファイルの検索と読み込みを行わない。
[ノート ]
外部メモリのディレクトリ構成やファイル数によっては、ファイルの検索に時間がかかることがある。
検索時間を短くするためには、階層の深いディレクトリの作成は避けてルートに近い位置にファイルを格納したり、
ファイルを絶対パスで直接指定することが望ましい。
自動検索のタイムアウトの時間は external-memory auto-search time  コマンドで設定できる。
外部メモリに暗号化して保存したファイルは、 PC上で  RT-FileGuard を使用して復号することができる。
[設定例 ]
• microSD カード内から  "config.txt" を検索し、設定ファイルとして読み込む
# external-memory config filename sd1:config.txt
• microSD カード内のディレクトリ  "test" から  "config.txt" を検索し、設定ファイルとして読み込む
# external-memory config filename sd1:/test/config.txt
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.11 ファイル検索時のタイムアウトを設定する
[書式 ]
external-memory  auto-search  time  time
no external-memory  auto-search  time  [time]
[設定値及び初期値 ]
•time
• [設定値 ] :
•秒数  (1..600)
• [初期値 ] : 300
[説明 ]
外部メモリに格納されているファイルを検索する時のタイムアウト時間を設定する。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830578 | コマンドリファレンス  | 外部メモリ機能

42.12 バッチファイルを実行する
[書式 ]
execute  batch
[説明 ]
外部メモリのバッチファイルを実行する。実行されるバッチファイル名は external-memory batch filename  コマン
ドで指定する。
[ノート ]
実行中のバッチファイルを中断したい場合は  Ctrl+C を入力する。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.13 バッチファイルと実行結果ファイルの設定
[書式 ]
external-memory  batch  filename  batchfile  [logfile ]
no external-memory  batch  filename  [batchfile  [logfile ]]
[設定値及び初期値 ]
•batchfile  : バッチファイル名
• [設定値 ] :
設定値 説明
usb1: filename USB メモリ内のバッチファイル名
sd1:filename microSD カード内のバッチファイル名
*:filename USB メモリおよび  microSD カード内のバッチファイ
ル名
• [初期値 ] :
• *:command.txt (RTX5000 、RTX3500 以外の機種 )
• sd1:command.txt (RTX5000 、RTX3500)
•logfile
• [設定値 ] :
設定値 説明
filename 実行結果ファイル名
• [初期値 ] : command-log.txt
[説明 ]
外部メモリ内のバッチファイル名と実行結果ファイル名を指定する。
外部メモリに  "*" を指定した場合、指定するファイルの検索はまず  microSD カードから行われ、指定したファイル
がなければ  USB メモリが検索される。
filename  は絶対パスを使ってファイルを指定するかファイル名のみを指定する。バッチファイルの filename  にファ
イル名のみを指定した場合は外部メモリ内から自動検索する。複数のファイルがある場合、ディレクトリ階層上最
もルートディレクトリに近く、アルファベット順に先のディレクトリにあるファイルが選ばれる。
logfile  を省略した場合、 " バッチファイル名  -log.txt" という名前で実行結果ファイルが作成される。
[ノート ]
batchfile  に指定可能な文字数は logfile  を指定した場合は、半角 99文字以内。 logfile  を省略した場合は、拡張子を除
いて半角 91文字以内。
filename  に指定可能な文字数は半角  99 文字以内。
[設定例 ]
• microSD カードのファイルから  "command_test.txt" をバッチファイルとして検索する。
# external-memory batch filename sd1:command_test.txt
• microSD カードのディレクトリ  "test" から  "command_test.txt" を読み込む。コマンドリファレンス  | 外部メモリ機能  | 579

# external-memory batch filename sd1:/test/command_test.txt
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.14 外部メモリ性能測定コマンド
[書式 ]
external-memory  performance-test  go interface
[設定値及び初期値 ]
•interface
• [設定値 ] :
設定値 説明
usb1 USB インタフェース
sd1 microSD インタフェース
• [初期値 ] : -
[説明 ]
外部メモリ機能の使用に耐えうる性能を持つメモリであるか否かを確認する。
外部メモリの認識に要する時間やデータの読み書き速度を確認し、一連のテスト終了後、使用に耐えうる性能を持
つと判断されれば、
• OK:succeeded
そうでないものは
• NG:failed
と表示する。
[ノート ]
外部メモリはフォーマット直後の状態のものを対象とする。
本機能は他の機能を使用していない状態で実行する必要がある。
本コマンド実行中は syslog debug  on、no syslog host が設定される。そのため、 syslog debug  offにしていても DEBUG
タイプの SYSLOG が出力されることがある。また、 syslog host  コマンドを設定していても SYSLOG サーバーにログ
が転送されない。
ヤマハルーターの外部メモリ機能を利用する際に外部メモリに求められる最低限の性能を確認するものであり、本
機能の結果はその外部メモリの全ての動作を保証するものではない。
外部メモリ機能を使用する際は、 show status external-memory  コマンドで外部メモリへの書き込みエラーなどが発生
していないことを定期的に確認することを推奨する。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.15 DOWNLOAD ボタンを押した時に実行する機能の設定
[書式 ]
operation  button  function  download  function  [script_file  [args ...]]
no operation  button  function  download  [function  [script_file  [args ...]]]
[設定値及び初期値 ]
•function  : DOWNLOAD ボタンを押した時に実行する機能
• [設定値 ] :
設定値 説明
http revision-up HTTP リビジョンアップ
execute batch バッチファイルの実行580 | コマンドリファレンス  | 外部メモリ機能

設定値 説明
mobile signal-strength 携帯端末の電波の受信レベルの取得
execute lua Lua スクリプトの実行
• [初期値 ] : http revision-up
•script_file
• [設定値 ] : スクリプトファイル名またはバイトコードファイル名を絶対パスもしくは相対パスで指定する
• [初期値 ] : -
•args
• [設定値 ] : script_file  に渡す可変個引数
• [初期値 ] : -
[説明 ]
DOWNLOAD ボタンを押した時に実行する機能を設定する。機能実行中は  DOWNLOAD ボタンの下のランプが点
灯し、機能の実行が完了すると消灯する。
function  に execute lua を設定した場合、 script_file  を必ず指定する必要がある。 script_file  に相対パスを指定した場合、
環境変数  PWD を基点としたパスと解釈される。 PWD はset コマンドで変更可能であり、初期値は  "/" である。
[ノート ]
Lua スクリプトを実行させる場合、環境変数  LUA_INIT が設定されていれば script_file  よりも先に  LUA_INIT のスク
リプトが実行される。
[適用モデル ]
RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.16 DOWNLOAD ボタンによるバッチファイルの実行を許可するか否かの設定
[書式 ]
operation  execute  batch  permit  permit
no operation  execute  batch  permit  [permit ]
[設定値及び初期値 ]
•permit
• [設定値 ] :
設定値 説明
on DOWNLOAD ボタンによるバッチファイルの実行を
許可する
off DOWNLOAD ボタンによるバッチファイルの実行を
許可しない
• [初期値 ] : off
[説明 ]
DOWNLOAD ボタンによりバッチファイルの実行機能を使用するか否かを設定する。
[適用モデル ]
RTX3510, RTX1300, RTX1220, RTX1210, RTX840, RTX830
42.17 シグネチャーを保存する外部メモリのディレクトリーの設定
[書式 ]
external-memory  dpi signature  directory  path
no external-memory  dpi signature  directory  [path]
[設定値及び初期値 ]
•path
• [設定値 ] : ディレクトリーのパス (半角  99 文字以内 )
• [初期値 ] : -コマンドリファレンス  | 外部メモリ機能  | 581

[説明 ]
シグネチャーを保存する外部メモリのディレクトリーを指定する。
DPI が有効になったとき、本コマンドが設定されており、かつ本コマンドで指定されている外部メモリ上のディレ
クトリーにシグネチャーが存在する場合には、ネットワーク経由のシグネチャーのダウンロードは行わず、外部メ
モリ上のシグネチャーを使用する。
シグネチャーをダウンロードしたとき、  path に指定した外部メモリ上のディレクトリーが存在しなければ、ディレ
クトリーを自動生成して、シグネチャーを保存する。  path に指定したディレクトリーを含む外部メモリが接続され
ていない場合、その間にダウンロードしたシグネチャーは保存できない。その後外部メモリが接続された場合には、
次のシグネチャー更新時にダウンロードしたシグネチャーが保存される。
次の更新を待たずに外部メモリにシグネチャーをダウンロードしたい場合には、 dpi signature download go  コマンド
を force オプションを付けて実行すると、シグネチャーの更新がなくとも直ちにダウンロード、および外部メモリへ
の保存が可能となる。 path で指定したディレクトリーに以前保存したシグネチャーが存在する場合には、新たにダ
ウンロードしたシグネチャーを既存のシグネチャーに上書きして保存する。
[ノート ]
シグネチャーは  "rt_dpi_( 機種名 ).ysig" というファイル名で保存される。例えば、 RTX830 の場合に
は、 "rt_dpi_rtx830.ysig" となる。  path に RTFS 上のディレクトリーを指定することはできない。
RTX830 は Rev.15.02.13 以降で使用可能。
[設定例 ]
• microSD カードの  dpi/signature ディレクトリーにシグネチャーを保存する。
# external-memory dpi signature directory sd:/dpi/signature
[適用モデル ]
RTX830
42.18 FUNC ボタンを押した時に実行する機能の設定
[書式 ]
operation  button  function  func  function  [script_file  [args ...]]
no operation  button  function  func  [function  [script_file  [args ...]]]
[設定値及び初期値 ]
•function  : FUNC ボタンを押した時に実行する機能
• [設定値 ] :
設定値 説明
http revision-up HTTP リビジョンアップ
execute batch バッチファイルの実行
mobile signal-strength 携帯端末の電波の受信レベルの取得
execute lua Lua スクリプトの実行
• [初期値 ] : http revision-up
•script_file
• [設定値 ] : スクリプトファイル名またはバイトコードファイル名を絶対パスもしくは相対パスで指定する
• [初期値 ] : -
•args
• [設定値 ] : script_file  に渡す可変個引数
• [初期値 ] : -
[説明 ]
FUNC ボタンを押した時に実行する機能を設定する。機能実行中は  FUNC ボタンの下のランプが点灯し、機能の実
行が完了すると消灯する。
function  に execute lua を設定した場合、 script_file  を必ず指定する必要がある。 script_file  に相対パスを指定した場合、
環境変数  PWD を基点としたパスと解釈される。 PWD はset コマンドで変更可能であり、初期値は  "/" である。582 | コマンドリファレンス  | 外部メモリ機能

[ノート ]
Lua スクリプトを実行させる場合、環境変数  LUA_INIT が設定されていれば script_file  よりも先に  LUA_INIT のスク
リプトが実行される。
[適用モデル ]
RTX3510コマンドリファレンス  | 外部メモリ機能  | 583

