# 第14章: トンネリング

> 元PDFページ: 271-280

---

第 14 章
トンネリング
14.1 トンネルインターフェースの使用許可の設定
[書式 ]
tunnel  enable  tunnel_num  [tunnel_num  ...]
no tunnel  enable  tunnel_num
[設定値及び初期値 ]
•tunnel_num
• [設定値 ] :
設定値 説明
番号 トンネルインターフェース番号
番号 1-番号 2 番号 1から番号 2までのトンネルインターフェース
番号
番号 1- 番号 1以上のすべてのトンネルインターフェース番
号
-番号 1 番号 1以下のすべてのトンネルインターフェース番
号
all すべてのトンネルインターフェース
• [初期値 ] : -
[説明 ]
トンネルインターフェースを使用できる状態にする。
工場出荷時は、すべてのトンネルインターフェースは  disable 状態であり、使用する場合は本コマンドにより、イン
ターフェースを有効にしなければならない。
複数指定した場合には、その全てで使用できる状態になる。
複数指定は、 RTX5000 / RTX3500 Rev.14.00.25 以前、 RTX1210 Rev.14.01.25 以前、および  RTX830 Rev.15.02.02 以前で
は不可能。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.2 トンネルインターフェースの使用不許可の設定
[書式 ]
tunnel  disable  tunnel_numコマンドリファレンス  | トンネリング  | 271

[設定値及び初期値 ]
•tunnel_num
• [設定値 ] :
設定値 説明
番号 トンネルインターフェース番号
番号 1-番号 2 番号 1から番号 2までのトンネルインターフェース
番号
番号 1- 番号 1以上のすべてのトンネルインターフェース番
号
-番号 1 番号 1以下のすべてのトンネルインターフェース番
号
all すべてのトンネルインターフェース
• [初期値 ] : -
[説明 ]
トンネルインターフェースを使用できない状態にする。
トンネル先の設定を行う場合は、 disable 状態で行うのが望ましい。
複数指定した場合には、その全てで使用できない状態になる。
[ノート ]
トンネルインターフェースの複数指定は、 RTX5000 / RTX3500 Rev.14.00.25 以前、 RTX1210 Rev.14.01.25 以前、およ
び RTX830 Rev.15.02.02 以前では不可能。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.3 トンネルインタフェースの接続種別の設定
[書式 ]
tunnel  type type [role]
no tunnel  type [type [role]]
[設定値及び初期値 ]
•type
• [設定値 ] :
設定値 説明
point-to-point point-to-point トンネル
multipoint point-to-multipoint トンネル
• [初期値 ] : point-to-point
•role
• [設定値 ] :272 | コマンドリファレンス  | トンネリング

設定値 説明
server サーバーの役割を割り当てる
client クライアントの役割を割り当てる
• [初期値 ] : client
[説明 ]
トンネルインタフェースの接続種別を、接続先を  1 箇所だけ持つ  point-to-point トンネル、もしくは、複数の接続先
を持つ  point-to-multipoint トンネル（マルチポイントトンネル）に設定する。
role オプションは  type に multipoint を設定した場合のみ設定可能なオプションで、 マルチポイントトンネルでは同一
のトンネルに接続する複数のルーターの中から  server と client をそれぞれ  1 台以上指定する必要がある。
[ノート ]
マルチポイントトンネルはハブ・アンド・スポーク型の構成を基本構成とし、通常はハブ・ルーターの  role オプシ
ョンのみに  server を指定する。なお、 RTX840、RTX830 Rev.15.02.22 以前では、 server を指定できない。
RTX1210 は、 Rev.14.01.20 以降で使用可能。
RTX5000 / RTX3500 は Rev.14.00.26 以降で使用可能。
[拡張ライセンス対応 ]
RTX830 は、拡張ライセンス  (YSL-VPN-EX1)  がインポートされているときに  role オプションに  server を指定可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.4 トンネルインタフェースの種別の設定
[書式 ]
tunnel  encapsulation  type
no tunnel  encapsulation
[設定値及び初期値 ]
•type
• [設定値 ] :
設定値 説明
ipsec IPsec トンネル
ipip IPv6 over IPv4 トンネル、 IPv4 over IPv6 トンネル、 IPv4
over IPv4 トンネルまたは  IPv6 over IPv6 トンネル
pptp PPTP トンネル
l2tp L2TP/IPsec トンネル
l2tpv3-raw L2TPv3 トンネル
l2tpv3 L2TPv3/IPsec トンネル
ipudp IPUDP トンネル
map-e MAP-E トンネル
hb46pp IPv6 マイグレーション技術の国内標準プロビジョニ
ング方式を利用した  IPv4 over IPv6 トンネル
• [初期値 ] : ipsec
[説明 ]
トンネルインタフェースの種別を設定する。
[ノート ]
トンネリングと  NAT を併用する場合には tunnel endpoint address  コマンドにより始点  IP アドレスを設定すること
が望ましい。コマンドリファレンス  | トンネリング  | 273

PPTP 機能を実装していないモデルでは、 pptp キーワードは使用できない。
L2TP/IPsec 機能を実装していないモデルでは、 l2tp キーワードは使用できない。
L2TPv3機能を実装していないモデルでは、 l2tpv3-raw キーワードおよび  l2tpv3 キーワードは使用できない。
IPUDP トンネルは、データコネクト接続以外では使用できない。
データコネクト接続機能を実装していないモデルでは、 ipudp キーワードは使用できない。
MAP-E 方式を利用した  IPv6 IPoE + IPv4 over IPv6 接続サービスの対応機能を実装していないモデルでは、 map-e キ
ーワードは使用できない。
IPv6 マイグレーション技術の国内標準プロビジョニング方式を実装していないモデルでは、 hb46pp キーワードは使
用できない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.5 トンネルインタフェースの  IPv4 アドレスの設定
[書式 ]
ip tunnel  address  ip_address [/mask ]
no ip tunnel  address  [ip_address [/mask ]]
[設定値及び初期値 ]
•ip_address
• [設定値 ] : IPv4 アドレス
• [初期値 ] : -
•mask
• [設定値 ] :
• xxx.xxx.xxx.xxx(xxx は十進数  )
• 0x に続く十六進数
•マスクビット数
• [初期値 ] : -
[説明 ]
トンネルインタフェースの  IPv4 アドレスとネットマスクを設定する。
このコマンドの設定によりトンネルインタフェースを経由して  BGP のコネクションを確立できるようになる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.6 トンネルインターフェースの相手側の  IPv4 アドレスの設定
[書式 ]
ip tunnel  remote  address  ip_address
no ip tunnel  remote  address  [ip_address ]
[設定値及び初期値 ]
•ip_address
• [設定値 ] : IPv4 アドレス
• [初期値 ] : -
[説明 ]
トンネルインターフェースの相手側の  IPv4 アドレスを設定する。
このコマンドの設定によりトンネルインターフェースを経由して  BGP のコネクションを確立できるようになる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830274 | コマンドリファレンス  | トンネリング

14.7 相手側トンネルインタフェースの端点  IP アドレスの設定
[書式 ]
tunnel  endpoint  remote  address  remote
no tunnel  endpoint  remote  address  [remote ]
[設定値及び初期値 ]
•remote
• [設定値 ] : 相手側のトンネルインタフェース端点の  IP アドレス、またはホスト名 ( 半角 64文字以内  )
• [初期値 ] : -
[説明 ]
相手側のトンネルインタフェース端点の  IP アドレス、またはホスト名を設定する。 IP アドレスは  IPv4/IPv6 いずれ
のアドレスも設定できる。トンネルインタフェース端点として  IPv4 アドレスを設定した場合には、 IPv4 over IPv4 ト
ンネルと  IPv6 over IPv4 トンネルが、 IPv6 アドレスを設定した場合には  IPv4 over IPv6 トンネルと  IPv6 over IPv6 トン
ネルが利用できる。
tunnel endpoint local address  コマンドの設定がない場合、もしくは  local  と remote  で IPv4/IPv6 の種別が異なる場合
は、ローカルエンドポイントアドレスに適当なインターフェースの  IP アドレスが利用される。また、本コマンドで
ホスト名を設定し、 tunnel endpoint local address  コマンドで  IP アドレスを設定した場合、  tunnel endpoint local
address  コマンドの  IPv4/IPv6 種別に従ってホスト名の名前解決が行われる。
[ノート ]
本コマンドにより設定した  IP アドレスおよびホスト名が利用されるのは、 tunnel encapsulation  コマンドの設定値が
ipip の場合である。本コマンドが設定されている場合、 tunnel endpoint address  コマンドおよび  tunnel endpoint
name  コマンドの設定は利用されない。
RTX5000 / RTX3500 は Rev.14.00.22 以降で使用可能。
RTX1210 は Rev.14.01.20 以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.8 自分側トンネルインタフェースの端点  IP アドレスの設定
[書式 ]
tunnel  endpoint  local  address  local
no tunnel  endpoint  local  address  [local ]
[設定値及び初期値 ]
•local
• [設定値 ] : 自分側のトンネルインタフェース端点の  IP アドレス、またはホスト名 ( 半角 64文字以内  )
• [初期値 ] : -
[説明 ]
自分側のトンネルインタフェース端点の  IP アドレス、またはホスト名を設定する。 IP アドレスは  IPv4/IPv6 いずれ
のアドレスも設定できる。トンネルインタフェース端点として  IPv4 アドレスを設定した場合には、 IPv4 over IPv4 ト
ンネルと  IPv6 over IPv4 トンネルが、 IPv6 アドレスを設定した場合には  IPv4 over IPv6 トンネルと  IPv6 over IPv6 トン
ネルが利用できる。
tunnel endpoint remote address  コマンドの設定がない場合、もしくは  local  と remote  で IPv4/IPv6 の種別が異なる場
合は、本コマンドの設定は反映されない。  また、本コマンドでホスト名を設定し、 tunnel endpoint remote address
コマンドで  IP アドレスを設定した場合、  tunnel endpoint remote address  コマンドの  IPv4/IPv6 種別に従ってホスト
名の名前解決が行われる。
[ノート ]
本コマンドにより設定した  IP アドレスおよびホスト名が利用されるのは、 tunnel encapsulation  コマンドの設定値が
ipip の場合である。
RTX5000 / RTX3500 Rev.14.00.21 以前、および  RTX1210 Rev.14.01.19 以前では使用不可能。
IPv6のダイナミックアドレスは、 RTX5000 / RTX3500 Rev.14.00.25 以前、 RTX1210 Rev.14.01.32 以前、および  RTX830
Rev.15.02.07 以前では使用不可能。コマンドリファレンス  | トンネリング  | 275

[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.9 トンネルインタフェースの端点  IP アドレスの設定
[書式 ]
tunnel  endpoint  address  [local ] remote
no tunnel  endpoint  address  [[local ] remote ]
[設定値及び初期値 ]
•local
• [設定値 ] : 自分側のトンネルインタフェース端点の  IP アドレス
• [初期値 ] : -
•remote
• [設定値 ] : 相手側のトンネルインタフェース端点の  IP アドレス
• [初期値 ] : -
[説明 ]
トンネルインタフェース端点の  IP アドレスを設定する。 IP アドレスは  IPv4/IPv6 いずれのアドレスも設定できる
が、 local  と remote  では  IPv4/IPv6 の種別が揃っていなくてはいけない。トンネルインタフェース端点として  IPv4 ア
ドレスを設定した場合には、 IPv4 over IPv4 トンネルと  IPv6 over IPv4 トンネルが、 IPv6 アドレスを設定した場合に
は IPv4 over IPv6 トンネルと  IPv6 over IPv6 トンネルが利用できる。
local  を省略した場合は、適当なインタフェースの  IP アドレスが利用される。
[ノート ]
このコマンドにより設定した  IP アドレスが利用されるのは、 tunnel encapsulation  コマンドの設定値が  pptp、 l2tp、
l2tpv3-raw 、l2tpv3、ipip の場合である。 IPsec トンネルでは、トンネル端点は ipsec ike local address  および ipsec ike
remote address  コマンドにより設定される。
PPTP サーバー、 L2TP/IPsec サーバーの  Anonymous で受ける場合には設定する必要はない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.10 トンネルの端点の名前の設定
[書式 ]
tunnel  endpoint  name  [local_name ] remote_name  [type]
no tunnel  endpoint  name  [local_name  remote_name  type]
[設定値及び初期値 ]
•local_name
• [設定値 ] : 自分側端点
• [初期値 ] : -
•remote_name
• [設定値 ] : 相手側端点
• [初期値 ] : -
•type : 名前の種類
• [設定値 ] :
設定値 説明
fqdn FQDN
tel NGN 網電話番号
• [初期値 ] : fqdn
[説明 ]
トンネル端点の名前を指定する。276 | コマンドリファレンス  | トンネリング

[ノート ]
tunnel endpoint address  コマンドが設定されている場合には、そちらが優先される。
このコマンドが利用されるのは、 tunnel encapsulation  コマンドの設定値が  pptp、l2tpv3-raw 、l2tpv3、ipip、ipudp の
場合である。
pptp、l2tpv3-raw 、l2tpv3、ipip トンネルの場合、名前にはドメイン名  (FQDN) を指定する。
ipudp トンネルの場合、名前には NGN網電話番号を指定する。ハイフン無しで記述する。
データコネクト接続機能を実装していないモデルでは、 type パラメータは使用できない。
ipip トンネルの名前指定は、 RTX5000 / RTX3500 Rev.14.00.21 以前、および  RTX1210 Rev.14.01.19 以前では不可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.11 マルチポイントトンネルのサーバーの設定
[書式 ]
tunnel  multipoint  server  id ip_address
no tunnel  multipoint  server  id [ip_address ]
[設定値及び初期値 ]
•id
• [設定値 ] : サーバー識別子（ 1 .. 3）
• [初期値 ] : -
•ip_address
• [設定値 ] : IPv4 / IPv6 アドレスまたはホスト名
• [初期値 ] : -
[説明 ]
マルチポイントトンネルにおいて、サーバーの役割が割り当てられているルーターのアドレスを設定する。本コマ
ンドは  tunnel type  コマンドで接続種別に  multipoint 、role オプションに  client が設定されているトンネルインタフェ
ース（マルチポイントトンネルのクライアント側のトンネルインタフェース）で有効になる。
本コマンドを複数設定し、複数のサーバーを指定している場合は、接続可能なサーバーすべてに対してトンネルが
接続される。最大で  3 台のサーバーを指定できる。
[ノート ]
マルチポイントトンネルはハブ・アンド・スポーク型の構成を基本構成とし、通常はハブ・ルーターがサーバーと
なる。
RTX1210 は Rev.14.01.20 以降で使用可能。
RTX5000 / RTX3500 は Rev.14.00.26 以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.12 マルチポイントトンネルで使用する自分の名前の設定
[書式 ]
tunnel  multipoint  local  name  name
no tunnel  multipoint  local  name  [name ]
[設定値及び初期値 ]
•name
• [設定値 ] : 名前（半角で  64 文字以内、全角で  32 文字以内）
• [初期値 ] : -
[説明 ]
マルチポイントトンネルで使用する自分の名前を設定する。
本コマンドで設定した名前はトンネル接続後に接続相手にも通知され、接続相手側でもトンネルの識別情報として
SYSLOG 等で利用される。コマンドリファレンス  | トンネリング  | 277

[ノート ]
RTX1210 は Rev.14.01.20 以降で使用可能。
RTX5000 / RTX3500 は Rev.14.00.26 以降で使用可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.13 マルチポイントトンネルで接続する相手の最大数の設定
[書式 ]
tunnel  multipoint  limit  limit
no tunnel  multipoint  limit  [limit]
[設定値及び初期値 ]
•limit
• [設定値 ] :
•最大数（ 1 .. 100） （vRX シリーズ、 RTX5000 、RTX3500 、RTX1210 、RTX1220 、RTX1300 ）
•最大数（ 1 .. 1000） （RTX3510 ）
• [初期値 ] :
• 100（vRX シリーズ、 RTX5000 、RTX3500 、RTX1210 、RTX1220 、RTX1300 ）
• 1000（RTX3510 ）
[説明 ]
選択されているトンネルインタフェースで接続できる相手の最大数を設定する。本コマンドは  tunnel type  コマンド
の接続種別に  multipoint 、role オプションに  server が設定されているトンネルインタフェース（マルチポイントトン
ネルのサーバー側のトンネルインタフェース）で有効になる。
すべてのトンネルインタフェースの接続相手の合計数の上限は各機種ごとに定められているトンネル最大対地数と
なる。そのため、複数のトンネルインタフェースを使用する場合は、本コマンドで設定した最大数の制限だけでな
く、各機種ごとのトンネル最大対地数の制限も受ける。接続相手の数が本コマンドで設定した最大数を下回ってい
る場合でも、すべてのトンネルインタフェースの合計数が各機種ごとのトンネル最大対地数に達している場合は新
たに接続することはできない。
[ノート ]
RTX1210 は Rev.14.01.20 以降で使用可能。
RTX5000 / RTX3500 は Rev.14.00.26 以降で使用可能。
RTX830 は Rev.15.02.22 以降で使用可能。ただし、拡張ライセンスがインポートされていないときは使用不可。
[拡張ライセンス対応 ]
RTX830 は、拡張ライセンス  (YSL-VPN-EX1)  がインポートされているときに本コマンドを使用可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX830
14.14 トンネルインタフェースの MAP-E種別の設定
[書式 ]
tunnel  map-e  type type
no tunnel  map-e  type [type]
[設定値及び初期値 ]
•type
• [設定値 ] :
設定値 説明
v6plus v6プラス
ocn OCNバーチャルコネクトサービス
ipv6option BIGLOBE IPv6 オプション278 | コマンドリファレンス  | トンネリング

• [初期値 ] : v6plus
[説明 ]
トンネルインタフェースの MAP-E種別を設定する。
tunnel encapsulation  コマンドを  map-e  に設定したときに、どの  MAP-E サービスを利用するかを設定する。
[ノート ]
RTX1210 は、 Rev.14.01.34 以降で使用可能。
RTX830 は、 Rev.15.02.10 以降で使用可能。
type パラメーターの  ipv6option キーワードは、 RTX5000 / RTX3500 Rev.14.00.33 以前、 RTX1300 Rev.23.00.04 以前、
RTX1220 Rev.15.04.04 以前、 RTX1210 Rev.14.01.41 以前、および  RTX830 Rev.15.02.28 以前では使用不可能。
[適用モデル ]
RTX1300, RTX1220, RTX1210, RTX840, RTX830
14.15 トンネルインタフェースの変換種別の設定
[書式 ]
tunnel  translation  type
no tunnel  translation  [type]
[設定値及び初期値 ]
•type
• [設定値 ] :
設定値 説明
nat46 NAT46 トンネル
• [初期値 ] : -
[説明 ]
トンネルインタフェースの変換種別を設定する。
[ノート ]
tunnel encapsulation  コマンドとの併用はできず、後から入力したコマンドが有効となる。
RTX830 Rev.15.02.20 以降で使用可能。
RTX1220 Rev.15.04.04 以降で使用可能。
[適用モデル ]
RTX3510, RTX1300, RTX1220, RTX840, RTX830
14.16 IPv6 マイグレーション技術の国内標準プロビジョニング方式でプロビジョニングサー
バーに送信する自分の名前とパスワードの設定
[書式 ]
tunnel  hb46pp  auth  myname  myname  password
no tunnel  hb46pp  auth  myname  [myname  password ]
[設定値及び初期値 ]
•myname
• [設定値 ] : 名前  (32 文字以内 )
• [初期値 ] : -
•password
• [設定値 ] : パスワード  (32 文字以内 )
• [初期値 ] : -コマンドリファレンス  | トンネリング  | 279

[説明 ]
IPv6 マイグレーション技術の国内標準プロビジョニング方式で、プロビジョニングサーバーに送信する自分の名前
とパスワードを設定する。
名前およびパスワードに使用できる文字は、半角英数字およびハイフン  (-)、アンダーバー  (_)。
[ノート ]
RTX3510 は Rev.23.01.02 以降で使用可能。
RTX1300 は Rev.23.00.12 以降で使用可能。
RTX1220 は Rev.15.04.07 以降で使用可能。
RTX830 は Rev.15.02.31 以降で使用可能。
[適用モデル ]
RTX3510, RTX1300, RTX1220, RTX840, RTX830
14.17 IPv6 マイグレーション技術の国内標準プロビジョニング方式で使用するプロビジョニ
ングサーバー名の設定
[書式 ]
tunnel  hb46pp  server  server
no tunnel  hb46pp  server  [server ]
[設定値及び初期値 ]
•server
• [設定値 ] : サーバー名  (255 文字以内 )
• [初期値 ] : -
[説明 ]
IPv6 マイグレーション技術の国内標準プロビジョニング方式で、プロビジョニングサーバーに送信するサーバー名
を半角英数字およびハイフン  (-)、ピリオド  (.) で設定する。
[ノート ]
RTX3510 は Rev.23.01.02 以降で使用可能。
RTX1300 は Rev.23.00.12 以降で使用可能。
RTX1220 は Rev.15.04.07 以降で使用可能。
RTX830 は Rev.15.02.31 以降で使用可能。
[適用モデル ]
RTX3510, RTX1300, RTX1220, RTX840, RTX830280 | コマンドリファレンス  | トンネリング

