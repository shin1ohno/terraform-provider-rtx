# 第50章: 診断

> 元PDFページ: 689-692

---

第 50 章
診断
50.1 ポートの開閉状態の診断
[書式 ]
diagnose  config  port map  interface  protocol  [src_addr  [src_port ]] dst_addr
[設定値及び初期値 ]
•interface
• [設定値 ] : 受信側のインタフェース名  (LAN、PP (pp peer_num ))
• [初期値 ] : -
•protocol
• [設定値 ] : 診断対象のパケット種別  ( カンマで区切って複数指定可能  )
• [設定値 ] :
•プロトコルを表す十進数  (0..255)
•プロトコルを表すニーモニック
設定値 説明
tcp TCP パケット
udp UDP パケット
icmp ICMP パケット
gre PPTP の gre パケット
esp IPsec の esp パケット
ah IPsec の ah パケット
• [初期値 ] : -
•src_addr
• [設定値 ] : 入力パケットの送信元  IP アドレス
• [初期値 ] : -
•src_port
• [設定値 ] : 入力パケットの送信元ポート番号
• [初期値 ] : -
•dst_addr
• [設定値 ] : 診断対象の宛先  IP アドレス  ( カンマで区切って複数指定可能  )
• [初期値 ] : -
[説明 ]
interface  パラメータで指定されたインタフェースから受信するパケットがルーターを通過することが可能か診断を
する。
tcp、udp パケットでは、 dst_addr  パラメータで指定された宛先  IP アドレスのウェルノウンポートに対して、ルータ
ーを通過することのできるポートが存在した場合、その内容を表示する。 tcp、udp 以外のパケットについては、ポ
ートに関する設定は無視され、 dst_addr  までパケットが到達可能であった場合にその内容を表示する。
src_addr、及び、 src_port  が省略された場合、送信元  IP アドレスと送信元ポート番号は、フィルタの設定内容から必
要と思われる組み合わせをルーターが自動的にサンプリングする。
[ノート ]
本コマンドはルーターの内部だけで擬似的にパケットの転送処理を行うことにより実現しているため、 dst_addr  に指
定されるホストに対して診断対象のパケットを送信することはない。そのため、ホスト側では閉じられているポー
トでもルーターを通過することが可能である場合は、そのポートは開いていると判断される。これは、 dst_addr  にル
ーター自身の  IP アドレスが指定された場合も同様であり、ルーター自身のポートの開閉状態を診断するわけではな
い。
なお、本コマンドでは  ethernet フィルタは考慮されない。コマンドリファレンス  | 診断  | 689

[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•peer_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX2 150
[適用モデル ]
RTX1300, RTX1220, RTX1210
50.2 ポートへ到達可能なアクセス範囲の診断
[書式 ]
diagnose  config  port access  interface  [protocol ] dst_addr  dst_port
[設定値及び初期値 ]
•interface
• [設定値 ] : 受信側のインタフェース名  (LAN、PP (pp peer_num ))
• [初期値 ] : -
•protocol  : 診断対象のパケット種別  ( カンマで区切って複数指定可能、省略時は全種別  )
• [設定値 ] :
設定値 説明
tcp TCP パケット
udp UDP パケット
• [初期値 ] : -
•dst_addr
• [設定値 ] : 診断対象の宛先  IP アドレス
• [初期値 ] : -
•src_port
• [設定値 ] : 診断対象の宛先ポート番号
• [初期値 ] : -
[説明 ]
dst_addr /dst_port  パラメータで指定されたホストのポート番号へ、 protocol  パラメータで指定されたパケットが到達
可能な送信元  IP アドレスと送信元ポート番号の範囲を表示する。
[ノート ]
本コマンドはルーターの内部だけで擬似的にパケットの転送処理を行うことにより実現しているため、 dst_addr  に指
定されるホストに対して診断対象のパケットを送信することはない。そのため、ホスト側では閉じられているポー
トでもルーターを通過することが可能である場合は、そのポートへ到達可能と判断される。これは、 dst_addr  にルー
ター自身の  IP アドレスが指定された場合も同様であり、ルーター自身のポートの開閉状態には依存しない。
なお、本コマンドでは  ethernet フィルタは考慮されない。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•peer_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX2 150
[適用モデル ]
RTX1300, RTX1220, RTX1210690 | コマンドリファレンス  | 診断

50.3 ポートの開閉状態の診断で検出可能な通過パケットの最大数の設定
[書式 ]
diagnosis  config  port max-detect  num
[設定値及び初期値 ]
•num
• [設定値 ] : 検出可能な通過パケットの最大数  (100..1000000)
• [初期値 ] : 2000
[説明 ]
ポートの開閉状態の診断、および、ポートへ到達可能なアクセス範囲の診断で検出が可能な通過パケットの最大数
を設定する。この数値を超えて通過パケットを検出した場合、診断が中断される。
[ノート ]
ポートの開閉状態の診断結果では、通過可能な送信元アドレス空間と送信元ポート番号空間を可能な限り集約して
表示している。しかし、集約前の通過数が本設定値を超えた時点で診断が中断されるため、診断結果で表示される
通過数が、実際には本設定値を下回る場合でも診断が中断されることがある。
[適用モデル ]
RTX1300, RTX1220, RTX1210
50.4 ポートの開閉状態の診断結果の履歴数の設定
[書式 ]
diagnosis  config  port history-num  num
[設定値及び初期値 ]
•num
• [設定値 ] : 診断結果として保存する履歴数  (1..10)
• [初期値 ] : 3
[説明 ]
ポートの開閉状態の診断、および、ポートへ到達可能なアクセス範囲の診断の診断結果として保存する履歴数を設
定する。
[ノート ]
本コマンドを実行したときに設定値を上回る履歴が既に保存されていた場合、設定値を超える履歴は消去される。
[適用モデル ]
RTX1300, RTX1220, RTX1210
50.5 ポートの開閉状態の診断結果の表示
[書式 ]
show  diagnosis  config  port map
[説明 ]
ポートの開閉状態の診断結果を表示する。
[適用モデル ]
RTX1300, RTX1220, RTX1210
50.6 ポートへ到達可能なアクセス範囲の診断結果の表示
[書式 ]
show  diagnosis  config  port access
[説明 ]
ポートへ到達可能なアクセス範囲の診断結果を表示する。
[適用モデル ]
RTX1300, RTX1220, RTX1210コマンドリファレンス  | 診断  | 691

50.7 ポートの開閉状態の診断結果の消去
[書式 ]
clear  diagnosis  config  port
[説明 ]
ポートの開閉状態の診断、および、ポートへ到達可能なアクセス範囲の診断の診断結果をすべて消去する。
[適用モデル ]
RTX1300, RTX1220, RTX1210692 | コマンドリファレンス  | 診断

