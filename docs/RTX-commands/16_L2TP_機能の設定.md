# 第16章: L2TP 機能の設定

> 元PDFページ: 340-345

---

第 16 章
L2TP 機能の設定
L2TP/IPsec 機能
L2TP (Layer Two Tunneling Protocol) は、 ネットワーク間での  VPN (Virtual Private Network) 接続を実現するトンネリン
グプロトコルです。 L2TP 自体は暗号化の仕組みを持ちませんが、 IPsec を併用することでデータの機密性や完全性
を確保した  VPN 接続を実現する  L2TP/IPsec があります。  ヤマハルーターは、 L2TP/IPsec を用いたリモートアクセ
ス VPN のサーバーとして動作します。スマートフォンなどに搭載されている  L2TP クライアントからインターネッ
ト越しにヤマハルーター配下のプライベートネットワーク内の端末とのセキュアな通信を可能にします。
ヤマハルーターでサポートする  L2TP/IPsec には以下の制限があります。
• L2TP 単体での機能は提供しません。 L2TP/IPsec のみサポートします。
•リモートアクセス  VPN のサーバーとして動作します。クライアントとしては動作しません。
• LAN間接続  VPN には対応していません。
• L2TP パケットの最初の待ち受けは  UDP のポート番号  1701 が使用されます。変更することはできません。
• IKEv1 にのみ対応しており、 IKEv2 は使用できません。
L2TPv3機能
L2TPv3 (Layer 2 Tunneling Protocol version 3) は、 データリンク層 (L2)での VPN接続  (L2VPN) を実現するトンネリング
プロトコルです。 L2フレームを IPパケットとしてカプセル化することでルーター間での L2フレーム転送を可能
にし、複数の拠点で同一セグメントのネットワークを構築することができます。 L2TPv3自体は暗号化の仕組みを持
ちませんが、 IPsecと併用することでデータの機密性や完全性を確保した VPN接続を実現する L2TPv3/IPsec があり
ます。ヤマハルーターでは、 L2TPv3を用いた L2VPNおよび L2TPv3/IPsec を用いた L2VPNを構築することができ
ます。
ヤマハルーターでサポートする  L2TPv3 には以下の制限があります。
• L2フレームのカプセル化方式として、 UDPパケットとしてカプセル化する方法 (L2TPv3 over UDP) にのみ対応し
ています。 IPプロトコル番号 115を使用して IPパケットとしてカプセル化する方法 (L2TPv3 over IP) には対応し
ていません。
• L2TPv3 パケットの受信には UDPのポート番号 1701が使用されます。変更することはできません。
• L2TPv3 によってトンネリングできる L2フレームは、イーサフレームのみです。
• L2TPv3/IPsec では、 IKEv1のトランスポートモードのみ対応しています。
16.1 L2TP を動作させるか否かの設定
[書式 ]
l2tp service  service  [version  [version ]]
no l2tp service  [service  [version  [version ]]]
[設定値及び初期値 ]
•service
• [設定値 ] :
設定値 説明
on L2TP を有効にする
off L2TP を無効にする
• [初期値 ] : off
•version
• [設定値 ] :
設定値 説明
l2tp L2TP/IPsec を有効にする
l2tpv3 L2TPv3, L2TPv3/IPsec を有効にする
• [初期値 ] : -340 | コマンドリファレンス  | L2TP 機能の設定

[説明 ]
L2TP を動作させるか否かを設定する。
version によって動作する L2TPのバージョンを指定できる。 version を指定しない場合には  L2TPv2 と L2TPv3 の両
方が動作する。
L2TPが有効になると  UDP のポート番号  1701 を開き、 L2TP コネクションの接続を待つ。
L2TPが無効になると  UDP のポート番号  1701 を閉じ、接続中の  L2TP コネクションはすべて切断される。
[ノート ]
version オプションは、 vRX Amazon EC2 版 では指定不可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
16.2 L2TP トンネル認証に関する設定
[書式 ]
l2tp tunnel  auth  switch  [password ]
no l2tp tunnel  auth  [switch  ...]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on L2TPトンネル認証を行う
off L2TPトンネル認証を行わない
• [初期値 ] : off
•password
• [設定値 ] : L2TP トンネル認証に用いるパスワード (32文字以内 )
• [初期値 ] : -
[説明 ]
L2TP トンネル認証を行うか否かを設定する。
password を省略した場合には機種名  ( vRX シリーズ  の場合は  "vRX" ) がパスワードとして使用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
16.3 L2TP トンネルの切断タイマの設定
[書式 ]
l2tp tunnel  disconnect  time  time
no l2tp tunnel  disconnect  time  [time]
[設定値及び初期値 ]
•time
• [設定値 ] :
設定値 説明
1..21474836 秒数
off タイマを設定しない
• [初期値 ] : 60
[説明 ]
L2TP トンネルの切断タイマを設定する。コマンドリファレンス  | L2TP 機能の設定  | 341

選択されている  L2TP トンネルに対して、データパケット無入力・無送信時に、タイムアウトにより  L2TP トンネル
を切断する時間を設定する。
L2TP 制御メッセージ以外はすべてデータパケットとなるため、 PPP キープアライブを使用する場合などは切断タイ
マによる  L2TP トンネルの切断は行われない場合がある。
トンネルインタフェースにのみ設定可能です。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
16.4 L2TP キープアライブの設定
[書式 ]
l2tp keepalive  use switch  [intarval  [count ]]
no l2tp keepalive  use [switch  ...]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on L2TPキープアライブを使用する
off L2TPキープアライブを使用しない
• [初期値 ] : on
•interval
• [設定値 ] : キープアライブパケットを送出する時間間隔 [秒] (1..600)
• [初期値 ] : 10
•count
• [設定値 ] : ダウン検出を判定する回数  (1..50)
• [初期値 ] : 6
[説明 ]
L2TP キープアライブを使用するか否かを選択する。
キープアライブを行う場合は  interval  と count  の設定値の応じて  L2TP の Hello メッセージによるキープアライブが
動作する。
トンネルインタフェースにのみ設定可能です。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
16.5 L2TP キープアライブのログ設定
[書式 ]
l2tp keepalive  log log
no l2tp keepalive  log [log]
[設定値及び初期値 ]
•log
• [設定値 ] :
設定値 説明
on L2TP キープアライブをログに出力する
off L2TP キープアライブをログに出力しない
• [初期値 ] : off342 | コマンドリファレンス  | L2TP 機能の設定

[説明 ]
L2TPキープアライブのログを出力するか否かを設定する。
ログはすべて、 debug レベルの  SYSLOG に出力される。
トンネルインタフェースにのみ設定可能です。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
16.6 L2TP のコネクション制御の  syslog を出力するか否かの設定
[書式 ]
l2tp syslog  syslog
no l2tp syslog  [syslog ]
[設定値及び初期値 ]
•syslog
• [設定値 ] :
設定値 説明
on L2TP のコネクション制御に関するログを  SYSLOG
に出力する
off L2TP のコネクション制御に関するログを  SYSLOG
に出力しない
• [初期値 ] : off
[説明 ]
L2TP のコネクション制御に関するログを  SYSLOG に出力するか否かを設定する。
L2TP のキープアライブに関するログは出力されない。
ログはすべて、 debug レベルの  SYSLOG に出力される。
トンネルインタフェースにのみ設定可能です。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
16.7 L2TPv3 の常時接続の設定
[書式 ]
l2tp always-on  sw
no l2tp always-on  [sw]
[設定値及び初期値 ]
•sw
• [設定値 ] :
設定値 説明
on 常時接続する
off 常時接続しない
• [初期値 ] : on
[説明 ]
L2TPv3 のコネクションを常時接続するか否かを設定する。
トンネルインターフェースにのみ設定可能です。コマンドリファレンス  | L2TP 機能の設定  | 343

[ノート ]
RTX5000 は Rev.14.00.12 以降で使用可能。
RTX3500 は Rev.14.00.12 以降で使用可能。
[適用モデル ]
vRX VMware ESXi 版, vRX さくらのクラウド版 , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210,
RTX840, RTX830
16.8 L2TP トンネルのホスト名の設定
[書式 ]
l2tp hostname  hostname
no l2tp hostname  [name ]
[設定値及び初期値 ]
•name
• [設定値 ] : ホスト名  (32文字以内 )
• [初期値 ] : 機種名
[説明 ]
接続相手に通知するホスト名を設定する。
show status l2tp コマンドで出力される  L2TP トンネル情報に表示される。
本コマンドを設定しない場合には機種名がホスト名として使用される。
トンネルインターフェースのみ設定可能です。
[ノート ]
RTX5000 は Rev.14.00.12 以降で使用可能。
RTX3500 は Rev.14.00.12 以降で使用可能。
[適用モデル ]
vRX VMware ESXi 版, vRX さくらのクラウド版 , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210,
RTX840, RTX830
16.9 L2TPv3 の Local Router ID の設定
[書式 ]
l2tp local  router-id  ipv4_address
no l2tp local  router-id  [ipv4_address ]
[設定値及び初期値 ]
•ipv4_address
• [設定値 ] : IPv4 アドレス
• [初期値 ] : 0.0.0.0
[説明 ]
L2TPv3 の接続相手に通知する  Router ID を設定する。
接続相手の  Remote Router ID と同じ  IPv4 アドレスを設定します。
ルーターに設定されている  IPv4 アドレスを使用する必要はない。
トンネルインターフェースにのみ設定可能です。
[ノート ]
RTX5000 は Rev.14.00.12 以降で使用可能。
RTX3500 は Rev.14.00.12 以降で使用可能。344 | コマンドリファレンス  | L2TP 機能の設定

[適用モデル ]
vRX VMware ESXi 版, vRX さくらのクラウド版 , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210,
RTX840, RTX830
16.10 L2TPv3 の Remote Router ID の設定
[書式 ]
l2tp remote  router-id  ipv4_address
no l2tp remote  router-id  [ipv4_address ]
[設定値及び初期値 ]
•ipv4_address
• [設定値 ] : IPv4 アドレス
• [初期値 ] : 0.0.0.0
[説明 ]
L2TPv3 の接続相手の  Router ID を設定する。
接続相手の  Local Router ID と同じ  IPv4 アドレスを設定する。
ルーターに設定されている  IPv4 アドレスを使用する必要はない。
トンネルインターフェースにのみ設定可能です。
[ノート ]
RTX5000 は Rev.14.00.12 以降で使用可能。
RTX3500 は Rev.14.00.12 以降で使用可能。
[適用モデル ]
vRX VMware ESXi 版, vRX さくらのクラウド版 , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210,
RTX840, RTX830
16.11 L2TPv3 の Remote End ID の設定
[書式 ]
l2tp remote  end-id  end-id
no l2tp remote  end-id  [end-id ]
[設定値及び初期値 ]
•end-id
• [設定値 ] : 任意文字列 (32文字以内 )
• [初期値 ] : なし
[説明 ]
L2TPv3 の Remote End ID を設定する。
接続相手の  Remote End ID と同じ文字列を設定する。
トンネルインターフェースにのみ設定可能です。
[ノート ]
RTX5000 は Rev.14.00.12 以降で使用可能。
RTX3500 は Rev.14.00.12 以降で使用可能。
[適用モデル ]
vRX VMware ESXi 版, vRX さくらのクラウド版 , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210,
RTX840, RTX830コマンドリファレンス  | L2TP 機能の設定  | 345

