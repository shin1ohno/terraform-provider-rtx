# 第40章: 生存通知機能　リリース  2

> 元PDFページ: 561-566

---

第 40 章
生存通知機能　リリース  2
生存通知機能とは、ネットワークに接続しているルーターから他拠点のルーターへ、自分の名前と  IP アドレスを含
めたパケットを送り、通信できる状態であることを通知する機能です。通知パケットを受信したルーターは、通知
された名前と  IP アドレスをログに出力し、保存します。 WAN の IP アドレスが不定となる拠点のルーターから他拠
点のルーターへ通信可能であることを知らせる手段として本機能を利用することができます。
リリースについて
前章で説明する従来の生存通知機能はリリース  1、 本章で説明する生存通知機能はリリース  2 と区別します。両者の
機能概念は同じですが、コマンド体系、動作には互換性がありませんので注意してください。
リリース  2 の特徴
•生存通知パケットとして  UDP ／ 8512 番ポートを使用します  ( 始点／終点ともに  ) 。
•生存通知を受信したルーターでは、通知された名前によって送信元のルーターを識別します。そのため、生存通
知を送信するルーター毎に固有の名前を設定する必要があります。
•送信側ルーター、受信側ルーターで共通の暗号鍵、および認証鍵を持つことにより、通知情報の暗号化や改竄の
検出が可能となります。
•多対地通信における運用管理を容易にするため、送信／受信設定はそれぞれ識別子を指定することで複数設定で
きるようになっています。ここで、ペアとなる送信側の送信設定と受信側の受信設定は、それぞれ同じ識別子を
指定する必要があります。この設定識別子を通知パケットに含めることにより、受信側は任意の通知パケットに
対して使用する受信設定を一意に決定します。
•従来、 schedule  コマンドと組み合わせることで実現していた通知の定期送信は、送信設定コマンドのみで実施で
きるようになります。
•通知する  IP アドレスは原則として生存通知パケットの送出インタフェースに設定されている  IP アドレスとなり
ます。ここで、当該インタフェースに  NAT や IP マスカレードが設定されていれば、送出する通知パケットに
NAT ／ IP マスカレード設定を適用した場合の  IP アドレスが使用されます。  ただし、 unnumbered 接続の回線を
使用して生存通知パケットを送信する場合は、 IP アドレスが設定されている  LAN インタフェースの中で、若番
のインタフェースから優先的に  IP アドレスを選択して通知します  ( 通知パケットの  IP ヘッダの始点アドレスと
同期  ) 。
•受信した生存通知の情報を  show status heartbeat2  コマンドで表示することができます。
40.1 通知名称の設定
[書式 ]
heartbeat2  myname  name
no heartbeat2  myname
[設定値及び初期値 ]
•name
• [設定値 ] : 生存通知で使用する名称  (1～64 文字 /ASCII、1～32 文字 /シフト  JIS)
• [初期値 ] : -
[説明 ]
生存通知で通知する本機の名称を設定する。
name  には  ASCII 文字だけではなく、シフト  JIS で表現できる範囲の日本語文字  ( 半角カタカナを除く  ) も使用でき
る。ただし、 console character  コマンドの設定が  sjis の場合にのみ正しく設定、表示でき、他の設定では意図した通
りに処理されない場合がある。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.2 通知設定の定義
[書式 ]
heartbeat2  transmit  trans_id  [crypto crypto_key ] auth auth_key  dest_addr  ...
no heartbeat2  transmit  trans_id
[設定値及び初期値 ]
•trans_idコマンドリファレンス  | 生存通知機能　リリース  2 | 561

• [設定値 ] : 通知設定の識別子  (1..65535)
• [初期値 ] : -
•crypto_key
• [設定値 ] : ASCII 文字列で表した暗号鍵  (1～32 文字  )
• [初期値 ] : -
•auth_key
• [設定値 ] : ASCII 文字列で表した認証鍵  (1～32 文字  )
• [初期値 ] : -
•dest_addr
• [設定値 ] : 送信先ルーターの  IPv4 アドレス、または  FQDN( 空白で区切って  4 つまで指定可能  )
• [初期値 ] : -
[説明 ]
生存通知の定期的な送信設定を定義する。本コマンドで設定した auth_key  を元に、通知パケットには認証情報が付
与される。また、 crypto_key  を指定した場合は更に通知内容が暗号化される。
対応する受信側の設定として heartbeat2 receive  コマンドを設定する際には、 recv_id  が本コマンドの trans_id  と一致
していなければならない。また同様に、 crypto_key 、auth_key  も一致させる必要がある。
本コマンドは送信に最低限必要なパラメータを trans_id  に紐付けて定義するためのものである。実際に送信処理を
有効にするには heartbeat2 transmit enable  コマンドを設定する必要がある。
なお、複数の通知設定による送信負荷を分散させるため、通知設定が有効になってから最初に通知パケットを送信
するまでの時間は、通知設定／宛先毎にランダムとなる  ( ただし  30 秒以内  )。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.3 通知設定の有効化
[書式 ]
heartbeat2  transmit  enable  [one-shot] trans_id_list
no heartbeat2  transmit  enable
[設定値及び初期値 ]
•trans_id_list  : 有効にしたい通知設定の識別子のリスト
• [設定値 ] :
• 1 個の数字、または間に  - をはさんだ数字  ( 範囲指定  )、およびこれらを任意に並べたもの  (128 個以内  )
• [初期値 ] : -
[説明 ]
定義した通知設定から実際に有効にしたいものを指定する。
識別子のリストは空白で区切って  128 個まで指定することができる。
'one-shot' キーワードを指定した場合は、 trans_id_list  で指定された各設定の通知処理を  1 回だけ実行する。なお、こ
の形式で入力したコマンドは保存できない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.4 通知間隔の設定
[書式 ]
heartbeat2  transmit  interval  time
heartbeat2  transmit  interval  trans_id  time
no heartbeat2  transmit  interval  [time]
no heartbeat2  transmit  interval  trans_id  time
[設定値及び初期値 ]
•trans_id
• [設定値 ] : 通知設定の識別子562 | コマンドリファレンス  | 生存通知機能　リリース  2

• [初期値 ] : -
•time
• [設定値 ] : 通知間隔秒数  (30..65535)
• [初期値 ] : 30
[説明 ]
trans_id  に対応する通知設定の送信間隔を指定する。
trans_id  を省略した場合は全ての通知設定が適用対象となる。
ただし、 trans_id  を個別に指定した設定の方が優先して適用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.5 通知を送信した際にログを記録するか否かの設定
[書式 ]
heartbeat2  transmit  log [trans_id ] sw
no heartbeat2  transmit  log [trans_id ]
[設定値及び初期値 ]
•trans_id
• [設定値 ] : 通知設定の識別子
• [初期値 ] : -
•sw
• [設定値 ] :
設定値 説明
on 送信した内容を  syslog に出力する
off 送信した内容を  syslog に出力しない
• [初期値 ] : off
[説明 ]
trans_id  に対応する通知設定のログ出力に関する設定を行う。 sw を 'on' にした場合、生存通知を送信する際に  INFO
レベルの  syslog を出力する。
trans_id  を省略した場合は全ての通知設定が適用対象となる。ただし、 trans_id  を個別に指定した設定の方が優先し
て適用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.6 受信設定の定義
[書式 ]
heartbeat2  receive  recv_id  [crypto crypto_key ] auth auth_key
no heartbeat2  receive  recv_id
[設定値及び初期値 ]
•recv_id
• [設定値 ] : 受信設定の識別子
• [初期値 ] : -
•crypto_key
• [設定値 ] : ASCII 文字列で表した暗号鍵  (1～32 文字  )
• [初期値 ] : -
•auth_key
• [設定値 ] : ASCII 文字列で表した認証鍵  (1～32 文字  )
• [初期値 ] : -コマンドリファレンス  | 生存通知機能　リリース  2 | 563

[説明 ]
生存通知の受信設定を定義する。受信処理を行う際は、通知パケットに含まれる送信側の設定識別子  (trans_id ) を元
に、同じ recv_id  を持つ本コマンドの設定を使用して復号化、認証チェックが行われる。
対応する送信側の設定として heartbeat2 transmit  コマンドを設定する際には、 trans_id  が本コマンドの recv_id  と一
致していなければならない。また同様に、 crypto_key 、auth_key  も一致させる必要がある。
本コマンドは受信に最低限必要なパラメータを recv_id  に紐付けて定義するためのものである。実際に受信処理を
有効にするには heartbeat2 receive enable  コマンドを設定する必要がある。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.7 受信設定の有効化
[書式 ]
heartbeat2  receive  enable  recv_id_list
no heartbeat2  receive  enable
[設定値及び初期値 ]
•recv_id_list  : 有効にしたい受信設定の識別子のリスト
• [設定値 ] :
• 1 個の数字、または間に  - をはさんだ数字  ( 範囲指定  )、およびこれらを任意に並べたもの  (128 個以内  )
• [初期値 ] : -
[説明 ]
定義した受信設定から実際に有効にしたいものを指定する。
識別子のリストは空白で区切って  128 個まで指定することができる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.8 受信間隔の監視設定
[書式 ]
heartbeat2  receive  monitor  time
heartbeat2  receive  monitor  recv_id  time
no heartbeat2  receive  monitor  [time]
no heartbeat2  receive  monitor  recv_id  time
[設定値及び初期値 ]
•recv_id
• [設定値 ] : 受信設定の識別子
• [初期値 ] : -
•time : 監視時間
• [設定値 ] :
設定値 説明
30..21474836 秒数
off 受信間隔を監視しない
• [初期値 ] : off
[説明 ]
recv_id  に対応する受信設定における受信間隔の監視設定を行う。監視が有効な場合は、指定した時間内に生存通知
が届かないとき  INFO レベルの  syslog を出力して  SNMP トラップを送出する。
recv_id  を省略した場合は全ての受信設定が適用対象となる。ただし、 recv_id  を個別に指定した設定の方が優先して
適用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830564 | コマンドリファレンス  | 生存通知機能　リリース  2

40.9 通知を受信した際にログを記録するか否かの設定
[書式 ]
heartbeat2  receive  log [recv_id ] sw
no heartbeat2  receive  log [recv_id ]
[設定値及び初期値 ]
•recv_id
• [設定値 ] : 受信設定の識別子
• [初期値 ] : -
•sw
• [設定値 ] :
設定値 説明
on 受信した内容を  syslog に出力する
off 受信した内容を  syslog に出力しない
• [初期値 ] : off
[説明 ]
recv_id  に対応する受信設定のログ出力に関する設定を行う。 sw を 'on' にした場合、生存通知を送信する際に  INFO
レベルの  syslog を出力する。
recv_id  を省略した場合は全ての受信設定が適用対象となる。ただし、 recv_id  を個別に指定した設定の方が優先して
適用される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.10 同時に保持できる生存情報の最大数の設定
[書式 ]
heartbeat2  receive  record  limit  num
no heartbeat2  receive  record  limit
[設定値及び初期値 ]
•num
• [設定値 ] : 生存情報の最大保持数  (vRX シリーズ、 RTX5000 、RTX3510 、RTX3500 ：64..10000 、それ以外の機
種： 64..1000)
• [初期値 ] : 64
[説明 ]
受信した生存情報を同時に保持できる最大数を設定する。生存情報数が最大に達した状態では新規の情報を取り込
むことができない。そのような場合は clear heartbeat2  コマンドで不要な情報を削除する必要がある。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.11 生存通知の状態の表示
[書式 ]
show  status  heartbeat2
show  status  heartbeat2  id recv_id
show  status  heartbeat2  name  string
[設定値及び初期値 ]
•recv_id
• [設定値 ] : 受信設定の識別子
• [初期値 ] : -
•string
• [設定値 ] : 文字列  (1～64 文字 /ASCII、1～32 文字 /シフト  JIS)
• [初期値 ] : -コマンドリファレンス  | 生存通知機能　リリース  2 | 565

[説明 ]
受信した生存通知の情報を表示する。
第 1 書式では保持している全ての情報を表示する。
第 2 書式では指定の受信設定により受信した情報のみ表示する。
第 3 書式では指定の文字列が通知名称に含まれる情報のみ表示する。
string  には  ASCII 文字だけではなく、シフト  JIS で表現できる範囲の日本語文字  ( 半角カタカナを除く  ) も使用でき
る。ただし、 console character  コマンドの設定が  sjis の場合にのみ正しく動作し、他の設定では誤動作する場合が  あ
る。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
40.12 生存通知の状態のクリア
[書式 ]
clear  heartbeat2
clear  heartbeat2  id recv_id
clear  heartbeat2  name  string
[設定値及び初期値 ]
•recv_id
• [設定値 ] : 受信設定の識別子
• [初期値 ] : -
•string
• [設定値 ] : 文字列  (1～64 文字 /ASCII、1～32 文字 /シフト  JIS)
• [初期値 ] : -
[説明 ]
受信した生存通知の情報をクリアする。
第 1 書式では保持している全ての情報をクリアする。
第 2 書式では指定の受信設定により受信した情報のみクリアする。
第 3 書式では指定の文字列が通知名称に含まれる情報のみクリアする。
string  には  ASCII 文字だけではなく、シフト  JIS で表現できる範囲の日本語文字  ( 半角カタカナを除く  ) も使用でき
る。ただし、 console character  コマンドの設定が  sjis の場合にのみ正しく動作し、他の設定では誤動作する場合が  あ
る。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830566 | コマンドリファレンス  | 生存通知機能　リリース  2

