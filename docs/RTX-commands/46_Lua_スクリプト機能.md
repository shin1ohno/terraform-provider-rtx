# 第46章: Lua スクリプト機能

> 元PDFページ: 617-620

---

第 46 章
Lua スクリプト機能
Lua 言語で記述されたスクリプトを実行する機能です。 Lua スクリプトにヤマハルーター専用  API を埋め込むこと
で、ルーターの状態に応じて、ルーターの設定変更やアクションをプログラミングすることが可能になります。
46.1 Lua スクリプト機能を有効にするか否かの設定
[書式 ]
lua use switch
no lua use [switch ]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on 有効にする
off 無効にする
• [初期値 ] : on
[説明 ]
Lua スクリプト機能を有効にするか否かを設定をする。
Lua スクリプトの走行中に当コマンドで  Lua スクリプト機能を無効にした場合、走行中のすべての  Lua スクリプト
は強制終了される。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
46.2 Lua スクリプトの実行
[書式 ]
lua [-e stat] [-l module ] [-v] [ --] [script_file  [args ...]]
[設定値及び初期値 ]
•stat
• [設定値 ] : スクリプト文字列
• [初期値 ] : -
•module
• [設定値 ] : ロード  (requireする  ) モジュール名
• [初期値 ] : -
•script_file
• [設定値 ] : スクリプトファイル名またはバイトコードファイル名を絶対パスもしくは相対パスで指定する
• [初期値 ] : -
•args
• [設定値 ] : script_file  に渡す可変個引数
• [初期値 ] : -
[説明 ]
Lua スクリプトを実行する。
基本的な文法は  Lua 標準の lua コマンドと同じであるが、 標準入力  (stdin) をスクリプトの入力対象とする  -i/- オプシ
ョンと、パラメータなしの実行には対応していない。 -v オプションはバージョン情報を出力する。 -- オプションは
記述したポイントでオプション処理を終了することを表し、 script_file  やargs に "-" で始まるファイル名および文字
列を指定できるようになる。なお、 -e/-l/-v の各オプションは繰り返して複数個指定できるが script_file  よりも後に指コマンドリファレンス  | Lua スクリプト機能  | 617

定することはできない。 script_file  は 1 つしか指定できず、 script_file  を記述したポイント以降のパラメータはすべて
無視される。このとき、エラーメッセージは出力されない。
script_file  に相対パスを指定した場合、環境変数  PWD を基点としたパスと解釈される。 PWD はset コマンドで変更
可能であり、初期値は  "/" である。
[ノート ]
環境変数  LUA_INIT が設定されている場合は、そのスクリプトが最初に実行される。
script_file  にバイトコードファイルを指定する場合、 ルーター上で生成したバイトコードだけが実行可能であり、 Lua
をインストールした  PC 等で生成したバイトコードは実行できない。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
46.3 Lua コンパイラの実行
[書式 ]
luac [-l] [-o output_file ] [-p] [-s] [-v] [ --] script_file  [script_file  ..]
[設定値及び初期値 ]
•output_file
• [設定値 ] : バイトコードの出力先のファイル名を絶対パスもしくは相対パスで指定する
• [初期値 ] : luac.out ( 相対パス  )
•script_file
• [設定値 ] : コンパイル対象のスクリプトファイル名を絶対パスもしくは相対パスで指定する
• [初期値 ] : -
[説明 ]
Lua コンパイラを実行し、バイトコードを生成する。
基本的な文法は  Lua 標準の luac コマンドと同じであるが、 - オプションは指定できない。 -l オプションは生成したバ
イトコードをリスト表示する。 -p オプションは構文解析のみを行う。 -s オプションはコメント等のデバッグ情報を
取り除く。 -v オプションはバージョン情報を出力する。 -- オプションは記述したポイントでオプション処理を終了
することを表し、 script_file  に "-" で始まるファイル名を指定できるようになる。なお、 script_file  を複数指定して、
一つのバイトコードファイルにまとめることもできる。
script_file /output_file  に相対パスを指定した場合、 環境変数  PWD を基点としたパスと解釈される。 PWD はset コマン
ドで変更可能であり、初期値は  "/" である。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
46.4 Lua スクリプトの走行状態の表示
[書式 ]
show  status  lua [info]
[設定値及び初期値 ]
•info : 表示する情報の種類
• [設定値 ] :
設定値 説明
running 走行中のスクリプトに関する情報
history 過去に走行したスクリプトに関する情報
省略 すべての情報を表示する
• [初期値 ] : -
[説明 ]
現在の  Lua スクリプトの走行状態や過去の走行履歴を表示する。この情報は lua use  コマンドで  Lua スクリプト機
能を無効にするとクリアされる。618 | コマンドリファレンス  | Lua スクリプト機能

• Lua のバージョン情報
•走行中のスクリプト [running]
• Lua タスク番号
•走行状態
RUN 走行中
SLEEP スリープ中
WATCH SYSLOG 監視中（ Lua タスクはスリープしている）
COMMUNICATE 通信中
TERMINATE 強制終了中
•トリガ
•lua コマンド
•luac コマンド
•スケジュール
• DOWNLOAD ボタン
•コマンドライン
•スクリプトファイル名
•監視文字列（ SYSLOG 監視中のとき）
•開始日時 /走行時間
•過去に走行したスクリプト [history]（最新  10 種類まで新しい順に表示）
•トリガ
•lua コマンド
•luac コマンド
•スケジュール
• DOWNLOAD ボタン
•コマンドライン
•スクリプトファイル名
•走行回数 /エラー発生回数 /エラー履歴（最新  5 回分まで新しい順に表示）
•前回の開始日時 /終了時間 /走行結果
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
46.5 Lua スクリプトの強制終了
[書式 ]
terminate  lua task_id
terminate  lua file script_file
[設定値及び初期値 ]
•task_id  : 強制終了する  Lua タスクの番号
• [設定値 ] :
設定値 説明
all すべての  Lua タスク番号
1..10 (DOWNLOAD ボタン非搭載の機種では 1..9) Lua タスクの番号
• [初期値 ] : -
•script_file
• [設定値 ] : 強制終了するスクリプトファイル名またはバイトコードファイル名を絶対パスもしくは相対パスで
指定する
• [初期値 ] : -
[説明 ]
指定した  Lua タスク、または、 Lua スクリプトを強制終了する。コマンドリファレンス  | Lua スクリプト機能  | 619

第１書式では、 task_id  で指定された  Lua タスクを強制終了する。 Lua タスクの番号や実行しているスクリプトにつ
いては show status lua  コマンドで確認できる。
第２書式では、 script_file  で指定されたパスとファイル名が完全に一致するスクリプトを実行しているすべての  Lua
タスクを強制終了する。 script_file  に相対パスを指定した場合、環境変数  PWD を基点とする絶対パスに置換された
後で対象の  Lua タスクの検索が行われる。
lua コマンドの  -e オプションを使用して、スクリプトファイルを使用せずに実行されているような  Lua スクリプト
を強制終了させる場合は、第１書式を使用する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
46.6 Lua スクリプト機能に関連するアラーム音を鳴らすか否かの設定
[書式 ]
alarm  lua switch
no alarm  lua [switch ]
[設定値及び初期値 ]
•switch
• [設定値 ] :
設定値 説明
on 鳴らす
off 鳴らさない
• [初期値 ] : on
[説明 ]
Lua スクリプト機能に関連するアラーム音を鳴らすか否かを選択する。
[ノート ]
本コマンドでは、 DOWNLOAD ボタンによる  Lua スクリプトの実行に関するアラーム音を鳴らすか否かの設定がで
きる。  ハードウェアライブラリでの制御によるアラーム音を鳴らすか否かは、 alarm entire  コマンドの設定に従う。
[適用モデル ]
RTX3510, RTX1300, RTX1220, RTX1210, RTX840, RTX830620 | コマンドリファレンス  | Lua スクリプト機能

