# 第9章: イーサネットフィルタの設定

> 元PDFページ: 202-205

---

第 9 章
イーサネットフィルタの設定
9.1 フィルター定義の設定
[書式 ]
ethernet  filter  num kind src_mac  [dst_mac  [offset  byte_list ]]
ethernet  filter  num kind type [scope ] [offset  byte_list ]
no ethernet  filter  num [kind ...]
[設定値及び初期値 ]
•num
• [設定値 ] :
設定値 説明
1..512 (RTX1210 Rev.14.01.16 以降、および、 Rev.15.02
系以降 )静的フィルターの番号
1..100 ( 上記以外  )
• [初期値 ] : -
•kind
• [設定値 ] :
設定値 説明
pass-log 一致すれば通す  ( ログに記録する  )
pass-nolog 一致すれば通す  ( ログに記録しない  )
reject-log 一致すれば破棄する  ( ログに記録する  )
reject-nolog 一致すれば破棄する  ( ログに記録しない  )
• [初期値 ] : -
•src_mac
• [設定値 ] :
•始点  MAC アドレス
• xx:xx:xx:xx:xx:xx(xx は 16 進数、または  *)
• *( すべての  MAC アドレスに対応  )
• [初期値 ] : -
•dst_mac
• [設定値 ] :
•終点  MAC アドレス
•始点  MAC アドレス  src_mac  と同じ形式
•省略時は一個の  * と同じ
• [初期値 ] : -
•type
• [設定値 ] :
設定値 説明
dhcp-bind 指定された  DHCP スコープで予約設定されているホ
ストを対象にする
dhcp-not-bind 指定された  DHCP スコープで予約設定されていない
ホストを対象にする
• [初期値 ] : -
•scope202 | コマンドリファレンス  | イーサネットフィルタの設定

• [設定値 ] :
• DHCP スコープ
• 1..65535 の整数
• DHCP スコープのリース範囲に含まれる  IP アドレス
• [初期値 ] : -
•offset
• [設定値 ] : オフセットを表す  10 進数  ( イーサネットフレームの始点  MAC アドレスの直後を  0 とする  )
• [初期値 ] : -
•byte_list
• [設定値 ] :
•バイト列
• xx(2 桁の  16 進数  ) あるいは  *( 任意のバイト  ) をカンマで区切った並び  (16 個以内  )
• [初期値 ] : -
[説明 ]
イーサネットフレームのフィルターを設定する。本コマンドで設定されたフィルターは、 ethernet lan filter  コマンド
で用いられる。
通常型のフィルターでは、始点  MAC アドレス、終点  MAC アドレスなどで送受信するイーサネットフレームにフィ
ルターを適用する。
dhcp-bind 型のフィルターでは、以下のイーサネットフレームにフィルターを適用する。対象とならないイーサネッ
トフレームはフィルターに合致しないものとして扱う。
・以下のいずれかに該当する、 IPv4 パケットの場合
•イーサネットタイプが  IPv4(0x0800)
• PPPoE 環境で、イーサネットタイプが  PPPoE データフレーム  (0x8864) 、プロトコル  ID が IPv4(0x0800)
• 802.1Q タグ  VLAN 環境で、 TPID が 802.1Q タグ  (0x8100) 、イーサネットタイプが  IPv4(0x0800)
イーサネットフレームの始点  MAC アドレスと始点  IP アドレスの組が、対象となる  DHCP スコープで予約されてい
るならフィルターに合致するとみなす。
・イーサネットタイプが、以下のいずれかの場合
• ARP(0x0806)
• RARP(0x8035)
• PPPoE 制御パケット  (0x8863)
• MAC レイヤ制御パケット  (0x8808)
イーサネットフレームの始点  MAC アドレスが、対象となる  DHCP スコープで予約されているならフィルターに合
致するとみなす。
dhcp-not-bind 型のフィルターでは、以下のイーサネットフレームにフィルターを適用する。対象とならないイーサ
ネットフレームはフィルターに合致しないものとして扱う。
・イーサネットタイプが  IPv4(0x0800) である場合
イーサネットフレームの始点  IP アドレスが、対象となる  DHCP スコープのリース範囲に含まれていて、かつ、 dhcp-
not-bind 型のフィルターでは始点  MAC アドレスが  DHCP スコープで予約されていないときにフィルターに合致す
るとみなす。
dhcp-bind 、dhcp-not-bind 型のフィルターで対象とする  DHCP スコープは、 scope  パラメーターで指定する。
scope  パラメーターとしては  DHCP スコープ番号を指定することもできるし、 DHCP スコープが定義されているサブ
ネットに含まれる  IP アドレスで指定することもできる。 IP アドレスで  DHCP スコープを指定する場合に、複数の
DHCP スコープが該当する時には、その中で最も長いネットマスク長を持つ  DHCP スコープを選択する。
scope  パラメーターを省略した場合には、 フィルターが適用されるインターフェースで使用される  DHCP スコープが
すべて対象となる。
dhcp-bind 、dhcp-not-bind 型のフィルターが  DHCP リレーエージェントとして動作しているルーターに設定された場
合、 DHCP サーバーから  DHCP スコープとその  DHCP スコープにおけるクライアントの予約情報を取得し、フィル
ターの適用時に参照する。 DHCP サーバーからの  DHCP スコープおよび予約情報の取得は、 DHCP メッセージをリ
レーする際、 DHCP メッセージのオプション部に予約情報を書き込んで通知することにより行われる。
[ノート ]
LAN 分割機能を使用する場合には、 ルーター内部でイーサネットタイプとして  0x8100～0x810f の値を使用している
ので、それらのイーサネットフレームをフィルターして送受信できないようにすると、 LAN 分割機能を使用してい
るポートで通信できなくなるので注意が必要である。コマンドリファレンス  | イーサネットフィルタの設定  | 203

dhcp-bind 、dhcp-not-bind 型のフィルターでは、イーサネットフレームの始点  MAC アドレスや始点  IP アドレスを用
いてフィルターの判定をするため、 ethernet lan filter  コマンドでは通常  in 方向にのみ使用することになる。
out 方向の場合、始点  MAC アドレスはルーター自身の  MAC アドレスになるため、 DHCP の予約情報もしくはリー
スしたアドレスと一致することはない。
dhcp-bind 型フィルターは、予約もしくはアドレスがリースされているクライアントだけを通過させる、という形に
なるため、通常は  pass 等と組み合わせて使用する。一方、 dhcp-not-bind 型フィルターは、予約もしくはアドレスが
リースされていないクライアントを破棄する、という形になるため、通常は  reject 等と組み合わせて使用することに
なる。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
9.2 インターフェースへの適用の設定
[書式 ]
ethernet  interface  filter  dir list
no ethernet  interface  filter  dir [list]
[設定値及び初期値 ]
•interface
• [設定値 ] :
•物理  LAN インターフェース名
• LAN 分割機能で使用するインターフェース名
• vRX シリーズ  では指定不可能
•トンネルインターフェース名
• [初期値 ] : -
•dir
• [設定値 ] :
設定値 説明
in LAN 側から入ってくるパケットのフィルタリング
out LAN 側に出ていくパケットのフィルタリング
• [初期値 ] : -
•list
• [設定値 ] :
設定値 説明
空白で区切られた静的フィルター番号の並び512 個以内  ( Rev.14.01.16 以降、および、 Rev.15.02 系
以降  )
100 個以内  ( 上記以外  )
• [初期値 ] : -
[説明 ]
LANおよびトンネルインターフェースを通るパケットについて、 ethernet filter  コマンドによるパケットのフィルタ
ーを組み合わせて、通過するパケットの種類を制限する。
[ノート ]
interface  パラメーターにトンネルインターフェースを指定する場合は、 当該インターフェースがブリッジインターフ
ェースに収容されているときだけ、フィルターが適用される。
interface  パラメーターへのトンネルインターフェースの指定は、 vRX Amazon EC2 版 では不可能。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830204 | コマンドリファレンス  | イーサネットフィルタの設定

9.3 イーサネットフィルタの状態の表示
[書式 ]
show  status  ethernet  filter  type [scope ]
[設定値及び初期値 ]
•type
• [設定値 ] :
設定値 説明
dhcp-bind 指定された  DHCP スコープで予約設定されているホ
スト
dhcp-scope 指定された  DHCP スコープでアドレスがリースされ
ているホスト
• [初期値 ] : -
•scope
• [設定値 ] : スコープ番号  (1-65535)
• [初期値 ] : -
[説明 ]
イーサネットフィルタの情報を表示する。
[適用モデル ]
vRX シリーズ , RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | イーサネットフィルタの設定  | 205

