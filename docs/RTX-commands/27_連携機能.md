# 第27章: 連携機能

> 元PDFページ: 444-451

---

第 27 章
連携機能
27.1 連携動作を行うか否かの設定
[書式 ]
cooperation  type role sw
no cooperation  type role [sw]
[設定値及び初期値 ]
•type : 連携動作タイプ
• [設定値 ] :
設定値 説明
bandwidth-measuring 回線帯域検出
load-watch 負荷監視通知
• [初期値 ] : -
•role : 連携動作での役割
• [設定値 ] :
設定値 説明
server サーバー側動作
client クライアント側動作
• [初期値 ] : -
•sw
• [設定値 ] :
設定値 説明
on 機能を有効にする
off 機能を無効にする
• [初期値 ] : すべての連携動作で  off
[説明 ]
連携動作の機能毎の動作を設定する。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
27.2 連携動作で使用するポート番号の設定
[書式 ]
cooperation  port port
no cooperation  port [port]
[設定値及び初期値 ]
•port
• [設定値 ] : ポート番号
• [初期値 ] : 59410
[説明 ]
連携動作で使用する  UDP のポート番号を設定する。連携動作で送出されるパケットの送信元ポート番号にこの番
号を使用する。またこのポート番号宛のパケットを受信した場合には連携動作に関わるパケットとして処理する。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830444 | コマンドリファレンス  | 連携機能

27.3 帯域測定で連携動作を行う相手毎の動作の設定
[書式 ]
cooperation  bandwidth-measuring  remote  id role address  [option =value ]
no cooperation  bandwidth-measuring  remote  id [role address  [option =value ]]
[設定値及び初期値 ]
•id
• [設定値 ] : 相手先  ID 番号  (1..100)
• [初期値 ] : -
•role : 連携動作での相手側の役割
• [設定値 ] :
設定値 説明
server 相手側がサーバー側動作を行う
client 相手側がクライアント側動作を行う
• [初期値 ] : -
•address
• [設定値 ] : 連携動作の相手側  IP アドレス、 FQDN または  'any'
• [初期値 ] : -
•option  : オプション
• [設定値 ] :
設定値 説明
apply 測定結果を  LAN インタフェースまたは  WAN インタ
フェースの速度設定に反映させるか否か、 'on'or'off'
port 相手側が使用する  UDP のポート番号  (1-65535)
initial-speed 測定開始値  (64000-100000000)[bit/s]
interval 定期監視間隔  (60..2147483647)[sec]or'off'
retry-interval エラー終了後の再試行までの間隔  (60..2147483647)
[sec]
sensitivity 測定感度、 'high','middle'or'low'
syslog 動作をログに残すか否か、 'on'or'off'
interface 測定結果を反映させる  LAN インタフェースまたは
WAN インタフェース
class 測定結果を反映させるクラス
limit-rate 設定値の最大変化割合  (1-10000)[%]
number 測定に使用するパケット数  (5..100)
local-address パケット送信時の始点  IP アドレス
• [初期値 ] :
• apply=on
• port=59410
• initial-speed=10000000
• interval=3600
• retry-interval=3600
• sensitivity=high
• syslog=off
• number=30
[説明 ]
帯域測定で連携動作を行う相手毎の動作を設定する。コマンドリファレンス  | 連携機能  | 445

[ノート ]
role パラメータで  client を設定する場合には、オプションは  port と syslog だけが設定できる。 server を設定する場合
には全てのオプションが設定できる。
連携動作の相手側設定として  any を指定できるのは、 role パラメータで  client を設定した場合のみである。
apply オプションが  'on' の場合、帯域測定の結果を相手先に向かう  LAN インタフェースの speed lan  コマンドの設定
値、 または  WAN インタフェースの speed wan1  コマンドの設定値に上書きする。  class オプションに値が設定されて
いる場合には、 queue lan class property  コマンドの bandwidth  パラメータ、または  queue wan1 class property  コマン
ドの bandwidth  パラメータに測定結果が反映される。
initial-speed オプションでは初期状態で測定を開始する速度を設定できる。パラメータの後ろに  'k' または  'M' をつけ
ると、それぞれ  kbit/s、Mbit/s として扱われる。
retry-interval オプションでは、帯域測定が相手先からの応答がなかったり測定値が許容範囲を越えたなど、何らかの
障害で正しい測定ができなかった場合の再試行までの時間を設定できる。ただし、網への負荷等を考慮すると正常
に動作できない状況でむやみに短時間間隔で試行を繰り返すべきではない。正常に測定できない原因を回避するこ
とが先決である。
number オプションでは、測定に使用するパケット数を設定できる。パケット間隔のゆらぎが大きい環境ではこの数
を多くすることで、より安定した結果が得られる。ただし測定に使用するパケットの数が増えるため測定パケット
が他のデータ通信に与える影響も大きくなる可能性がある。
sensitivity オプションでは、測定感度を変更することができる。パケット間隔のゆらぎが大きかったりパケットロス
のある環境では、測定感度を鈍くすることで、頻繁な設定変更を抑制したり測定完了までの時間を短縮することが
できる。
interface オプションで  LAN インタフェースが設定されている場合には、その  LAN インタフェースの speed lan  コマ
ンドに測定結果が反映される。 class オプションに値が設定されている場合には queue lan class property  コマンドの
bandwidth  パラメータに測定結果が反映される。  WAN インタフェースが設定されている場合には、 speed wan1  コマ
ンドに測定結果が反映される。 class オプションに値が設定されている場合には queue wan1 class property  コマンド
のbandwidth  パラメータに測定結果が反映される。
class オプションは帯域制御機能が実装されている機種でのみ利用できる。
limit-rate オプションは、設定値の急激な変動をある割合内に抑えたい場合に設定する。直前の測定結果と今回の測
定結果に大きな差がある場合、今回の測定結果そのものではなく、この  limit-rate に応じた値を今回の設定値として
採用する。
local-address オプションでは、送信パケットの始点  IP アドレスを設定できる。設定がない場合、インタフェースに
付与された  IP アドレスを使用する
WAN インタフェースは  Rev.14.01 系以降のファームウェアで指定可能。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
27.4 負荷監視通知で連携動作を行う相手毎の動作の設定
[書式 ]
cooperation  load-watch  remote  id role address  [option =value ]
no cooperation  load-watch  remote  id [role address  [option =value ]]
[設定値及び初期値 ]
•id
• [設定値 ] : 相手先  ID 番号  (1..100)
• [初期値 ] : -
•role : 連携動作での相手側の役割
• [設定値 ] :
設定値 説明
server 相手側がサーバー側動作を行う
client 相手側がクライアント側動作を行う
• [初期値 ] : -
•address
• [設定値 ] : 連携動作の相手側  IP アドレス、 FQDN または  'any'
• [初期値 ] : -446 | コマンドリファレンス  | 連携機能

•option  : オプション
• [設定値 ] :
設定値 説明
trigger サーバー動作として、 クライアントに通知を行う条件
のトリガ定義番号  (1-65535) 、',' で区切って複数の指
定が可能、 相手側動作をクライアントに設定する時に
のみ可能
control クライアント動作として、 サーバーから通知を受けた
時の制御動作定義番号  (1-65535) 、相手側動作をサー
バーに設定する時にのみ可能
port 相手側が使用する  UDP のポート番号  (1-65535)
syslog 動作をログに残すか否か、 'on'or'off'
apply 負荷監視通知の結果を動作に反映させるかどう
か、 'on'or'off'
register サーバーに対する登録パケットを送るか否
か、 'on'or'off'
register-interval クライアントからサーバーへの登録パケット送信間
隔、 (1..2147483647)[sec]
register-time サーバーでのクライアント登録情報保持時間、
(1..2147483647)[sec]
name 相手側を識別する名前  ( 最大  16 文字  )
local-address パケット送信時の始点  IP アドレス
• [初期値 ] :
• port=59410
• syslog=off
• apply=on
• register=off
• register-interval=1200
• register-time=3600
[説明 ]
負荷監視通知で連携動作を行う相手毎の動作を設定する。
[ノート ]
role パラメータで  client を設定する場合のみ  trigger オプションを利用でき、 client を設定する場合は  trigger オプショ
ンの設定は必須である。  また、 server を設定する場合のみ  control オプションを利用でき、 server を設定する場合は
control オプションの設定は必須である。
サーバー側で  any を指定した場合、サーバー側にクライアントの存在を通知登録するためにクライアント側では
register=on を設定する必要がある。
name オプションを設定した場合、サーバーとクライアントの双方で同じ名前を設定した場合にのみ機能する。
local-address オプションでは、送信パケットの始点  IP アドレスを設定できる。設定がない場合、インタフェースに
付与された  IP アドレスを使用する。
複数のトリガを設定した場合、抑制要請の送信タイミングはそれぞれのトリガで個別に検出される。それらの送信
タイミングが異なる時には抑制要請はそれぞれのタイミングで個別に送られ、送信タイミングが一致する時にはひ
とつの抑制要請となる。
相手先に一度抑制解除が送られた後は、次に抑制要請を送信するまで抑制解除は送信しない。
抑制要請を送信していないトリガ条件が抑制解除条件を満たしても抑制解除通知は送信しない。
抑制制御を行っている最中に相手先情報が削除されると、制御対象のインタフェースの速度はその時点の設定が保
持される。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | 連携機能  | 447

27.5 負荷監視サーバーとしての動作トリガの設定
[書式 ]
cooperation  load-watch  trigger  id point  high= high [, count ] low= low [, count ] [option =value ]
no cooperation  load-watch  trigger  id [point  high= high [, count ] low= low [, count ] [option =value ]]
[設定値及び初期値 ]
•id
• [設定値 ] : 相手先  ID 番号  (1-100)
• [初期値 ] : -
•point  : 負荷監視対象ポイント
• [設定値 ] :
• cpu load
•単位時間間隔で  CPU 負荷率を監視する値は  % で指定する
•interface  receive
•インタフェースでの単位時間当たりの受信量を監視する。値は  1 秒あたりのビット数で指定する
interfaceインタフェース名  (LAN, TUNNEL (tunnel
tunnel_num ), PP (pp peer_num ))
•interface  overflow
• LAN インタフェースでの単位時間当たりの受信オーバーフロー数と受信バッファエラー数を監視す
る。値は発生回数で指定する
interface LAN インタフェース名
•interface  [class ] transmit
•インタフェースでの単位時間当たりの送信量を監視する。値は  1 秒あたりのビット数で指定する
interfaceインタフェース名  (LAN, TUNNEL (tunnel
tunnel_num ), PP (pp peer_num ))
class クラス番号  (LAN インタフェースの場合  )
• [初期値 ] : -
•high
• [初期値 ] : 高負荷検出閾値
•low
• [設定値 ] : 負荷減少検出閾値
• [初期値 ] : -
•count
• [設定値 ] : 通知を送出するに至る検出回数  (1-100)、省略時は  3
• [初期値 ] : -
•option  : オプション
• [設定値 ] :
設定値 説明
interval 監視する間隔  (1-65535)[sec] 、省略時は  10[sec]
syslog 動作をログに残すか否か、 'on'or'off'、省略時は  'off'
• [初期値 ] : -
[説明 ]
機器の負荷を検出して相手側にトラフィック抑制要請を送出する条件を設定する。監視対象ポイントの負荷を単位
時間毎に監視し、 high に設定された閾値を上回ることを count  回数続けて検出すると抑制要請を送出する。この状態
で閾値を上回る高負荷状態が続く限り、 count  の間隔で抑制要請を送出し続ける。
同様に、 low に設定された閾値を count  回数続けて下回って検出すると抑制解除を送出する。抑制解除は同じ相手に
対して連続して送出されない。
class オプションは帯域制御機能が実装されている機種でのみ利用できる。448 | コマンドリファレンス  | 連携機能

[ノート ]
閾値を決定する際の参考値として、 show environment  やshow status lan  で表示される情報のほか、 syslog オプショ
ンによりログに表示される値も利用できる。
[設定例 ]
# cooperation load-watch trigger 1 cpu load high=80 low=30
一定間隔で  CPU の負荷率を観測し、負荷率が  80% 以上であることが連続  3 回測定されたら抑制要請を送り、その後
30% 以下であることが  3 回続けて観測されたら抑制解除を送る。
# cooperation load-watch trigger 2 lan2 receive high=80m,5 low=50m,1
単位時間内での  LAN2 からの受信バイト数から受信速度を求め、その値が  80[Mbit/s] 以上であることが連続  5 回あれ
ば抑制要請を送り、その後  50[Mbit/s] 以下であることが  1 度でも観測されれば抑制解除を送る。
# cooperation load-watch trigger 3 lan2 overflow high=2,1 low=0,5
単位時間内での  LAN2 での受信オーバーフロー数の増加を監視し、 2 回検出されることが  1 度でもあれば抑制要請を
送り、検出されないことが  5 回続けば抑制解除を送る。
[拡張ライセンス対応 ]
拡張ライセンス をインポートすると、以下のパラメーターに入力できる上限値が拡張される。
•tunnel_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 300 500 700 900 1100
YSL-VPN-EX3 1500 2000 2500 3000 -
•peer_num
ライセンス名拡張後の上限値
( ライセンス本数ごとの値  )
1本 2本 3本 4本 5本
YSL-VPN-EX1 100 - - - -
YSL-VPN-EX2 150
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
27.6 負荷監視クライアントとしての動作の設定
[書式 ]
cooperation  load-watch  control  id high= high [raise= raise ] low= low [lower= lower ] [option =value ]
no cooperation  load-watch  control  id [high= high [raise= raise ] low= low [lower= lower ] [option =value ]]
[設定値及び初期値 ]
•id
• [設定値 ] : 相手先  ID 番号  (1-100)
• [初期値 ] : -
•high
• [設定値 ] : bit/sec、帯域上限値
• [初期値 ] : -
•raise
• [設定値 ] :
• %、帯域上限値に達していない限り、定時間毎にこの割合だけ帯域を増加させるコマンドリファレンス  | 連携機能  | 449

•省略時は  5%
• [初期値 ] : -
•low
• [設定値 ] : bit/sec、帯域下限値
• [初期値 ] : -
•lower
• [設定値 ] :
• %、帯域下限値に達していない限り、抑制要請を受けた時に現在の帯域からこの割合だけ送出帯域を減少
させる
•省略時は  30%
• [初期値 ] : -
•option  : オプション
• [設定値 ] :
設定値 説明
interval 帯域を増加させる間隔 (1-65535)[sec] 、省略時は
10[sec]
interface 帯域を変化させる LANインタフェース
class 帯域を変化させるクラス
• [初期値 ] : -
[説明 ]
トラフィック抑制要請を受けた場合の動作を設定する。帯域は high に設定された帯域と low に設定された帯域との
間で制御される。
抑制要請を受信すると、送出帯域は現状の運用帯域値の lower  の値に応じた割合に減少する。帯域が high に達して
いない限り、 raise  の値に応じて運用帯域は増加する。
トラフィック抑制解除を受信した場合には、帯域は high に設定された帯域に増加する。
帯域制御機能が実装されている機種でのみ option  にclassを指定可能。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830
27.7 連携動作の手動実行
[書式 ]
cooperation  bandwidth-measuring go id
cooperation  load-watch go id type
[設定値及び初期値 ]
• bandwidth-measuring : 回線帯域検出
• [初期値 ] : -
• load-watch : 負荷監視通知
• [初期値 ] : -
•id
• [設定値 ] : 相手先  ID 番号  (1-100)
• [初期値 ] : -
•type : パケットタイプ
• [設定値 ] :
設定値 説明
lower 負荷減少検出パケット
raise 高負荷検出パケット
• [初期値 ] : -450 | コマンドリファレンス  | 連携機能

[説明 ]
手動で連携動作を実行する。
[ノート ]
bandwidth-measuring を指定した場合、測定結果がログに表示される。  インタフェース速度の設定で回線帯域検出の
値を使用するように設定されている場合には、この実行結果の値も設定への反映の対象となる。
load-watch を指定した場合は、 指定した相手先に対して負荷監視のトリガで送出されるパケットと同じパケットが送
出される。  相手の役割がクライアントである相手にのみ有効である。
[適用モデル ]
RTX5000, RTX3510, RTX3500, RTX1300, RTX1220, RTX1210, RTX840, RTX830コマンドリファレンス  | 連携機能  | 451

