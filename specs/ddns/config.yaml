# DDNS Configuration Command Specification
# Reference: RTX Command Reference
#
# Covers:
# - netvolante-dns: NetVolante DNS設定
# - ddns server: カスタムDDNSサーバー設定

command:
  name: ddns_config
  description: "DDNS設定"

  applicable_models:
    - vRX
    - RTX5000
    - RTX3510
    - RTX3500
    - RTX1300
    - RTX1220
    - RTX1210
    - RTX840
    - RTX830

  terraform:
    resource_name: rtx_ddns
    struct_name: DDNSConfig
    package: parsers

  syntax_tests:
    # =============================================================================
    # NetVolante DNS Commands
    # =============================================================================
    - name: netvolante_hostname
      rtx: "netvolante-dns hostname host pp1 myhost.netvolante.jp"
      terraform:
        netvolante:
          - interface: "pp1"
            hostname: "myhost.netvolante.jp"

    - name: netvolante_hostname_lan
      rtx: "netvolante-dns hostname host lan1 router.netvolante.jp"
      terraform:
        netvolante:
          - interface: "lan1"
            hostname: "router.netvolante.jp"

    - name: netvolante_server_1
      rtx: "netvolante-dns server 1"
      terraform:
        netvolante:
          - server: 1

    - name: netvolante_server_2
      rtx: "netvolante-dns server 2"
      terraform:
        netvolante:
          - server: 2

    - name: netvolante_timeout
      rtx: "netvolante-dns timeout 30"
      terraform:
        netvolante:
          - timeout: 30

    - name: netvolante_use_ipv6_on
      rtx: "netvolante-dns use ipv6 pp1 on"
      terraform:
        netvolante:
          - interface: "pp1"
            ipv6: true

    - name: netvolante_use_ipv6_off
      rtx: "netvolante-dns use ipv6 lan1 off"
      terraform:
        netvolante:
          - interface: "lan1"
            ipv6: false

    - name: netvolante_auto_hostname_on
      rtx: "netvolante-dns auto hostname pp1 on"
      terraform:
        netvolante:
          - interface: "pp1"
            auto_hostname: true

    - name: netvolante_use_on
      rtx: "netvolante-dns use pp1 on"
      terraform:
        netvolante:
          - interface: "pp1"
            use: true

    - name: netvolante_use_off
      rtx: "netvolante-dns use lan1 off"
      terraform:
        netvolante:
          - interface: "lan1"
            use: false

    - name: netvolante_go
      rtx: "netvolante-dns go pp1"
      terraform:
        netvolante:
          - interface: "pp1"
      build_only: true

    # =============================================================================
    # Custom DDNS Server Commands
    # =============================================================================
    - name: ddns_server_url
      rtx: "ddns server url 1 https://ddns.example.com/update"
      terraform:
        ddns_servers:
          - id: 1
            url: "https://ddns.example.com/update"

    - name: ddns_server_hostname
      rtx: "ddns server hostname 1 myhost.example.com"
      terraform:
        ddns_servers:
          - id: 1
            hostname: "myhost.example.com"

    - name: ddns_server_user
      rtx: "ddns server user 1 myuser mypassword"
      terraform:
        ddns_servers:
          - id: 1
            username: "myuser"
            password: "mypassword"

    - name: ddns_server_go
      rtx: "ddns server go 1"
      terraform:
        ddns_servers:
          - id: 1
      build_only: true

    # =============================================================================
    # Delete Commands (build_only)
    # =============================================================================
    - name: delete_netvolante_hostname
      rtx: "no netvolante-dns hostname host pp1"
      terraform:
        interface: "pp1"
      build_only: true

    - name: delete_ddns_server_url
      rtx: "no ddns server url 1"
      terraform:
        id: 1
      build_only: true

  boundary_tests:
    netvolante_server:
      - value: 1
        valid: true
      - value: 2
        valid: true
      - value: 0
        valid: false
        error_contains: "must be 1 or 2"
      - value: 3
        valid: false
        error_contains: "must be 1 or 2"

    ddns_server_id:
      - value: 1
        valid: true
      - value: 2
        valid: true
      - value: 3
        valid: true
      - value: 4
        valid: true
      - value: 0
        valid: false
        error_contains: "must be 1-4"
      - value: 5
        valid: false
        error_contains: "must be 1-4"

    timeout:
      - value: 1
        valid: true
        description: "最小値"
      - value: 30
        valid: true
        description: "標準値"
      - value: 300
        valid: true
        description: "最大値"
      - value: 0
        valid: false
        error_contains: "must be positive"
