# DNS Configuration Command Specification
# Reference: RTX Command Reference
#
# Covers:
# - dns domain: ドメイン設定
# - dns server: DNSサーバー設定
# - dns server select: ドメイン別DNS選択
# - dns static: 静的DNSエントリ
# - dns service: DNSサービス設定

command:
  name: dns_config
  description: "DNS設定"

  applicable_models:
    - vRX
    - RTX5000
    - RTX3510
    - RTX3500
    - RTX1300
    - RTX1220
    - RTX1210
    - RTX840
    - RTX830

  terraform:
    resource_name: rtx_dns
    struct_name: DNSConfig
    package: parsers

  syntax_tests:
    # =============================================================================
    # DNS Domain Name
    # Note: "dns domain lookup" command does NOT exist in RTX reference
    # =============================================================================
    - name: dns_domain_name
      rtx: "dns domain example.com"
      terraform:
        domain_name: "example.com"

    - name: dns_domain_local
      rtx: "dns domain local.lan"
      terraform:
        domain_name: "local.lan"

    # =============================================================================
    # DNS Server
    # =============================================================================
    - name: dns_server_single
      rtx: "dns server 8.8.8.8"
      terraform:
        name_servers: ["8.8.8.8"]

    - name: dns_server_two
      rtx: "dns server 8.8.8.8 8.8.4.4"
      terraform:
        name_servers: ["8.8.8.8", "8.8.4.4"]

    - name: dns_server_three
      rtx: "dns server 8.8.8.8 8.8.4.4 1.1.1.1"
      terraform:
        name_servers: ["8.8.8.8", "8.8.4.4", "1.1.1.1"]

    # =============================================================================
    # DNS Server Select (Domain-based routing)
    # =============================================================================
    - name: dns_server_select_simple
      rtx: "dns server select 1 8.8.8.8 any .example.com"
      terraform:
        server_select:
          - id: 1
            servers: ["8.8.8.8"]
            record_type: "any"
            query_pattern: ".example.com"

    - name: dns_server_select_with_edns
      rtx: "dns server select 1 8.8.8.8 edns=on any .example.com"
      terraform:
        server_select:
          - id: 1
            servers:
              - address: "8.8.8.8"
                edns: true
            record_type: "any"
            query_pattern: ".example.com"

    - name: dns_server_select_multiple_servers
      rtx: "dns server select 1 8.8.8.8 8.8.4.4 any .google.com"
      terraform:
        server_select:
          - id: 1
            servers: ["8.8.8.8", "8.8.4.4"]
            record_type: "any"
            query_pattern: ".google.com"

    - name: dns_server_select_record_type_a
      rtx: "dns server select 2 1.1.1.1 a .cloudflare.com"
      terraform:
        server_select:
          - id: 2
            servers: ["1.1.1.1"]
            record_type: "a"
            query_pattern: ".cloudflare.com"

    - name: dns_server_select_restrict_pp
      rtx: "dns server select 3 192.168.1.1 any .internal restrict pp 1"
      terraform:
        server_select:
          - id: 3
            servers: ["192.168.1.1"]
            record_type: "any"
            query_pattern: ".internal"
            restrict_pp: 1

    # =============================================================================
    # DNS Static (Host entries)
    # Reference: dns static <type> <name> <value> [ttl=<ttl>]
    # Type is REQUIRED: a, aaaa, ptr, mx, ns, cname
    # =============================================================================
    - name: dns_static_a_record
      rtx: "dns static a server.local 192.168.1.100"
      terraform:
        hosts:
          - name: "server.local"
            address: "192.168.1.100"
            type: "a"

    - name: dns_static_a_router
      rtx: "dns static a router.local 192.168.1.1"
      terraform:
        hosts:
          - name: "router.local"
            address: "192.168.1.1"
            type: "a"

    - name: dns_static_ptr
      rtx: "dns static ptr 192.168.1.100 server.local"
      terraform:
        hosts:
          - name: "192.168.1.100"
            address: "server.local"
            type: "ptr"

    - name: dns_static_aaaa
      rtx: "dns static aaaa server6.local 2001:db8::1"
      terraform:
        hosts:
          - name: "server6.local"
            address: "2001:db8::1"
            type: "aaaa"

    # =============================================================================
    # DNS Service
    # =============================================================================
    - name: dns_service_recursive
      rtx: "dns service recursive"
      terraform:
        service_on: true

    - name: dns_service_off
      rtx: "dns service off"
      terraform:
        service_on: false

    # =============================================================================
    # DNS Private Address Spoof
    # =============================================================================
    - name: dns_private_spoof_on
      rtx: "dns private address spoof on"
      terraform:
        private_spoof: true

    - name: dns_private_spoof_off
      rtx: "dns private address spoof off"
      terraform:
        private_spoof: false

    # =============================================================================
    # Delete Commands (build_only)
    # =============================================================================
    - name: delete_dns_server
      rtx: "no dns server"
      terraform: {}
      build_only: true

    - name: delete_dns_domain
      rtx: "no dns domain"
      terraform: {}
      build_only: true

    - name: delete_dns_server_select
      rtx: "no dns server select 1"
      terraform:
        id: 1
      build_only: true

    - name: delete_dns_static
      rtx: "no dns static a server.local"
      terraform:
        name: "server.local"
        type: "a"
      build_only: true

    # === Additional test variations ===
    - name: dns_server_google
      rtx: "dns server 8.8.8.8 8.8.4.4"
      description: "Google DNS"
      terraform:
        servers:
          - "8.8.8.8"
          - "8.8.4.4"

    - name: dns_server_cloudflare
      rtx: "dns server 1.1.1.1 1.0.0.1"
      description: "Cloudflare DNS"
      terraform:
        servers:
          - "1.1.1.1"
          - "1.0.0.1"

    - name: dns_server_quad9
      rtx: "dns server 9.9.9.9"
      description: "Quad9 DNS"
      terraform:
        servers:
          - "9.9.9.9"

    - name: dns_domain_short
      rtx: "dns domain local"
      description: "短いドメイン"
      terraform:
        domain: "local"

    - name: dns_domain_long
      rtx: "dns domain subdomain.example.company.co.jp"
      description: "長いドメイン"
      terraform:
        domain: "subdomain.example.company.co.jp"

    - name: dns_static_host
      rtx: "dns static a host.example.com 192.168.1.100"
      description: "静的ホスト (Aレコード)"
      terraform:
        static_hosts:
          - hostname: "host.example.com"
            ip: "192.168.1.100"
            type: "a"

    - name: dns_private_on
      rtx: "dns private address spoof on"
      description: "プライベートアドレススプーフィング有効"
      terraform:
        private_address_spoof: true

    # Note: "dns cache max entry" command is NOT in reference Chapter 24
    # Removed: dns_cache_max test case


  boundary_tests:
    server_select_id:
      - value: 1
        valid: true
      - value: 100
        valid: true
      - value: 65535
        valid: true
      - value: 0
        valid: false
        error_contains: "must be positive"

    record_type:
      - value: "a"
        valid: true
      - value: "aaaa"
        valid: true
      - value: "ptr"
        valid: true
      - value: "mx"
        valid: true
      - value: "ns"
        valid: true
      - value: "cname"
        valid: true
      - value: "any"
        valid: true
      - value: "invalid"
        valid: false
        error_contains: "invalid record type"
