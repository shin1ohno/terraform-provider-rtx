# OSPF Configuration Command Specification
# Reference: RTX Command Reference
#
# Covers:
# - ospf use: OSPF有効化
# - ospf router id: ルーターID設定
# - ospf area: エリア設定
# - ip interface ospf area: インタフェースエリア割り当て
# - ospf import: 経路再配布

command:
  name: ospf_config
  description: "OSPF設定"

  applicable_models:
    - vRX
    - RTX5000
    - RTX3510
    - RTX3500
    - RTX1300
    - RTX1220
    - RTX1210
    - RTX840
    - RTX830

  terraform:
    resource_name: rtx_ospf
    struct_name: OSPFConfig
    package: parsers

  syntax_tests:
    # =============================================================================
    # OSPF Enable/Disable
    # =============================================================================
    - name: ospf_use_on
      rtx: "ospf use on"
      terraform:
        enabled: true

    - name: ospf_use_off
      rtx: "ospf use off"
      terraform:
        enabled: false

    # =============================================================================
    # OSPF Router ID
    # =============================================================================
    - name: ospf_router_id
      rtx: "ospf router id 192.168.1.1"
      terraform:
        router_id: "192.168.1.1"

    - name: ospf_router_id_loopback
      rtx: "ospf router id 10.0.0.1"
      terraform:
        router_id: "10.0.0.1"

    # =============================================================================
    # OSPF Area
    # =============================================================================
    - name: ospf_area_backbone
      rtx: "ospf area 0"
      terraform:
        areas:
          - id: "0"
            type: "normal"

    - name: ospf_area_1
      rtx: "ospf area 1"
      terraform:
        areas:
          - id: "1"
            type: "normal"

    - name: ospf_area_stub
      rtx: "ospf area 1 stub"
      terraform:
        areas:
          - id: "1"
            type: "stub"

    - name: ospf_area_stub_no_summary
      rtx: "ospf area 1 stub no-summary"
      terraform:
        areas:
          - id: "1"
            type: "stub"
            no_summary: true

    # Note: NSSA is NOT supported on RTX routers according to reference
    # ospf area command only supports: backbone, normal area, stub area
    # Removed: ospf_area_nssa and ospf_area_nssa_no_summary

    # OSPF area with stub cost
    - name: ospf_area_stub_with_cost
      rtx: "ospf area 1 stub cost=10"
      terraform:
        areas:
          - id: "1"
            type: "stub"
            cost: 10

    # =============================================================================
    # Interface OSPF Area
    # =============================================================================
    - name: ip_ospf_area_lan1
      rtx: "ip lan1 ospf area 0"
      terraform:
        networks:
          - interface: "lan1"
            area: "0"

    - name: ip_ospf_area_lan2
      rtx: "ip lan2 ospf area 1"
      terraform:
        networks:
          - interface: "lan2"
            area: "1"

    - name: ip_ospf_area_tunnel
      rtx: "ip tunnel1 ospf area 0"
      terraform:
        networks:
          - interface: "tunnel1"
            area: "0"

    # =============================================================================
    # OSPF Import (Redistribution)
    # =============================================================================
    - name: ospf_import_static
      rtx: "ospf import from static"
      terraform:
        redistribute_static: true

    # Note: 'connected' is NOT a valid protocol for ospf import from
    # Reference only supports: static, rip, bgp
    # Removed: ospf_import_connected

    - name: ospf_import_rip
      rtx: "ospf import from rip"
      terraform:
        redistribute_rip: true

    - name: ospf_import_bgp
      rtx: "ospf import from bgp"
      terraform:
        redistribute_bgp: true

    - name: ospf_import_static_with_filter
      rtx: "ospf import from static filter 1 2"
      terraform:
        redistribute_static: true
        filters: [1, 2]

    # =============================================================================
    # Delete Commands (build_only)
    # =============================================================================
    - name: delete_ospf_area
      rtx: "no ospf area 1"
      terraform:
        area_id: "1"
      build_only: true

    - name: delete_ip_ospf_area
      rtx: "no ip lan1 ospf area"
      terraform:
        interface: "lan1"
      build_only: true

    - name: delete_ospf_import
      rtx: "no ospf import from static"
      terraform:
        redistribute_static: false
      build_only: true

    # === Additional test variations ===
    - name: ospf_area_backbone
      rtx: "ospf area backbone"
      description: "バックボーンエリア"
      terraform:
        area: "backbone"

    - name: ospf_area_id_max
      rtx: "ospf area 4294967295"
      description: "エリアID最大"
      terraform:
        area: "4294967295"

    # Note: 'ospf network' command does NOT exist in RTX
    # Use 'ospf area network <area> <network>/<mask>' instead for route summarization
    # Removed: ospf_network_class_a, ospf_network_class_b

    - name: ospf_area_network_summarize
      rtx: "ospf area network 1 192.168.0.0/16"
      description: "エリア間経路集約"
      terraform:
        area: "1"
        network: "192.168.0.0"
        mask: 16

    - name: ospf_area_network_restrict
      rtx: "ospf area network 1 10.0.0.0/8 restrict"
      description: "経路広告抑制"
      terraform:
        area: "1"
        network: "10.0.0.0"
        mask: 8
        restrict: true

    # Note: 'ospf interface cost' command does NOT exist in RTX
    # Use 'ip <interface> ospf area <area> cost=<value>' instead
    # Removed: ospf_cost_min, ospf_cost_max

    - name: ip_ospf_area_with_cost
      rtx: "ip lan1 ospf area 1 cost=10"
      description: "インタフェースコスト指定"
      terraform:
        interface: "lan1"
        area: "1"
        cost: 10

    - name: ip_ospf_area_with_priority
      rtx: "ip lan1 ospf area 1 priority=0"
      description: "DR選出無効化"
      terraform:
        interface: "lan1"
        area: "1"
        priority: 0


  boundary_tests:
    area_id:
      - value: "0"
        valid: true
        description: "バックボーン"
      - value: "1"
        valid: true
      - value: "255"
        valid: true
      - value: "0.0.0.0"
        valid: true
        description: "ドット形式バックボーン"
      - value: "0.0.0.1"
        valid: true
        description: "ドット形式"

    area_type:
      # Reference: NSSA is NOT supported on RTX routers
      - value: "normal"
        valid: true
      - value: "stub"
        valid: true
      - value: "nssa"
        valid: false
        description: "NSSAはRTXでサポートされていない"
        error_contains: "invalid area type"
      - value: "invalid"
        valid: false
        error_contains: "invalid area type"

    router_id:
      - value: "192.168.1.1"
        valid: true
      - value: "10.0.0.1"
        valid: true
      - value: "0.0.0.0"
        valid: false
        error_contains: "invalid router id"
