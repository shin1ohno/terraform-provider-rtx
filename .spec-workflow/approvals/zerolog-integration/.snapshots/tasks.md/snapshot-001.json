{
  "id": "snapshot_1768920246061_gmbwryuz2",
  "approvalId": "approval_1768920246042_nfi3vqwmd",
  "approvalTitle": "Zerolog Integration Tasks Document",
  "version": 1,
  "timestamp": "2026-01-20T14:44:06.061Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Zerolog Integration\n\n## Phase 1: Infrastructure (REQ-1, REQ-2)\n\n- [ ] 1. Add zerolog dependency to go.mod\n  - File: go.mod\n  - Add `github.com/rs/zerolog` dependency\n  - Run `go mod tidy` to resolve dependencies\n  - Purpose: Make zerolog available for use throughout the codebase\n  - _Requirements: REQ-1_\n\n- [ ] 2. Create logging package with NewLogger function\n  - File: internal/logging/logger.go\n  - Implement `NewLogger()` function that creates a configured zerolog logger\n  - Read TF_LOG environment variable for log level setting\n  - Support levels: debug, info, warn, error (default: warn)\n  - Purpose: Centralized logger configuration\n  - _Leverage: Terraform TF_LOG convention_\n  - _Requirements: REQ-2_\n\n- [ ] 3. Implement ConsoleWriter and JSON output selection\n  - File: internal/logging/logger.go\n  - Use ConsoleWriter for human-readable output when TF_LOG_JSON is not set\n  - Use JSON format when TF_LOG_JSON=1 or in CI environment\n  - Purpose: Appropriate output format for different environments\n  - _Requirements: REQ-2_\n\n- [ ] 4. Implement context-based logger functions\n  - File: internal/logging/logger.go\n  - Implement `WithContext(ctx, logger)` to add logger to context\n  - Implement `FromContext(ctx)` to retrieve logger from context\n  - Return global logger if context has no logger\n  - Purpose: Context propagation for request tracing\n  - _Requirements: REQ-2, REQ-5_\n\n- [ ] 5. Add unit tests for logging package\n  - File: internal/logging/logger_test.go\n  - Test NewLogger with various TF_LOG values\n  - Test context functions (WithContext, FromContext)\n  - Test log level parsing and defaults\n  - Purpose: Ensure logging package works correctly\n  - _Requirements: REQ-2_\n\n## Phase 2: Sanitizing Hook (REQ-3)\n\n- [ ] 6. Create SanitizingHook for zerolog\n  - File: internal/logging/sanitizer.go\n  - Implement zerolog.Hook interface\n  - Integrate with existing SanitizeCommandForLog function\n  - Mask sensitive fields: password, key, token, secret\n  - Purpose: Automatic sensitive data redaction in logs\n  - _Leverage: internal/client/log_sanitizer.go patterns_\n  - _Requirements: REQ-3_\n\n- [ ] 7. Add tests for SanitizingHook\n  - File: internal/logging/sanitizer_test.go\n  - Test that passwords are redacted in log output\n  - Test that keys and tokens are masked\n  - Test that normal fields are not affected\n  - Purpose: Verify sensitive data protection\n  - _Requirements: REQ-3_\n\n## Phase 3: Client Layer Migration (REQ-3, REQ-5)\n\n- [ ] 8. Migrate simple_executor.go to zerolog\n  - File: internal/client/simple_executor.go\n  - Replace log.Printf calls with zerolog\n  - Add structured fields: command (sanitized), duration\n  - Get logger from context\n  - Purpose: Structured logging for command execution\n  - _Requirements: REQ-3_\n\n- [ ] 9. Migrate ssh_dialer.go to zerolog\n  - File: internal/client/ssh_dialer.go\n  - Replace log.Printf calls with zerolog\n  - Add structured fields: host, port, user\n  - Log connection events with appropriate levels\n  - Purpose: Structured logging for SSH connections\n  - _Requirements: REQ-3_\n\n- [ ] 10. Migrate working_session.go to zerolog\n  - File: internal/client/working_session.go\n  - Replace log.Printf calls with zerolog\n  - Add structured fields for session operations\n  - Purpose: Structured logging for session management\n  - _Requirements: REQ-3_\n\n- [ ] 11. Migrate remaining client files to zerolog\n  - Files: internal/client/*.go (excluding already migrated)\n  - Replace all log.Printf calls with zerolog\n  - Add appropriate structured fields\n  - Purpose: Complete client layer migration\n  - _Requirements: REQ-3_\n\n## Phase 4: Provider Layer Migration (REQ-4)\n\n- [ ] 12. Initialize logger in provider ConfigureContextFunc\n  - File: internal/provider/provider.go\n  - Create and configure zerolog logger\n  - Store logger in provider meta or context\n  - Purpose: Logger initialization point for all resources\n  - _Requirements: REQ-4_\n\n- [ ] 13. Create resource logging helper functions\n  - File: internal/provider/logging_helpers.go\n  - Implement helpers for CRUD operation logging\n  - Add fields: resource_type, resource_id, operation\n  - Purpose: Consistent logging across all resources\n  - _Requirements: REQ-4_\n\n- [ ] 14. Migrate high-usage resource files to zerolog\n  - Files: resource_rtx_static_route.go, resource_rtx_ospf.go, resource_rtx_bgp.go\n  - Replace log.Printf calls with zerolog\n  - Use logging helpers for CRUD operations\n  - Purpose: Migrate most commonly used resources first\n  - _Requirements: REQ-4_\n\n- [ ] 15. Migrate remaining resource files to zerolog\n  - Files: internal/provider/resource_*.go (remaining files)\n  - Replace all log.Printf calls with zerolog\n  - Use consistent structured logging patterns\n  - Purpose: Complete provider layer migration\n  - _Requirements: REQ-4_\n\n## Phase 5: Validation and Cleanup (REQ-6)\n\n- [ ] 16. Update tests that depend on log output\n  - Files: internal/*/test*.go\n  - Update any assertions that check log output format\n  - Ensure tests capture zerolog output correctly\n  - Purpose: Maintain test compatibility\n  - _Requirements: REQ-6_\n\n- [ ] 17. Run full test suite and fix issues\n  - Run `go test ./...` to verify all tests pass\n  - Fix any issues discovered during testing\n  - Purpose: Ensure migration doesn't break existing functionality\n  - _Requirements: REQ-6_\n\n- [ ] 18. Remove unused standard log imports\n  - Files: All migrated files\n  - Remove `\"log\"` import statements where no longer needed\n  - Run `goimports` to clean up imports\n  - Purpose: Clean up codebase after migration\n  - _Requirements: REQ-6_\n\n- [ ] 19. Integration testing with Terraform\n  - Test actual Terraform operations (plan, apply, destroy)\n  - Verify log output is correct in both console and JSON modes\n  - Test with various TF_LOG levels\n  - Purpose: End-to-end validation of logging\n  - _Requirements: REQ-6_\n",
  "fileStats": {
    "size": 5851,
    "lines": 153,
    "lastModified": "2026-01-20T14:43:58.493Z"
  },
  "comments": []
}