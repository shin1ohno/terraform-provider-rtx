{
  "id": "snapshot_1768910086345_leb6hiurv",
  "approvalId": "approval_1768909607023_zpeu7zz3e",
  "approvalTitle": "Tasks: Import Fidelity Fix (9 tasks in 4 phases)",
  "version": 3,
  "timestamp": "2026-01-20T11:54:46.345Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document: Import Fidelity Fix\n\n## Phase 1: P0 - Critical Parser Fixes\n\n- [ ] 1. Fix DNS server_select field parsing order (REQ-1)\n  - File: `internal/rtx/parsers/dns.go`\n  - Refactor `parseDNSServerSelectFields` to parse fields in correct order:\n    1. servers (1-2 IPs) from beginning\n    2. `edns=on` if present (literal match)\n    3. record_type if in validRecordTypes AND not `.`\n    4. query_pattern (required, first non-IP/non-keyword)\n    5. original_sender (optional, IP/CIDR after query_pattern)\n    6. `restrict pp n` if present\n  - Fix: Second server incorrectly parsed as original_sender\n  - Fix: record_type defaulting to `a` instead of preserving `aaaa`\n  - Fix: query_pattern `.` misinterpreted as other fields\n  - Purpose: Ensure DNS forwarding rules are accurately imported\n  - _Leverage: `internal/rtx/parsers/dns.go` existing isIPOrCIDR, validRecordTypes_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer specializing in text parsing | Task: Refactor parseDNSServerSelectFields to parse fields in strict order per RTX command specification for REQ-1 | Restrictions: Do not change DNSServerSelect struct, maintain backward compatibility, handle IPv6 addresses | _Leverage: internal/rtx/parsers/dns.go for isIPOrCIDR function | _Requirements: REQ-1 | Success: Test with two servers captures both in servers array, record_type aaaa preserved, query_pattern . captured correctly | After completing, use log-implementation tool, then mark [x]_\n\n- [ ] 2. Fix Interface secure_filter array truncation (REQ-2)\n  - File: `internal/rtx/parsers/interface_config.go`\n  - Investigate `parseFilterList` for truncation cause\n  - Check SSH output buffer size in `internal/client/`\n  - Verify regex captures entire line without truncation\n  - Test with 13+ filter IDs to reproduce issue\n  - Fix: Filter arrays truncated (e.g., `20010` instead of `200100`)\n  - Purpose: Ensure all firewall filter IDs are captured\n  - _Leverage: `internal/rtx/parsers/interface_config.go` parseFilterList_\n  - _Requirements: REQ-2_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer debugging parser issues | Task: Investigate and fix secure_filter array truncation in parseFilterList for REQ-2 | Restrictions: Do not change InterfaceConfig struct, maintain dynamic filter separation | _Leverage: internal/rtx/parsers/interface_config.go | _Requirements: REQ-2 | Success: Test with 13 filter IDs captures all correctly, no truncated IDs like 20010 | After completing, use log-implementation tool, then mark [x]_\n\n## Phase 2: P1 - High Priority Parser Fixes\n\n- [ ] 3. Fix Static route multi-gateway import (REQ-3)\n  - File: `internal/rtx/parsers/static_route.go`, `internal/client/static_route_service.go`\n  - Verify grep command captures all gateway lines for same prefix\n  - Confirm `ParseRouteConfig` groups by routeKey correctly\n  - Check if service query filters too narrowly\n  - Fix: Only first gateway captured for routes with multiple gateways\n  - Purpose: Ensure ECMP/failover routing configurations are preserved\n  - _Leverage: `internal/rtx/parsers/static_route.go` existing routeKey grouping_\n  - _Requirements: REQ-3_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer with networking background | Task: Fix static route multi-gateway import by verifying grep patterns and routeKey grouping for REQ-3 | Restrictions: Do not change StaticRoute struct, maintain weight/distance handling | _Leverage: internal/rtx/parsers/static_route.go | _Requirements: REQ-3 | Success: Route with 2 gateways shows both in next_hops array | After completing, use log-implementation tool, then mark [x]_\n\n- [ ] 4. Fix Admin user attribute parsing (REQ-5)\n  - File: `internal/rtx/parsers/admin.go`, `internal/provider/resource_rtx_admin_user.go`\n  - Verify `parseUserAttributeString` handles `login-timer=N` correctly\n  - Check `gui-page=` parsing (comma-separated values)\n  - Verify schema Default values don't override parsed values\n  - Fix: login_timer=0 instead of actual value, gui_pages empty\n  - Purpose: Ensure user permissions are accurately imported\n  - _Leverage: `internal/rtx/parsers/admin.go` parseUserAttributeString_\n  - _Requirements: REQ-5_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Fix admin user attribute parsing for login-timer and gui-page for REQ-5 | Restrictions: Maintain hyphen vs underscore mapping, don't break existing user creation | _Leverage: internal/rtx/parsers/admin.go | _Requirements: REQ-5 | Success: User with login-timer=3600 shows correct value, gui_pages list populated | After completing, use log-implementation tool, then mark [x]_\n\n## Phase 3: P2 - Medium Priority Fixes\n\n- [ ] 5. Fix L2TP tunnel_auth parsing (REQ-4)\n  - File: `internal/rtx/parsers/l2tp.go`\n  - Add debug logging to track currentTunnelID during parsing\n  - Verify `tunnel select N` sets currentTunnelID correctly\n  - Ensure L2TPv3Config initialization at tunnel select\n  - Fix l2tpTunnelAuthPattern association with correct tunnel\n  - Fix: tunnel_auth_enabled=false when router has `l2tp tunnel auth on`\n  - Purpose: Ensure L2TPv3 VPN security settings are preserved\n  - _Leverage: `internal/rtx/parsers/l2tp.go` l2tpTunnelAuthPattern_\n  - _Requirements: REQ-4_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer debugging stateful parsers | Task: Fix L2TP tunnel_auth parsing by ensuring correct tunnel context for REQ-4 | Restrictions: Do not change L2TPConfig struct, maintain tunnel select state | _Leverage: internal/rtx/parsers/l2tp.go | _Requirements: REQ-4 | Success: Tunnel with auth on shows tunnel_auth_enabled=true | After completing, use log-implementation tool, then mark [x]_\n\n- [ ] 6. Relax schema constraints for import compatibility (REQ-6)\n  - File: Various `internal/provider/resource_rtx_*.go`\n  - Audit schemas for `Required: true` on optional router attributes\n  - Change to `Optional: true` where appropriate for import\n  - Add `Computed: true` for attributes with router defaults\n  - Remove `Default:` that overrides imported values\n  - Purpose: Enable import without validation errors\n  - _Leverage: Existing resource schemas_\n  - _Requirements: REQ-6_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer specializing in schema design | Task: Relax schema constraints for import compatibility per REQ-6 | Restrictions: Don't break existing configurations, maintain validation for Create | _Leverage: internal/provider/resource_rtx_*.go schemas | _Requirements: REQ-6 | Success: Import succeeds without Required attribute errors, no perpetual diffs | After completing, use log-implementation tool, then mark [x]_\n\n## Phase 4: Testing and Validation\n\n- [ ] 7. Create test fixtures for parser fixes\n  - File: `internal/rtx/testdata/import_fidelity/`\n  - Create `dns_server_select_multi_server.txt` - two servers, edns, aaaa\n  - Create `interface_filter_long_list.txt` - 13+ filter IDs\n  - Create `static_route_multi_gateway.txt` - same prefix, 2 gateways\n  - Create `l2tp_tunnel_auth.txt` - tunnel auth on with password\n  - Create `admin_user_full_attributes.txt` - all attribute types\n  - Purpose: Provide test data for parser unit tests\n  - _Leverage: Existing testdata patterns_\n  - _Requirements: REQ-1 through REQ-5_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer creating test fixtures | Task: Create test fixture files with realistic RTX configurations | Restrictions: Use valid RTX command syntax, include edge cases | _Leverage: internal/rtx/testdata/ | _Requirements: All | Success: Fixture files created with valid syntax | After completing, use log-implementation tool, then mark [x]_\n\n- [ ] 8. Add parser unit tests using fixtures\n  - File: `internal/rtx/parsers/*_test.go`\n  - Add tests for DNS multi-server and record_type parsing\n  - Add tests for interface filter long lists\n  - Add tests for static route multi-gateway grouping\n  - Add tests for L2TP tunnel auth context\n  - Add tests for admin user attributes\n  - Purpose: Ensure parser fixes work correctly\n  - _Leverage: Test fixtures from task 7_\n  - _Requirements: REQ-1 through REQ-5_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer writing parser unit tests | Task: Add parser unit tests using fixtures for all requirements | Restrictions: Table-driven tests, no external mocks | _Leverage: internal/rtx/parsers/*_test.go patterns | _Requirements: All | Success: All tests pass, cover edge cases | After completing, use log-implementation tool, then mark [x]_\n\n- [ ] 9. Validate import round-trip fidelity\n  - File: Manual testing / acceptance tests\n  - Test: `terraform import` → `terraform plan` shows no changes\n  - Verify each fixed resource type imports correctly\n  - Document any remaining known limitations\n  - Purpose: Confirm end-to-end import fidelity achieved\n  - _Leverage: RTX router or simulator_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec import-fidelity-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer validating import functionality | Task: Validate import round-trip produces no plan diff | Restrictions: Document steps for reproducibility | _Leverage: Existing acceptance test patterns | _Requirements: All | Success: Import → plan shows no changes for all resource types | After completing, use log-implementation tool, then mark [x]_\n",
  "fileStats": {
    "size": 10203,
    "lines": 118,
    "lastModified": "2026-01-20T11:46:40.932Z"
  },
  "comments": []
}