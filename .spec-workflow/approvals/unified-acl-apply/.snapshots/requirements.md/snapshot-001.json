{
  "id": "snapshot_1769439353802_lbj042noh",
  "approvalId": "approval_1769439353434_apyuy4y7k",
  "approvalTitle": "Requirements: Unified ACL Apply Design",
  "version": 1,
  "timestamp": "2026-01-26T14:55:53.802Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: Unified ACL Apply Design\n\n## Introduction\n\nThis specification unifies the ACL (Access Control List) design pattern across all ACL types in the Terraform RTX provider. Currently, MAC ACL uses a group-based design with an `apply` block for interface assignment, while IP Extended ACL and IPv6 ACL lack this capability. This inconsistency creates confusion and forces users to manage interface assignments through separate resources.\n\nThe goal is to adopt the MAC ACL design pattern (group + apply block) across all ACL types, providing a consistent and intuitive user experience.\n\n## Alignment with Product Vision\n\nThis feature directly supports the product principles outlined in product.md:\n\n1. **Cisco-Compatible Syntax**: The unified design aligns with Cisco IOS XE provider patterns where ACLs are defined as groups and applied to interfaces within the same resource context.\n2. **Follow RTX CLI Semantics**: The apply block mirrors how RTX CLI commands work (`ip lan1 secure filter in ...`).\n3. **Minimal Scope**: Focuses on unifying existing functionality rather than adding new features.\n4. **State Clarity**: All ACL configuration including interface application is managed in one resource.\n\n## Requirements\n\n### Requirement 1: Add `apply` Block to `rtx_access_list_extended`\n\n**User Story:** As a network administrator, I want to define IP ACL rules and their interface application in a single resource, so that I can manage access control configuration atomically.\n\n#### Acceptance Criteria\n\n1. WHEN a user defines an `rtx_access_list_extended` resource with an `apply` block THEN the provider SHALL create the ACL entries AND apply them to the specified interface(s).\n2. WHEN the `apply` block specifies `interface`, `direction`, and `filter_ids` THEN the provider SHALL execute the appropriate RTX command (`ip <interface> secure filter <direction> ...`).\n3. IF the `apply` block is omitted THEN the provider SHALL create only the ACL entries without interface application (backward compatible behavior).\n4. WHEN updating an `rtx_access_list_extended` resource with changes to the `apply` block THEN the provider SHALL update the interface filter assignment accordingly.\n5. WHEN deleting an `rtx_access_list_extended` resource with an `apply` block THEN the provider SHALL remove the interface filter assignment before deleting the ACL entries.\n\n### Requirement 2: Redesign `rtx_access_list_ipv6` as Group Resource with `apply` Block\n\n**User Story:** As a network administrator, I want to manage IPv6 ACL entries as a named group with interface application, so that I have a consistent experience across all ACL types.\n\n#### Acceptance Criteria\n\n1. WHEN a user defines an `rtx_access_list_ipv6` resource with `name` and multiple `entry` blocks THEN the provider SHALL create all IPv6 filter entries as a logical group.\n2. WHEN the `rtx_access_list_ipv6` resource includes an `apply` block THEN the provider SHALL apply the filters to the specified interface(s) using `ipv6 <interface> secure filter <direction> ...`.\n3. IF the user specifies `sequence` in each entry THEN the provider SHALL use those values as filter IDs.\n4. WHEN reading the resource THEN the provider SHALL return all entries belonging to the named group AND any interface applications.\n5. WHEN deleting the resource THEN the provider SHALL remove interface applications first, then delete all filter entries.\n\n### Requirement 3: Maintain Backward Compatibility\n\n**User Story:** As an existing user, I want my current Terraform configurations to continue working without modification, so that I can upgrade the provider without disruption.\n\n#### Acceptance Criteria\n\n1. IF existing `rtx_interface` resources use `access_list_*_in/out` attributes THEN the provider SHALL continue to support these attributes.\n2. WHEN both `rtx_access_list_*` with `apply` block AND `rtx_interface` with `access_list_*` attribute reference the same interface/direction THEN the provider SHALL warn about potential conflicts during plan.\n3. IF `rtx_access_list_ipv6` resources are imported from existing state THEN the provider SHALL migrate them to the new group-based structure.\n\n### Requirement 4: Consistent Schema Design\n\n**User Story:** As a Terraform user, I want all ACL resources to have the same schema structure, so that I can apply knowledge from one ACL type to another.\n\n#### Acceptance Criteria\n\n1. WHEN defining any ACL resource (`rtx_access_list_mac`, `rtx_access_list_extended`, `rtx_access_list_ipv6`) THEN the user SHALL use the same attribute names for common concepts (`name`, `entry`, `apply`, `sequence`).\n2. WHEN using the `apply` block THEN all ACL types SHALL accept the same structure: `interface`, `direction`, and `filter_ids`.\n3. IF the user specifies invalid values in the `apply` block THEN the provider SHALL return consistent error messages across all ACL types.\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **Single Responsibility Principle**: The `apply` logic should be extracted into a shared helper to avoid code duplication across ACL resources.\n- **Modular Design**: Service methods for interface filter application should be reusable across IP, IPv6, and MAC ACL types.\n- **Dependency Management**: Minimize changes to existing parser infrastructure; extend rather than rewrite.\n- **Clear Interfaces**: Define a common interface for ACL resources that support the `apply` pattern.\n\n### Performance\n\n- Apply operations should be batched where possible to minimize SSH round-trips.\n- Reading ACL state should leverage SFTP cache when available (already implemented for some resources).\n\n### Security\n\n- No changes to existing security model; credentials continue to use Terraform's secure variable mechanism.\n\n### Reliability\n\n- If apply operation fails, the ACL entries should still be created (partial success) with clear error messaging.\n- Terraform plan should accurately reflect the expected interface filter state.\n\n### Usability\n\n- Documentation should be updated with examples showing the unified `apply` block pattern.\n- Migration guide should be provided for users converting from `rtx_interface`-based ACL assignment.\n",
  "fileStats": {
    "size": 6183,
    "lines": 91,
    "lastModified": "2026-01-26T14:55:48.298Z"
  },
  "comments": []
}