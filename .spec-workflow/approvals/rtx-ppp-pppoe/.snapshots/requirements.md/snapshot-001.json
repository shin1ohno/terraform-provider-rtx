{
  "id": "snapshot_1768915637405_t03di7huz",
  "approvalId": "approval_1768915637391_iroahkfna",
  "approvalTitle": "Requirements: RTX PPP/PPPoE Resource",
  "version": 1,
  "timestamp": "2026-01-20T13:27:17.405Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: RTX PPP/PPPoE Resource\n\n## Introduction\n\nThis feature implements Terraform resources for PPP (Point-to-Point Protocol) and PPPoE (PPP over Ethernet) configurations on Yamaha RTX routers. PPP/PPPoE is essential for WAN connectivity, particularly for ISP connections in Japan where PPPoE is the dominant connection method for fiber (FLET'S) and DSL services.\n\n## Alignment with Product Vision\n\nThis feature supports the product vision by:\n- Enabling Terraform management of WAN connectivity configurations\n- Supporting the most common ISP connection method in Japan\n- Completing the network connectivity stack (LAN, VLAN, PPPoE for WAN)\n- Allowing Infrastructure-as-Code for complete router configuration\n\n## Requirements\n\n### REQ-1: PPPoE Client Configuration\n\n**User Story:** As a network administrator, I want to configure PPPoE client settings via Terraform, so that I can manage ISP connections as code.\n\n#### Acceptance Criteria\n\n1. WHEN creating a PPPoE connection THEN the resource SHALL support:\n   - PP interface selection (pp 1, pp 2, etc.)\n   - Username and password authentication\n   - Service name specification (optional)\n   - AC name specification (optional)\n2. WHEN configuring authentication THEN the resource SHALL support:\n   - PAP authentication\n   - CHAP authentication\n   - MS-CHAP authentication\n   - MS-CHAPv2 authentication\n3. WHEN managing connection state THEN the resource SHALL support:\n   - Auto-connect on boot\n   - Manual connect/disconnect\n   - Connection timeout settings\n   - LCP echo configuration\n\n### REQ-2: PP Interface IP Configuration\n\n**User Story:** As a network administrator, I want to configure IP settings on PP interfaces, so that I can manage addressing for WAN connections.\n\n#### Acceptance Criteria\n\n1. WHEN configuring IP address THEN the resource SHALL support:\n   - Dynamic IP (IPCP negotiation)\n   - Static IP assignment\n   - IP address with netmask\n2. WHEN configuring DNS THEN the resource SHALL support:\n   - Dynamic DNS from ISP (IPCP)\n   - Static DNS server specification\n3. WHEN configuring routing THEN the resource SHALL support:\n   - Default route via PP interface\n   - Route metric specification\n   - Multiple default routes for failover\n\n### REQ-3: PPP Keepalive and LCP\n\n**User Story:** As a network administrator, I want to configure PPP keepalive settings, so that I can detect and recover from connection failures.\n\n#### Acceptance Criteria\n\n1. WHEN configuring LCP echo THEN the resource SHALL support:\n   - Echo interval (seconds)\n   - Echo failure count before disconnect\n   - LCP restart timer\n2. WHEN configuring reconnection THEN the resource SHALL support:\n   - Auto-reconnect enable/disable\n   - Reconnect delay\n   - Maximum reconnect attempts\n\n### REQ-4: PPPoE Session Management\n\n**User Story:** As a network administrator, I want to manage multiple PPPoE sessions, so that I can configure multi-WAN setups.\n\n#### Acceptance Criteria\n\n1. WHEN managing multiple sessions THEN the resource SHALL support:\n   - Multiple PP interfaces (pp 1-30)\n   - Binding PP to LAN interface (pp bind lan2)\n   - Session priority for load balancing\n2. WHEN importing existing configurations THEN the resource SHALL:\n   - Read current PPPoE configuration from router\n   - Map to Terraform state correctly\n   - Handle encrypted passwords appropriately\n\n### REQ-5: PPP Compression and MTU\n\n**User Story:** As a network administrator, I want to configure PPP compression and MTU settings, so that I can optimize connection performance.\n\n#### Acceptance Criteria\n\n1. WHEN configuring compression THEN the resource SHALL support:\n   - Van Jacobson header compression\n   - MPPC compression (if available)\n   - Compression enable/disable\n2. WHEN configuring MTU/MRU THEN the resource SHALL support:\n   - MTU setting (typically 1454 for PPPoE)\n   - MRU setting\n   - TCP MSS adjustment\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n- **Parser Module**: Create `internal/rtx/parsers/ppp.go` for command parsing\n- **Client Module**: Create `internal/client/ppp_service.go` for API operations\n- **Provider Resources**: Create separate resources for PPPoE and PP interface configuration\n- **Pattern Catalog**: Create `internal/rtx/testdata/patterns/ppp.yaml`\n\n### Performance\n- PPPoE configuration changes SHALL complete within 10 seconds\n- Connection state reads SHALL complete within 5 seconds\n- Bulk operations on multiple PP interfaces SHALL be parallelizable\n\n### Security\n- Passwords SHALL be marked as sensitive in Terraform state\n- Credentials SHALL not appear in plan output by default\n- Encrypted password format from router SHALL be preserved during import\n\n### Reliability\n- Resource SHALL handle connection state changes gracefully\n- Import SHALL work for existing PPPoE configurations\n- Resource SHALL validate configuration before applying to router\n\n### Usability\n- Resource documentation SHALL include common ISP configuration examples\n- Error messages SHALL clearly indicate authentication or connection failures\n- Examples SHALL cover NTT FLET'S and common Japanese ISP patterns\n",
  "fileStats": {
    "size": 5093,
    "lines": 129,
    "lastModified": "2026-01-20T13:27:08.133Z"
  },
  "comments": []
}