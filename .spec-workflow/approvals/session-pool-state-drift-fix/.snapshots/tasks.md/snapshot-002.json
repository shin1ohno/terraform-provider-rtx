{
  "id": "snapshot_1769347177166_pvbo06kob",
  "approvalId": "approval_1769347160217_go42lzz6q",
  "approvalTitle": "Tasks: State Drift Fix for Access List Resources",
  "version": 2,
  "timestamp": "2026-01-25T13:19:37.166Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document: State Drift Fix for Access List Resources\n\n- [ ] 1. Fix rtx_interface Read to preserve access list attributes\n  - File: internal/provider/resource_rtx_interface.go\n  - Modify resourceRtxInterfaceRead to not overwrite access list attributes with empty values\n  - Only call d.Set() for access list fields when config has non-empty values\n  - Purpose: Prevent state drift for access_list_ip_in/out, access_list_ip_dynamic_in/out, access_list_mac_in/out\n  - _Leverage: terraform-plugin-sdk d.Get() to preserve existing state_\n  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_\n  - _Prompt: Implement the task for spec session-pool-state-drift-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer specializing in Terraform providers | Task: Modify resourceRtxInterfaceRead in internal/provider/resource_rtx_interface.go to preserve access list attribute values in state. When the service returns empty values for access_list_ip_in, access_list_ip_out, access_list_ip_dynamic_in, access_list_ip_dynamic_out, access_list_mac_in, access_list_mac_out, do NOT call d.Set() to overwrite the existing state value. This preserves the user-configured access list name since RTX router stores filter numbers, not names. | Restrictions: Do not modify InterfaceService, do not change other resource files, preserve existing logic for non-access-list fields | Success: After terraform apply with access list bindings, terraform plan shows \"No changes\" for interface resource. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 2. Fix rtx_ipv6_interface Read to preserve access list attributes\n  - File: internal/provider/resource_rtx_ipv6_interface.go\n  - Modify resourceRtxIPv6InterfaceRead to not overwrite access list attributes with empty values\n  - Only call d.Set() for access list fields when config has non-empty values\n  - Purpose: Prevent state drift for access_list_ipv6_in/out, access_list_ipv6_dynamic_in/out\n  - _Leverage: terraform-plugin-sdk d.Get() to preserve existing state_\n  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_\n  - _Prompt: Implement the task for spec session-pool-state-drift-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer specializing in Terraform providers | Task: Modify resourceRtxIPv6InterfaceRead in internal/provider/resource_rtx_ipv6_interface.go to preserve access list attribute values in state. When the service returns empty values for access_list_ipv6_in, access_list_ipv6_out, access_list_ipv6_dynamic_in, access_list_ipv6_dynamic_out, do NOT call d.Set() to overwrite the existing state value. | Restrictions: Do not modify IPv6InterfaceService, do not change other resource files | Success: After terraform apply with IPv6 access list bindings, terraform plan shows \"No changes\" for ipv6_interface resource. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 3. Add DiffSuppressFunc for ace_action in rtx_access_list_mac\n  - File: internal/provider/resource_rtx_access_list_mac.go\n  - Add DiffSuppressFunc to ace_action schema field\n  - Treat equivalent actions as same: pass=pass-nolog=permit, reject=reject-nolog=deny\n  - Purpose: Prevent diff when router normalizes action values\n  - _Leverage: terraform-plugin-sdk schema.DiffSuppressFunc_\n  - _Requirements: 1.2, 1.3_\n  - _Prompt: Implement the task for spec session-pool-state-drift-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer specializing in Terraform providers | Task: Add DiffSuppressFunc to the ace_action field in internal/provider/resource_rtx_access_list_mac.go. The function should treat these action values as equivalent: \"pass\", \"pass-nolog\", \"permit\" are all equivalent; \"reject\", \"reject-nolog\", \"deny\" are all equivalent. This prevents perpetual diffs when the router normalizes action values. | Restrictions: Only modify ace_action schema, do not change other fields or service logic | Success: terraform plan shows no diff when ace_action varies between equivalent values. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 4. Fix address normalization in ethernet_filter_service\n  - File: internal/client/ethernet_filter_service.go\n  - Modify fromParserFilterToMACEntry to normalize action values consistently\n  - Ensure pass-nolog stays as pass-nolog (not converted to permit)\n  - Purpose: Preserve original action value through read cycle\n  - _Leverage: existing fromParserFilterToMACEntry function_\n  - _Requirements: 1.2, 1.3_\n  - _Prompt: Implement the task for spec session-pool-state-drift-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Modify fromParserFilterToMACEntry in internal/client/ethernet_filter_service.go to preserve original action values. Currently the function converts \"pass\" to \"permit\" and \"reject\" to \"deny\", but this loses the -nolog suffix. Change the logic to: only convert if the original value is exactly \"pass\" or \"reject\", but preserve \"pass-nolog\", \"pass-log\", \"reject-nolog\", \"reject-log\" as-is. | Restrictions: Only modify action mapping logic, do not change other parts of the function | Success: Read returns the same action value that was written. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 5. Fix source/destination address vs any field handling\n  - File: internal/provider/resource_rtx_access_list_mac.go\n  - Add DiffSuppressFunc for source_address and destination_address fields\n  - Suppress diff when corresponding *_any field is true\n  - Purpose: Prevent diff when wildcard address is normalized to *_any=true\n  - _Leverage: terraform-plugin-sdk schema.DiffSuppressFunc, d.Get()_\n  - _Requirements: 1.4, 1.5, 1.6_\n  - _Prompt: Implement the task for spec session-pool-state-drift-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer specializing in Terraform providers | Task: Add DiffSuppressFunc to source_address and destination_address fields in internal/provider/resource_rtx_access_list_mac.go. The function should suppress diff when the corresponding *_any field is true. For example, if source_any=true in state, suppress diff for source_address regardless of its value. Also handle the case where source_address=\"*:*:*:*:*:*\" should be treated as source_any=true. | Restrictions: Only modify source_address and destination_address schema fields, do not change the Read function | Success: terraform plan shows no diff when using *_any=true or wildcard address. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 6. Verify fixes with terraform plan\n  - File: examples/import/main.tf (test with existing config)\n  - Run terraform plan to verify all diffs are resolved\n  - Test import flow: import -> plan shows no changes\n  - Purpose: Validate all fixes work together\n  - _Leverage: existing example configuration_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec session-pool-state-drift-fix, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer | Task: Verify all state drift fixes by running terraform plan in examples/import directory. After terraform apply, running terraform plan should show \"No changes. Your infrastructure matches the configuration.\" for all access list related resources. If any diffs remain, document them for further investigation. | Restrictions: Do not modify the example configuration, only verify behavior | Success: terraform plan shows no changes after apply for all affected resources. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n",
  "fileStats": {
    "size": 8194,
    "lines": 56,
    "lastModified": "2026-01-25T13:19:15.447Z"
  },
  "comments": []
}