{
  "id": "snapshot_1769055764006_rdm5a5k13",
  "approvalId": "approval_1769055763994_64niu70en",
  "approvalTitle": "Tasks: Parser Import Bugs Implementation",
  "version": 1,
  "timestamp": "2026-01-22T04:22:44.006Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Parser Import Bugs\n\n## Bug 1: Filter List Parsing\n\n- [ ] 1.1. Fix preprocessWrappedLines continuation pattern\n  - File: internal/rtx/parsers/interface_config.go\n  - Change continuation pattern from `^\\d` to `^\\s+\\d` to detect lines starting with space+digit\n  - Handle RTX 80-char line wrapping correctly\n  - Purpose: Fix filter number truncation when lists wrap to multiple lines\n  - _Leverage: existing preprocessWrappedLines function_\n  - _Requirements: 1.1, 1.3_\n\n- [ ] 1.2. Add wrapped line test cases\n  - File: internal/rtx/parsers/interface_config_test.go\n  - Add test for 10+ filter numbers spanning multiple lines\n  - Test 6-digit filter numbers (200100, 200102, etc.)\n  - Test dynamic keyword with wrapped lines\n  - Purpose: Ensure wrapped lines are correctly joined\n  - _Leverage: existing test patterns_\n  - _Requirements: 1.1, 1.2, 1.4_\n\n- [ ] 1.3. Apply same fix to IPv6 interface parser\n  - File: internal/rtx/parsers/ipv6_interface.go\n  - Add preprocessWrappedLines call before parsing\n  - Ensure IPv6 filter lists handle wrapping\n  - Purpose: Consistent behavior between IPv4 and IPv6\n  - _Leverage: interface_config.go preprocessWrappedLines_\n  - _Requirements: 1.1_\n\n## Bug 2: DNS server_select Parsing\n\n- [ ] 2.1. Fix parseDNSServerSelectFields server limit\n  - File: internal/rtx/parsers/dns.go\n  - Limit server parsing to max 2 IPs\n  - Prevent 3rd+ fields from being parsed as servers\n  - Purpose: Stop second server IP being parsed as query_pattern\n  - _Leverage: existing parseDNSServerSelectFields function_\n  - _Requirements: 2.1, 2.2_\n\n- [ ] 2.2. Add DNS server_select test cases\n  - File: internal/rtx/parsers/dns_test.go\n  - Add test for 2-server config with edns=on and record_type\n  - Test query_pattern \".\" is not confused with IP\n  - Test record_type \"aaaa\" parsing\n  - Purpose: Verify correct field order parsing\n  - _Leverage: existing DNS test patterns_\n  - _Requirements: 2.1, 2.2, 2.3, 2.4_\n\n## Bug 3: DHCP Scope Parsing\n\n- [ ] 3.1. Fix scopePattern regex for expire without gateway\n  - File: internal/rtx/parsers/dhcp_scope.go\n  - Remove optional gateway from regex pattern\n  - Support direct \"expire\" after network CIDR\n  - Purpose: Parse \"dhcp scope 1 192.168.0.0/16 expire 24:00\" correctly\n  - _Leverage: existing scopePattern regex_\n  - _Requirements: 3.1, 3.2_\n\n- [ ] 3.2. Add DHCP scope parsing test cases\n  - File: internal/rtx/parsers/dhcp_scope_test.go\n  - Add test for scope with network and expire (no gateway)\n  - Verify network field is populated correctly\n  - Test lease_time conversion\n  - Purpose: Ensure network CIDR is always captured\n  - _Leverage: existing DHCP test patterns_\n  - _Requirements: 3.1, 3.2, 3.3_\n\n## Bug 4: NAT Masquerade Import\n\n- [ ] 4.1. Fix BuildShowNATDescriptorCommand grep pattern\n  - File: internal/rtx/parsers/nat_masquerade.go\n  - Remove trailing space from grep pattern\n  - Use broader pattern and filter in parser\n  - Purpose: Find NAT descriptor by ID correctly\n  - _Leverage: existing grep patterns_\n  - _Requirements: 4.1_\n\n- [ ] 4.2. Add NAT masquerade import test cases\n  - File: internal/rtx/parsers/nat_masquerade_test.go\n  - Add test for descriptor ID 1000\n  - Test multiple static entries parsing\n  - Test protocol-only entries (esp, ah)\n  - Purpose: Verify descriptor lookup works\n  - _Leverage: existing NAT test patterns_\n  - _Requirements: 4.1, 4.2_\n\n## Bug 5: IPv6 Filter Dynamic Read\n\n- [ ] 5.1. Create ParseIPv6FilterDynamicConfig function\n  - File: internal/rtx/parsers/ip_filter.go\n  - Add IPv6 version of dynamic filter parser\n  - Parse \"ipv6 filter dynamic <n> <src> <dst> <protocol> [syslog on]\"\n  - Purpose: Enable IPv6 dynamic filter parsing\n  - _Leverage: existing ParseIPFilterDynamicConfig function_\n  - _Requirements: 5.1, 5.2_\n\n- [ ] 5.2. Add IPv6 dynamic filter test cases\n  - File: internal/rtx/parsers/ip_filter_test.go\n  - Add test for 8 IPv6 dynamic filter entries\n  - Test protocols: ftp, domain, www, smtp, pop3, submission, tcp, udp\n  - Test syslog option parsing\n  - Purpose: Verify IPv6 dynamic filter parsing\n  - _Leverage: existing IP filter test patterns_\n  - _Requirements: 5.1, 5.2_\n\n- [ ] 5.3. Implement GetIPv6FilterDynamicConfig in client\n  - File: internal/client/rtx_ipv6_filter_dynamic.go\n  - Call \"show config | grep ipv6 filter dynamic\"\n  - Parse with ParseIPv6FilterDynamicConfig\n  - Return IPv6FilterDynamicConfig struct\n  - Purpose: Enable IPv6 dynamic filter read/import\n  - _Leverage: existing GetIPFilterDynamicConfig pattern_\n  - _Requirements: 5.1, 5.3_\n\n## Integration Testing\n\n- [ ] 6.1. Run terraform import integration test\n  - Execute terraform import for all affected resources\n  - Verify terraform plan shows no diff\n  - Test: interface.lan2, dns_server, dhcp_scope, nat_masquerade, ipv6_filter_dynamic\n  - Purpose: Confirm all bugs are fixed end-to-end\n  - _Requirements: All_\n",
  "fileStats": {
    "size": 4848,
    "lines": 123,
    "lastModified": "2026-01-22T04:22:36.171Z"
  },
  "comments": []
}