{
  "id": "snapshot_1768912676994_c4rl3brv1",
  "approvalId": "approval_1768912676986_ohg7jo3ta",
  "approvalTitle": "RTX Command Parser Framework - Requirements",
  "version": 1,
  "timestamp": "2026-01-20T12:37:56.994Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: RTX Command Parser Framework\n\n## Introduction\n\nThis feature provides a comprehensive parser framework for Yamaha RTX router commands. Based on analysis of the 59-chapter, 824-page RTX command reference documentation, this framework will systematically parse all RTX command patterns. The goal is to enable the Terraform provider to accurately read, write, and validate RTX router configurations by understanding all possible command syntaxes.\n\n## Alignment with Product Vision\n\nThis feature directly supports the product vision of \"Infrastructure as Code management of Yamaha RTX routers\" by:\n- Enabling comprehensive parsing of all RTX CLI commands for import operations\n- Supporting accurate command generation for Terraform resource CRUD operations\n- Reducing configuration errors through syntax validation\n- Following the Parser Registry Pattern established in the tech stack\n\n## Requirements\n\n### REQ-1: Command Syntax Pattern Recognition\n\n**User Story:** As a provider developer, I want the parser to recognize all RTX command syntax patterns, so that I can implement comprehensive resource coverage.\n\n#### Acceptance Criteria\n\n1. WHEN parsing a simple command like `ip routing on` THEN the parser SHALL extract command name (`ip routing`) and value (`on`)\n2. WHEN parsing an interface-scoped command like `ip lan1 address 192.168.1.1/24` THEN the parser SHALL extract command prefix (`ip`), interface (`lan1`), subcommand (`address`), and parameters (`192.168.1.1/24`)\n3. WHEN parsing an identifier-scoped command like `ipsec ike version 1 2` THEN the parser SHALL extract command path (`ipsec ike version`), identifier (`1`), and value (`2`)\n4. WHEN parsing a `no` command like `no ip routing` THEN the parser SHALL recognize it as a deletion/reset command\n5. WHEN parsing a command with named parameters like `vlan lan1/1 802.1q vid=100 name=test` THEN the parser SHALL extract key-value pairs correctly\n\n### REQ-2: Interface Name Pattern Support\n\n**User Story:** As a provider developer, I want the parser to recognize all RTX interface naming conventions, so that I can correctly scope commands to their interfaces.\n\n#### Acceptance Criteria\n\n1. WHEN encountering `lan1`, `lan2` interface names THEN the parser SHALL recognize them as physical LAN interfaces\n2. WHEN encountering `lan1.1`, `lan1.2` interface names THEN the parser SHALL recognize them as LAN division (port-based) interfaces\n3. WHEN encountering `lan1/1`, `lan1/2` interface names THEN the parser SHALL recognize them as tagged VLAN interfaces\n4. WHEN encountering `pp`, `pp1` interface names THEN the parser SHALL recognize them as PP (Point-to-Point) interfaces\n5. WHEN encountering `tunnel1`, `tunnel2` interface names THEN the parser SHALL recognize them as tunnel interfaces\n6. WHEN encountering `loopback1`, `loopback2` interface names THEN the parser SHALL recognize them as loopback interfaces\n7. WHEN encountering `bridge1` interface names THEN the parser SHALL recognize them as bridge interfaces\n8. WHEN encountering `vlan1`, `vlan2` interface names THEN the parser SHALL recognize them as VLAN interfaces (LAN division extension)\n9. WHEN encountering `bri1`, `pri1` interface names THEN the parser SHALL recognize them as ISDN/PRI interfaces\n10. WHEN encountering `null` interface name THEN the parser SHALL recognize it as the NULL interface\n\n### REQ-3: Value Type Parsing\n\n**User Story:** As a provider developer, I want the parser to correctly parse all RTX command value types, so that values can be validated and stored correctly.\n\n#### Acceptance Criteria\n\n1. WHEN parsing `on/off` switch values THEN the parser SHALL convert them to boolean types\n2. WHEN parsing IPv4 addresses like `192.168.1.1` THEN the parser SHALL validate the format (xxx.xxx.xxx.xxx where xxx is 0-255)\n3. WHEN parsing CIDR notation like `/24` or `/255.255.255.0` THEN the parser SHALL normalize to mask bit count\n4. WHEN parsing IPv6 addresses THEN the parser SHALL validate according to RFC 5952\n5. WHEN parsing numeric values with ranges like `64..1500` THEN the parser SHALL validate the value falls within the documented range\n6. WHEN parsing hexadecimal values like `0x1f` THEN the parser SHALL convert to decimal equivalents\n7. WHEN parsing MAC addresses THEN the parser SHALL accept formats `XX:XX:XX:XX:XX:XX` and normalize to uppercase\n8. WHEN parsing time values like `HH:MM` THEN the parser SHALL validate the 24-hour format\n9. WHEN parsing duration values like `300` (seconds) THEN the parser SHALL accept integer values\n\n### REQ-4: Complex Parameter Parsing\n\n**User Story:** As a provider developer, I want the parser to handle complex parameter combinations, so that advanced RTX features can be properly configured.\n\n#### Acceptance Criteria\n\n1. WHEN parsing repeated parameters like `gateway gw1 [param] gateway gw2 [param]` THEN the parser SHALL collect all gateway entries with their parameters\n2. WHEN parsing multi-value parameters like `filter 1 2 3` THEN the parser SHALL collect all values into a list\n3. WHEN parsing optional parameters in brackets `[broadcast ip]` THEN the parser SHALL correctly identify present vs. absent optional values\n4. WHEN parsing named parameter syntax like `vid=100` THEN the parser SHALL extract key-value pairs\n5. WHEN parsing compound interface groups like `vlan1-3,vlan5` THEN the parser SHALL expand ranges and handle comma-separated lists\n6. WHEN parsing special modifiers like `$` (dollar sign for interconnect groups) THEN the parser SHALL interpret them according to RTX documentation\n\n### REQ-5: Command Category Organization\n\n**User Story:** As a provider developer, I want commands organized by functional category, so that I can implement related resources together.\n\n#### Acceptance Criteria\n\n1. WHEN registering parsers THEN the system SHALL organize them by the following categories:\n   - Network & Routing (IP, OSPF, BGP, static routes)\n   - Network Services (DHCP, DNS, NAT)\n   - VPN & Tunneling (IPsec, L2TP, PPTP, IPIP)\n   - Security & Filtering (ethernet-filter, ip-filter, url-filter)\n   - Quality of Service (QoS, DPI)\n   - Interfaces & Connectivity (VLAN, Bridge, PPP, Mobile)\n   - Monitoring & Management (SNMP, RADIUS, Syslog)\n   - System Management (Admin, Schedule, License)\n2. WHEN a command spans multiple categories THEN it SHALL be registered with its primary category\n\n### REQ-6: Model-Specific Parsing\n\n**User Story:** As a provider developer, I want the parser to handle model-specific command variations, so that configurations work correctly across different RTX models.\n\n#### Acceptance Criteria\n\n1. WHEN parsing commands for vRX series THEN the parser SHALL apply vRX-specific parameter ranges\n2. WHEN parsing commands for RTX5000/RTX3500 THEN the parser SHALL apply enterprise-tier parameter ranges\n3. WHEN parsing commands for RTX1300/RTX1220/RTX1210 THEN the parser SHALL apply mid-range parameter ranges\n4. WHEN parsing commands for RTX840/RTX830 THEN the parser SHALL apply entry-level parameter ranges\n5. IF a command is not supported on a specific model THEN the parser SHALL return an appropriate error\n\n### REQ-7: Configuration Output Generation\n\n**User Story:** As a provider developer, I want to generate valid RTX command strings from structured data, so that Terraform can apply configurations.\n\n#### Acceptance Criteria\n\n1. WHEN generating a command from parsed data THEN the output SHALL be valid RTX CLI syntax\n2. WHEN generating commands with optional parameters THEN the generator SHALL omit parameters set to their default values (unless explicitly required)\n3. WHEN generating `no` commands for resource deletion THEN the generator SHALL produce the correct deletion syntax\n4. WHEN generating commands with special characters THEN the generator SHALL properly escape `?`, `#`, `|`, `>`, `\\`, `'`, `\"`, and spaces\n\n### REQ-8: Error Handling and Validation\n\n**User Story:** As a provider user, I want clear error messages when configurations are invalid, so that I can quickly fix issues.\n\n#### Acceptance Criteria\n\n1. WHEN a required parameter is missing THEN the parser SHALL return an error specifying which parameter is required\n2. WHEN a parameter value is out of range THEN the parser SHALL return an error with the valid range\n3. WHEN a command syntax is malformed THEN the parser SHALL return an error with the expected syntax\n4. WHEN an interface name is invalid THEN the parser SHALL return an error with valid interface name patterns\n5. WHEN a command is not supported on the target model THEN the parser SHALL return an error listing supported models\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **Single Responsibility Principle**: Each parser file handles one command category (e.g., `ip_commands.go`, `vlan_commands.go`)\n- **Modular Design**: Parser framework provides base types and utilities; specific parsers implement parsing logic\n- **Dependency Management**: Parsers register themselves with the global registry via `init()` functions\n- **Clear Interfaces**: All parsers implement the `Parser` interface with `Parse()` and `CanHandle()` methods\n- **Command Definition DSL**: Consider a declarative syntax for defining command patterns to reduce boilerplate\n\n### Performance\n\n- Command parsing shall complete within 10ms per command line\n- Parser initialization (all registrations) shall complete within 100ms\n- Memory usage per parser instance shall not exceed 1MB\n\n### Security\n\n- Parser shall not execute any commands; it only parses text\n- Special characters in values shall be properly escaped when generating commands\n- No user-provided input shall be passed directly to SSH without validation\n\n### Reliability\n\n- Parser shall handle malformed input gracefully without panics\n- Parser shall support partial parsing when some values are unknown\n- Unit tests shall cover all documented command patterns\n\n### Usability\n\n- Parser error messages shall include the problematic input and expected format\n- Documentation shall include examples for each command pattern type\n- Parser shall provide debug logging for troubleshooting\n",
  "fileStats": {
    "size": 10083,
    "lines": 160,
    "lastModified": "2026-01-20T12:37:51.808Z"
  },
  "comments": []
}