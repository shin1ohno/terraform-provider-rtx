{
  "id": "snapshot_1769257045565_s6spn2t9e",
  "approvalId": "approval_1769257045561_u6148uqp1",
  "approvalTitle": "Tasks: Terraform Schema Design Patterns (13 tasks)",
  "version": 1,
  "timestamp": "2026-01-24T12:17:25.565Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Terraform Schema Design Patterns\n\n## Phase 1: Core Utilities\n\n- [ ] 1. Create schema helpers module\n  - File: `internal/provider/schema_helpers.go`\n  - Implement WriteOnlyStringSchema function for SDK v2\n  - Implement SensitiveStringSchema function\n  - Add documentation comments explaining SDK v2 limitations\n  - Purpose: Provide reusable schema patterns for sensitive fields\n  - _Leverage: `terraform-plugin-sdk/v2/helper/schema`_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Create schema helper functions for sensitive and write-only fields as specified in design.md | Restrictions: Follow SDK v2 patterns, document limitations vs plugin-framework, return *schema.Schema | Success: Helper functions compile and produce valid schema definitions | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 2. Create DiffSuppressFunc library\n  - File: `internal/provider/diff_suppress.go`\n  - Implement SuppressCaseDiff for case-insensitive comparison\n  - Implement SuppressWhitespaceDiff for whitespace normalization\n  - Implement SuppressJSONDiff for semantic JSON comparison\n  - Implement SuppressEquivalentIPDiff for IP address comparison\n  - Purpose: Provide reusable diff suppression functions\n  - _Leverage: `encoding/json`, `net`, `strings`_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Create DiffSuppressFunc library with all functions specified in design.md | Restrictions: Handle edge cases (nil, empty, invalid input), return false on errors (safe fallback), add documentation | Success: All suppress functions compile and correctly identify equivalent values | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 3. Create StateFunc normalizers\n  - File: `internal/provider/state_funcs.go`\n  - Implement normalizeIPAddress for canonical IP format\n  - Implement normalizeLowercase for case normalization\n  - Implement normalizeJSON for consistent JSON formatting\n  - Purpose: Normalize values before storing in state to prevent diffs\n  - _Leverage: `encoding/json`, `net`, `strings`_\n  - _Requirements: 4, 5_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Create StateFunc normalizer functions as specified in design.md | Restrictions: Handle invalid input gracefully, return input unchanged if normalization fails, document behavior | Success: Normalizers produce consistent canonical output for equivalent inputs | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 2: State Migration Infrastructure\n\n- [ ] 4. Create state upgraders directory structure\n  - File: `internal/provider/state_upgraders/upgraders.go`\n  - Create package with common types and utilities\n  - Implement helper for creating StateUpgrader entries\n  - Add documentation on state migration patterns\n  - Purpose: Establish structure for state version management\n  - _Leverage: `terraform-plugin-sdk/v2/helper/schema`_\n  - _Requirements: 9_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Create state_upgraders package with common utilities | Restrictions: Follow SDK v2 StateUpgrader patterns, document version numbering convention | Success: Package provides reusable utilities for state migration | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 3: Unit Tests\n\n- [ ] 5. Add unit tests for DiffSuppressFunc library\n  - File: `internal/provider/diff_suppress_test.go`\n  - Test each suppress function with equivalent and different values\n  - Test edge cases: nil, empty, invalid format\n  - Use table-driven tests\n  - Purpose: Ensure diff suppression works correctly\n  - _Leverage: `testing`, `testify/assert`_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create comprehensive unit tests for DiffSuppressFunc library | Restrictions: Use table-driven tests, cover edge cases, test both positive and negative cases | Success: All suppress functions have full test coverage, tests document expected behavior | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 6. Add unit tests for StateFunc normalizers\n  - File: `internal/provider/state_funcs_test.go`\n  - Test each normalizer with various input formats\n  - Test invalid input handling\n  - Verify idempotency (normalizing twice produces same result)\n  - Purpose: Ensure normalizers work correctly\n  - _Leverage: `testing`, `testify/assert`_\n  - _Requirements: 4, 5_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create unit tests for StateFunc normalizers | Restrictions: Test idempotency, cover edge cases, verify invalid input handling | Success: All normalizers tested, idempotency verified, edge cases covered | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 4: Reference Implementation\n\n- [ ] 7. Apply WriteOnly pattern to password fields\n  - File: `internal/provider/resource_rtx_admin_user.go`\n  - Update password field to use WriteOnlyStringSchema helper\n  - Ensure Read function does not attempt to read password from router\n  - Verify password is sent during Create/Update but not stored in state\n  - Purpose: Reference implementation of WriteOnly pattern\n  - _Leverage: `internal/provider/schema_helpers.go`_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Apply WriteOnly pattern to password field in rtx_admin_user resource | Restrictions: Do not break existing functionality, ensure password is still sent to router, verify with tests | Success: Password is applied to router but not stored in state | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 8. Apply RequiresReplace to username field\n  - File: `internal/provider/resource_rtx_admin_user.go`\n  - Add ForceNew: true to username field if not already present\n  - Update schema description to indicate immutability\n  - Verify terraform plan shows replacement when username changes\n  - Purpose: Reference implementation of RequiresReplace pattern\n  - _Leverage: Existing schema definition_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Apply RequiresReplace pattern to username field | Restrictions: Only if username is truly immutable on RTX router, update description, verify with test | Success: Changing username triggers resource replacement in plan | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 9. Apply DiffSuppressFunc to appropriate fields\n  - Files: Resource files with fields needing diff suppression\n  - Identify fields that may have equivalent but different representations\n  - Apply appropriate suppress function from library\n  - Document why each suppression is needed\n  - Purpose: Reduce noise in terraform plans\n  - _Leverage: `internal/provider/diff_suppress.go`_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Identify and apply DiffSuppressFunc to fields that need semantic equality | Restrictions: Only apply where truly needed, document rationale, verify with tests | Success: Semantically equivalent values no longer produce diffs | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 5: Documentation\n\n- [ ] 10. Create schema design patterns guide\n  - File: `docs/schema-patterns.md`\n  - Document attribute configurability decision tree\n  - Include examples for each pattern\n  - Add migration notes for plugin-framework\n  - Purpose: Enable developers to choose correct patterns\n  - _Leverage: Design document, code examples_\n  - _Requirements: 1, 6_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Create comprehensive schema design patterns documentation | Restrictions: Use real examples from codebase, include decision trees, keep practical | Success: Documentation helps developers choose correct schema patterns | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 11. Document zero value handling patterns\n  - File: `docs/zero-value-handling.md`\n  - Explain difference between GetOk and Get\n  - Document when to use GetOkExists\n  - Include examples for bool, int, string fields\n  - Purpose: Prevent common mistakes with zero values\n  - _Leverage: Design document section on Zero Value Handling_\n  - _Requirements: 8_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Create documentation for zero value handling patterns | Restrictions: Include practical examples, explain SDK v2 vs Framework differences | Success: Documentation prevents zero value mishandling bugs | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 6: Audit and Expansion\n\n- [ ] 12. Audit all resources for schema pattern compliance\n  - Files: All `internal/provider/resource_*.go`\n  - Check each resource against pattern decision tree\n  - Identify fields needing pattern updates\n  - Create list of required changes\n  - Purpose: Identify gaps in pattern application\n  - _Leverage: Schema patterns documentation_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Code Auditor | Task: Audit all resources for schema pattern compliance | Restrictions: Read-only audit, document findings, prioritize by risk | Success: Complete list of resources and fields needing updates | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 13. Apply patterns to remaining resources\n  - Files: Resources identified in audit\n  - Apply WriteOnly to all credential fields\n  - Apply RequiresReplace to all immutable fields\n  - Apply DiffSuppressFunc where needed\n  - Add StateFunc normalizers where appropriate\n  - Purpose: Achieve consistent patterns across provider\n  - _Leverage: All pattern implementations from previous tasks_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec terraform-schema-design-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Apply all schema patterns to remaining resources | Restrictions: Follow established patterns, verify each change with tests, maintain backward compatibility | Success: All resources follow consistent schema patterns | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n",
  "fileStats": {
    "size": 12958,
    "lines": 146,
    "lastModified": "2026-01-24T12:17:18.807Z"
  },
  "comments": []
}