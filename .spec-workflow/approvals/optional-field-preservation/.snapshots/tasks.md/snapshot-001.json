{
  "id": "snapshot_1769254335000_7hirrdfdv",
  "approvalId": "approval_1769254334995_b10638kvi",
  "approvalTitle": "Tasks: Optional Field Preservation",
  "version": 1,
  "timestamp": "2026-01-24T11:32:15.000Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Optional Field Preservation\n\n## Phase 1: Core Infrastructure\n\n- [ ] 1. Create field tracking helper utilities\n  - File: `internal/provider/field_helpers.go`\n  - Implement helper functions for extracting values from ResourceData with state fallback\n  - Functions: `GetBoolValue`, `GetIntValue`, `GetStringValue`, `GetStringListValue`\n  - Add pointer helper functions: `BoolPtr`, `IntPtr`, `StringPtr`\n  - Purpose: Provide reusable utilities for all resources to handle optional fields consistently\n  - _Leverage: `github.com/hashicorp/terraform-plugin-sdk/v2/helper/schema`_\n  - _Requirements: 1, 3_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer specializing in Terraform Provider SDK | Task: Create field helper utilities in internal/provider/field_helpers.go that extract values from schema.ResourceData with automatic state fallback, following the design patterns in design.md | Restrictions: Do not modify existing files, follow project code conventions from memory, use Zerolog for any logging | Success: All helper functions compile, handle both config and state values correctly, include proper documentation comments | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 2. Update AdminUserAttributes to use pointer types\n  - File: `internal/client/interfaces.go`\n  - Change `Administrator bool` to `Administrator *bool`\n  - Change `LoginTimer int` to `LoginTimer *int`\n  - Keep slice types as-is (nil vs empty is distinguishable)\n  - Purpose: Enable distinguishing between \"not set\" and \"explicitly set to zero/false\"\n  - _Leverage: Existing `AdminUserAttributes` struct_\n  - _Requirements: 1, 2_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer with expertise in type systems | Task: Update AdminUserAttributes struct in internal/client/interfaces.go to use pointer types for bool and int fields as specified in design.md | Restrictions: Only modify the specified struct, maintain JSON tags with omitempty, do not change slice fields | Success: Struct compiles, pointer types allow nil detection, JSON serialization works correctly | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 2: Command Builder Updates\n\n- [ ] 3. Update BuildUserAttributeCommand for pointer types\n  - File: `internal/rtx/parsers/admin.go`\n  - Modify function to handle `*bool` and `*int` types\n  - Only include attributes in command when pointer is non-nil\n  - Purpose: Generate RTX commands that only include explicitly set fields\n  - _Leverage: Existing `BuildUserAttributeCommand` function_\n  - _Requirements: 1, 3_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer with RTX router expertise | Task: Update BuildUserAttributeCommand in internal/rtx/parsers/admin.go to handle pointer types, only including attributes when non-nil as specified in design.md | Restrictions: Maintain existing command format, handle nil gracefully, do not change function signature unnecessarily | Success: Command builder correctly handles nil pointers, generates valid RTX commands, existing tests pass after update | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 4. Update UserAttributes struct in parsers package\n  - File: `internal/rtx/parsers/admin.go`\n  - Change corresponding fields to pointer types to match client.AdminUserAttributes\n  - Update toParserUser/fromParserUser conversion functions in admin_service.go\n  - Purpose: Maintain consistency between client and parser types\n  - _Leverage: Existing `UserAttributes` struct, `toParserUser`, `fromParserUser` functions_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Update UserAttributes struct in internal/rtx/parsers/admin.go to use pointer types, and update conversion functions in internal/client/admin_service.go | Restrictions: Maintain consistency between client and parser types, ensure bidirectional conversion works | Success: Both structs use compatible types, conversion functions handle nil correctly | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 3: Resource Layer Updates\n\n- [ ] 5. Update rtx_admin_user resource schema\n  - File: `internal/provider/resource_rtx_admin_user.go` (if exists) or appropriate resource file\n  - Add `Computed: true` to optional fields that need preservation\n  - Ensure schema allows reading values back from router\n  - Purpose: Enable Terraform to track current router values for merge\n  - _Leverage: Existing resource schema patterns_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Update resource schema to add Computed: true to optional fields as specified in design.md, search for admin user resource files first | Restrictions: Only add Computed flag, do not change Required/Optional settings, maintain existing descriptions | Success: Schema allows both user input and computed values, terraform plan shows correct diffs | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 6. Update resource Create function to use field helpers\n  - File: Resource file for admin user (find in internal/provider/)\n  - Use new field helper functions to build AdminUserAttributes\n  - Pass complete attribute set to CreateAdminUser\n  - Purpose: Apply new pattern to resource creation\n  - _Leverage: `internal/provider/field_helpers.go`, existing Create function_\n  - _Requirements: 2, 3_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Update resource Create function to use field helpers for building AdminUserAttributes, ensuring all fields are properly handled | Restrictions: Follow existing error handling patterns, use Zerolog for logging, do not change function signature | Success: Create function uses field helpers, passes complete attributes to client, handles errors correctly | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 7. Update resource Update function for state-based merge\n  - File: Resource file for admin user\n  - Use d.Get() to obtain merged values (config or state)\n  - Build complete AdminUserAttributes with all fields\n  - Send full configuration to router\n  - Purpose: Implement the core Read-Merge-Write pattern\n  - _Leverage: `internal/provider/field_helpers.go`, existing Update function_\n  - _Requirements: 1, 3_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Update resource Update function to implement Read-Merge-Write pattern as specified in design.md, using d.Get() for merged values | Restrictions: Do not add extra router API calls, use existing state values, maintain error handling | Success: Update function sends complete config to router, unspecified fields preserve current values | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 8. Update resource Read function for complete state\n  - File: Resource file for admin user\n  - Ensure Read function populates all attribute fields in state\n  - Handle nil values from router appropriately\n  - Purpose: Ensure state contains current values for merge during Update\n  - _Leverage: Existing Read function, parser output_\n  - _Requirements: 1_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Update resource Read function to populate all attribute fields in Terraform state from router values | Restrictions: Handle nil/missing values gracefully, do not modify router, use existing parser | Success: Read populates all fields, state reflects actual router configuration | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 4: Testing\n\n- [ ] 9. Add unit tests for field helpers\n  - File: `internal/provider/field_helpers_test.go`\n  - Test each helper function with: value in config, value only in state, zero values\n  - Test pointer helper functions\n  - Purpose: Ensure field helpers work correctly for all scenarios\n  - _Leverage: Standard Go testing, testify if available_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create comprehensive unit tests for field helper functions in internal/provider/field_helpers_test.go | Restrictions: Test all edge cases, use table-driven tests, do not require external dependencies | Success: All helper functions tested, edge cases covered, tests pass | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 10. Add unit tests for command builder changes\n  - File: `internal/rtx/parsers/admin_test.go`\n  - Test BuildUserAttributeCommand with nil pointers\n  - Test with mix of set and unset fields\n  - Test complete attribute set\n  - Purpose: Verify command generation handles pointer types correctly\n  - _Leverage: Existing test patterns in parsers package_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Add or update tests for BuildUserAttributeCommand to cover pointer type handling | Restrictions: Follow existing test patterns, test nil handling, ensure backward compatibility | Success: All command builder scenarios tested, nil handling verified | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 11. Add integration test for administrator preservation\n  - File: `internal/provider/resource_rtx_admin_user_test.go` or appropriate test file\n  - Test scenario: Create user with administrator=true, update without specifying administrator\n  - Verify administrator privilege is preserved (not reset to false)\n  - Purpose: Regression test for the original lockout scenario\n  - _Leverage: Existing acceptance test patterns_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Test Developer | Task: Create integration test that verifies administrator privilege is preserved when not specified in update | Restrictions: May require TF_ACC flag, use existing test helpers, clean up test resources | Success: Test verifies preservation behavior, catches regression if pattern breaks | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 5: Documentation and Audit\n\n- [ ] 12. Audit all resources for optional field issues\n  - Files: All files in `internal/provider/resource_*.go`\n  - Identify resources with optional fields using same problematic pattern\n  - Document which resources need updates\n  - Purpose: Ensure complete coverage of the fix across all resources\n  - _Leverage: grep/search tools, existing resource files_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Code Auditor | Task: Search all resource files for optional fields that may have the same preservation issue, document findings | Restrictions: Read-only audit, do not modify files, create comprehensive list | Success: All affected resources identified, documented with specific fields | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts including list of affected resources, then mark as [x] when done_\n\n- [ ] 13. Apply pattern to remaining affected resources\n  - Files: Resources identified in task 12\n  - Apply same field helper and schema pattern to each resource\n  - Update corresponding parsers and client code as needed\n  - Purpose: Complete the fix across the entire provider\n  - _Leverage: Patterns established in tasks 1-8_\n  - _Requirements: 3, 5_\n  - _Prompt: Implement the task for spec optional-field-preservation, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Apply optional field preservation pattern to all remaining resources identified in the audit | Restrictions: Follow established patterns, one resource at a time, verify each works | Success: All resources updated, consistent pattern across provider | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n",
  "fileStats": {
    "size": 14292,
    "lines": 133,
    "lastModified": "2026-01-24T11:32:10.367Z"
  },
  "comments": []
}