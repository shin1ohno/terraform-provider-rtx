{
  "id": "snapshot_1768915870780_8iltfrtbm",
  "approvalId": "approval_1768915857744_v2g6chgwu",
  "approvalTitle": "Design: Parser Edge Case Tests",
  "version": 2,
  "timestamp": "2026-01-20T13:31:10.780Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Design Document: Parser Edge Case Tests\n\n## Overview\n\nThis feature adds comprehensive edge case tests to four high-priority parsers (IPsec, OSPF, NAT, BGP) that currently have functional coverage but lack exhaustive parameter combination testing. The design follows the established pattern-driven testing methodology.\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n- Follow Go's table-driven test pattern consistently\n- Reference YAML pattern catalogs for test case generation\n- Maintain test independence (no shared state)\n\n### Project Structure (structure.md)\n- Tests located in `internal/rtx/parsers/*_test.go`\n- Pattern catalogs in `internal/rtx/testdata/patterns/*.yaml`\n- Fixtures in `internal/rtx/testdata/fixtures/*/`\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n- **Existing test files**: Extend `ipsec_tunnel_test.go`, `ospf_test.go`, `nat_masquerade_test.go`, `bgp_test.go`\n- **Pattern catalogs**: Reference `ipsec.yaml`, `ospf.yaml`, `nat.yaml`, `bgp.yaml`\n- **Test helpers**: Use existing assertion patterns and test utilities\n\n### Integration Points\n- **YAML pattern catalogs**: Tests will reference specific pattern entries\n- **Existing test infrastructure**: Use same test setup/teardown patterns\n\n## Architecture\n\n```mermaid\ngraph TD\n    A[Pattern Catalog YAML] --> B[Test Case Definition]\n    B --> C[Table-Driven Test]\n    C --> D[Parser Function]\n    D --> E[Assertion/Validation]\n    E --> F[Coverage Report]\n```\n\n## Components and Interfaces\n\n### Component 1: IPsec Edge Case Tests\n- **Purpose:** Test all encryption/authentication algorithm combinations\n- **File:** `internal/rtx/parsers/ipsec_tunnel_test.go`\n- **Test Functions:**\n  - `TestParseIPsecEncryptionAlgorithms` - All encryption variants\n  - `TestParseIPsecHashAlgorithms` - All hash algorithm variants\n  - `TestParseIPsecIKEVersions` - IKEv1/IKEv2 configurations\n  - `TestParseIPsecNATTraversal` - NAT-T options\n  - `TestParseIPsecAuthentication` - PSK, certificate, XAUTH\n- **Reuses:** Existing `TestParseIPsecTunnel*` patterns\n\n### Component 2: OSPF Edge Case Tests\n- **Purpose:** Test all area types and authentication options\n- **File:** `internal/rtx/parsers/ospf_test.go`\n- **Test Functions:**\n  - `TestParseOSPFAreaTypes` - Normal, stub, NSSA, totally stubby\n  - `TestParseOSPFAuthentication` - None, simple, MD5\n  - `TestParseOSPFRedistribution` - Static, connected, with metrics\n  - `TestParseOSPFInterfaceSettings` - Cost, priority, timers\n- **Reuses:** Existing `TestParseOSPF*` patterns\n\n### Component 3: NAT Edge Case Tests\n- **Purpose:** Test all NAT types and port mapping variations\n- **File:** `internal/rtx/parsers/nat_masquerade_test.go`\n- **Test Functions:**\n  - `TestParseNATPortRanges` - Single port, port ranges\n  - `TestParseNATProtocols` - TCP, UDP, ICMP, any\n  - `TestParseNATDynamic` - Pool configurations\n  - `TestParseNATStaticEdgeCases` - 1:1 mapping variants\n- **Reuses:** Existing `TestParseNAT*` patterns\n\n### Component 4: BGP Edge Case Tests\n- **Purpose:** Test route-map, ASN, and community configurations\n- **File:** `internal/rtx/parsers/bgp_test.go`\n- **Test Functions:**\n  - `TestParseBGPRouteMap` - In/out route-maps\n  - `TestParseBGP4ByteASN` - asdot/asplain notation\n  - `TestParseBGPCommunity` - Standard, well-known, extended\n  - `TestParseBGPNeighborAdvanced` - Multihop, timers, passwords\n- **Reuses:** Existing `TestParseBGP*` patterns\n\n## Data Models\n\n### Test Case Structure\n```go\ntype EdgeCaseTest struct {\n    Name           string   // Descriptive test name\n    Input          string   // RTX command string\n    Expected       any      // Expected parsed result\n    PatternRef     string   // Reference to YAML pattern entry\n    DocRef         string   // RTX documentation reference\n}\n```\n\n### Pattern Catalog Entry Addition\n```yaml\nedge_cases:\n  - name: encryption_aes_gcm_256\n    input: \"ipsec ike encryption 1 aes-gcm-256\"\n    expected:\n      tunnel_id: 1\n      algorithm: \"aes-gcm-256\"\n    doc_ref: \"Chapter 15, ipsec ike encryption\"\n```\n\n## Error Handling\n\n### Error Scenarios\n1. **Invalid algorithm name:**\n   - **Handling:** Parser returns error with invalid algorithm message\n   - **Test Impact:** Verify error message content and type\n\n2. **Out-of-range numeric values:**\n   - **Handling:** Parser returns validation error\n   - **Test Impact:** Test boundary values (min-1, min, max, max+1)\n\n## Testing Strategy\n\n### Unit Testing\n- Each edge case is an independent table-driven test entry\n- Tests grouped by feature area within test functions\n- Subtests use descriptive names referencing the edge case\n\n### Coverage Metrics\n| Parser | Current Tests | Target Tests | Edge Cases Added |\n|--------|--------------|--------------|------------------|\n| ipsec_tunnel | 11 | 31 | ~20 |\n| ospf | 19 | 34 | ~15 |\n| nat_masquerade | 26 | 41 | ~15 |\n| bgp | 31 | 41 | ~10 |\n\n### Test Naming Convention\n```\nTestParse{Feature}{Category}/{specific_edge_case}\n```\nExample: `TestParseIPsecEncryptionAlgorithms/aes_gcm_256_mode`\n",
  "fileStats": {
    "size": 4996,
    "lines": 139,
    "lastModified": "2026-01-20T13:30:48.069Z"
  },
  "comments": []
}