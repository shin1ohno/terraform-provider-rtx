{
  "id": "snapshot_1768892085817_lu4el9f9u",
  "approvalId": "approval_1768892023271_t3suti8i3",
  "approvalTitle": "Tasks: Security and Filter Resources",
  "version": 2,
  "timestamp": "2026-01-20T06:54:45.817Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document: Security and Filter Resources\n\n## Summary\n\nImplementation of 4 new Terraform resources for RTX router security and filter management:\n- `rtx_access_list_ip` - Static IP filters\n- `rtx_access_list_ipv6` - Static IPv6 filters\n- `rtx_l2tp_service` - L2TP service on/off\n- `rtx_ipsec_transport` - IPsec transport mode mappings\n\n---\n\n## Phase 1: rtx_access_list_ip Resource\n\n- [ ] 1.1. Extend IP filter parser for static filters\n  - File: `internal/rtx/parsers/ip_filter.go`\n  - Add parsing support for static `ip filter N action src dst proto sport dport` commands\n  - Verify `BuildIPFilterCommand` and `BuildDeleteIPFilterCommand` work correctly\n  - Add unit tests for new parsing scenarios\n  - Purpose: Enable reading/writing static IP filter configurations\n  - _Leverage: Existing `IPFilter` struct and `ParseIPFilterConfig` function_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer specializing in parser implementations | Task: Extend internal/rtx/parsers/ip_filter.go to support static IP filter parsing per REQ-1, verify existing BuildIPFilterCommand works for create/delete | Restrictions: Do not modify existing IPFilter struct fields unless necessary, maintain backward compatibility with dynamic filter parsing | Success: Static IP filters parse correctly, commands generate valid RTX CLI syntax, unit tests pass | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 1.2. Extend IP filter service for static filter CRUD\n  - File: `internal/client/ip_filter_service.go`\n  - Add `CreateIPFilter`, `GetIPFilter`, `UpdateIPFilter`, `DeleteIPFilter` methods\n  - Implement import support via `GetIPFilterByNumber`\n  - Purpose: Provide client-side CRUD operations for static IP filters\n  - _Leverage: Existing service patterns in `internal/client/`_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer with SSH client experience | Task: Extend internal/client/ip_filter_service.go with CRUD methods for static IP filters per REQ-1, following existing service patterns | Restrictions: Use existing SSH session management, follow error handling patterns | Success: CRUD operations work via SSH, proper error handling, methods follow existing patterns | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 1.3. Create rtx_access_list_ip resource\n  - File: `internal/provider/resource_rtx_access_list_ip.go`\n  - Implement full resource with Create, Read, Update, Delete, Import\n  - Define schema matching design.md specification\n  - Purpose: Terraform resource for managing static IP filters\n  - _Leverage: `resource_rtx_ip_filter_dynamic.go` as pattern_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Create internal/provider/resource_rtx_access_list_ip.go implementing full CRUD and import per REQ-1, following patterns from resource_rtx_ip_filter_dynamic.go | Restrictions: Follow terraform-plugin-sdk/v2 patterns, maintain consistency with existing resources | Success: Resource compiles, schema matches design.md, CRUD operations work correctly | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 1.4. Add unit tests for rtx_access_list_ip\n  - File: `internal/provider/resource_rtx_access_list_ip_test.go`\n  - Test schema validation, CRUD operations with mocked client\n  - Purpose: Ensure resource reliability\n  - _Leverage: Existing test patterns in `internal/provider/*_test.go`_\n  - _Requirements: REQ-1_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create unit tests for rtx_access_list_ip resource covering schema validation and CRUD with mocked dependencies | Restrictions: Use testify for assertions, mock external dependencies | Success: Tests pass, good coverage of success and error scenarios | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n---\n\n## Phase 2: rtx_access_list_ipv6 Resource\n\n- [ ] 2.1. Verify IPv6 filter parser support\n  - File: `internal/rtx/parsers/ip_filter.go`\n  - Confirm `ParseIPv6FilterConfig`, `BuildIPv6FilterCommand`, `BuildDeleteIPv6FilterCommand` work\n  - Add any missing parsing scenarios for static IPv6 filters\n  - Purpose: Ensure IPv6 filter parsing is complete\n  - _Leverage: Existing IPv6 functions in ip_filter.go_\n  - _Requirements: REQ-3_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Verify and extend IPv6 filter parsing in internal/rtx/parsers/ip_filter.go per REQ-3, add tests for static IPv6 filter scenarios | Restrictions: Maintain consistency with IPv4 filter patterns | Success: IPv6 static filters parse correctly, commands generate valid syntax | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 2.2. Extend IP filter service for IPv6 static filter CRUD\n  - File: `internal/client/ip_filter_service.go`\n  - Add `CreateIPv6Filter`, `GetIPv6Filter`, `UpdateIPv6Filter`, `DeleteIPv6Filter` methods\n  - Purpose: Client-side CRUD for static IPv6 filters\n  - _Leverage: IPv4 static filter methods from task 1.2_\n  - _Requirements: REQ-3_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Add IPv6 static filter CRUD methods to ip_filter_service.go per REQ-3, following IPv4 patterns from task 1.2 | Restrictions: Maintain consistent error handling with IPv4 methods | Success: IPv6 CRUD operations work correctly | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 2.3. Create rtx_access_list_ipv6 resource\n  - File: `internal/provider/resource_rtx_access_list_ipv6.go`\n  - Implement full resource with Create, Read, Update, Delete, Import\n  - Schema for IPv6-specific attributes (icmp6 protocol, etc.)\n  - Purpose: Terraform resource for managing static IPv6 filters\n  - _Leverage: `resource_rtx_access_list_ip.go` from task 1.3_\n  - _Requirements: REQ-3_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Create internal/provider/resource_rtx_access_list_ipv6.go per REQ-3, based on rtx_access_list_ip patterns | Restrictions: Handle IPv6-specific protocols like icmp6 | Success: Resource compiles, handles IPv6 specifics correctly | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 2.4. Add unit tests for rtx_access_list_ipv6\n  - File: `internal/provider/resource_rtx_access_list_ipv6_test.go`\n  - Test IPv6-specific scenarios (icmp6, IPv6 addresses)\n  - Purpose: Ensure IPv6 resource reliability\n  - _Leverage: rtx_access_list_ip tests from task 1.4_\n  - _Requirements: REQ-3_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create unit tests for rtx_access_list_ipv6 resource with IPv6-specific test cases | Restrictions: Cover IPv6-specific edge cases | Success: Tests pass, IPv6 specifics are well tested | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n---\n\n## Phase 3: rtx_l2tp_service Resource\n\n- [ ] 3.1. Extend L2TP parser for service on/off\n  - File: `internal/rtx/parsers/l2tp.go`\n  - Add `L2TPService` struct with `Enabled` and `Protocols` fields\n  - Add `ParseL2TPServiceConfig` function to parse `l2tp service on/off` output\n  - Verify `BuildL2TPServiceCommand` generates correct syntax\n  - Purpose: Enable parsing L2TP service state\n  - _Leverage: Existing `L2TPParser` and `BuildL2TPServiceCommand`_\n  - _Requirements: REQ-6_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Extend internal/rtx/parsers/l2tp.go with L2TPService struct and ParseL2TPServiceConfig per REQ-6 | Restrictions: Do not break existing L2TP tunnel parsing | Success: L2TP service state parses correctly, commands generate valid syntax | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 3.2. Extend L2TP service for service CRUD\n  - File: `internal/client/l2tp_service.go`\n  - Add `EnableL2TPService`, `DisableL2TPService`, `GetL2TPServiceState` methods\n  - Purpose: Client-side operations for L2TP service management\n  - _Leverage: Existing L2TP service patterns_\n  - _Requirements: REQ-6_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Add L2TP service state methods to l2tp_service.go per REQ-6 | Restrictions: Handle singleton nature of service resource | Success: Service enable/disable works correctly | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 3.3. Create rtx_l2tp_service resource\n  - File: `internal/provider/resource_rtx_l2tp_service.go`\n  - Implement singleton resource (only one instance per router)\n  - Schema: `enabled` (bool), `protocols` (list of strings)\n  - Import ID: \"default\"\n  - Purpose: Terraform resource for L2TP service configuration\n  - _Leverage: Singleton resource patterns_\n  - _Requirements: REQ-6_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Create internal/provider/resource_rtx_l2tp_service.go as singleton resource per REQ-6 | Restrictions: Handle singleton semantics (only one instance), use \"default\" as import ID | Success: Resource works as singleton, enables/disables L2TP service correctly | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 3.4. Add unit tests for rtx_l2tp_service\n  - File: `internal/provider/resource_rtx_l2tp_service_test.go`\n  - Test singleton behavior, enable/disable scenarios\n  - Purpose: Ensure L2TP service resource reliability\n  - _Leverage: Existing resource test patterns_\n  - _Requirements: REQ-6_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create unit tests for rtx_l2tp_service singleton resource | Restrictions: Test singleton semantics properly | Success: Tests pass, singleton behavior verified | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n---\n\n## Phase 4: rtx_ipsec_transport Resource\n\n- [ ] 4.1. Create IPsec transport parser\n  - File: `internal/rtx/parsers/ipsec_transport.go`\n  - Create `IPsecTransport` struct with `TransportID`, `TunnelID`, `Protocol`, `Port`\n  - Implement `ParseIPsecTransportConfig` to parse `ipsec transport N tunnel proto port`\n  - Implement `BuildIPsecTransportCommand` and `BuildDeleteIPsecTransportCommand`\n  - Add unit tests\n  - Purpose: Parser for IPsec transport mode configurations\n  - _Leverage: `parsers/ipsec_tunnel.go` as reference_\n  - _Requirements: REQ-7_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Create internal/rtx/parsers/ipsec_transport.go with parser and command builders per REQ-7, following patterns from ipsec_tunnel.go | Restrictions: Follow existing parser patterns, register in parser registry | Success: Parser works correctly, commands generate valid syntax, unit tests pass | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 4.2. Create IPsec transport service\n  - File: `internal/client/ipsec_transport_service.go`\n  - Implement `CreateIPsecTransport`, `GetIPsecTransport`, `UpdateIPsecTransport`, `DeleteIPsecTransport`\n  - Purpose: Client-side CRUD for IPsec transport mappings\n  - _Leverage: Existing service patterns_\n  - _Requirements: REQ-7_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Create internal/client/ipsec_transport_service.go with CRUD methods per REQ-7 | Restrictions: Follow existing service patterns, proper error handling | Success: CRUD operations work correctly | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 4.3. Create rtx_ipsec_transport resource\n  - File: `internal/provider/resource_rtx_ipsec_transport.go`\n  - Implement full resource with Create, Read, Update, Delete, Import\n  - Schema: `transport_id`, `tunnel_id`, `protocol`, `port`\n  - Purpose: Terraform resource for IPsec transport mode mappings\n  - _Leverage: Existing resource patterns_\n  - _Requirements: REQ-7_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Create internal/provider/resource_rtx_ipsec_transport.go per REQ-7 | Restrictions: Validate tunnel_id references existing tunnel | Success: Resource compiles, CRUD works correctly | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 4.4. Add unit tests for rtx_ipsec_transport\n  - File: `internal/provider/resource_rtx_ipsec_transport_test.go`\n  - Test CRUD operations, validation\n  - Purpose: Ensure IPsec transport resource reliability\n  - _Leverage: Existing resource test patterns_\n  - _Requirements: REQ-7_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create unit tests for rtx_ipsec_transport resource | Restrictions: Mock external dependencies | Success: Tests pass with good coverage | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n---\n\n## Phase 5: Integration\n\n- [ ] 5.1. Register new resources in provider\n  - File: `internal/provider/provider.go`\n  - Add `rtx_access_list_ip`, `rtx_access_list_ipv6`, `rtx_l2tp_service`, `rtx_ipsec_transport` to ResourcesMap\n  - Purpose: Make resources available in Terraform\n  - _Leverage: Existing provider registration pattern_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Developer | Task: Register all 4 new resources in internal/provider/provider.go ResourcesMap | Restrictions: Maintain alphabetical ordering | Success: Provider compiles, resources are accessible | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 5.2. Run full test suite and fix issues\n  - Run `go test ./...` and fix any failures\n  - Run `go build` to verify compilation\n  - Purpose: Ensure all components work together\n  - _Leverage: Existing test infrastructure_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Run full test suite and build, fix any failures | Restrictions: Do not skip failing tests | Success: All tests pass, build succeeds | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n\n- [ ] 5.3. Update documentation\n  - Add example configurations to `examples/` directory\n  - Update any relevant documentation\n  - Purpose: Provide usage examples for new resources\n  - _Leverage: Existing example patterns_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec security-filter-resources, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Create example Terraform configurations for all 4 new resources in examples/ directory | Restrictions: Follow existing example patterns | Success: Examples are clear and functional | After completion: Mark task as [-] in-progress before starting, use log-implementation tool to record artifacts, then mark as [x] complete_\n",
  "fileStats": {
    "size": 17879,
    "lines": 196,
    "lastModified": "2026-01-20T06:53:35.925Z"
  },
  "comments": []
}