{
  "id": "snapshot_1769135858247_85jq59l8d",
  "approvalId": "approval_1769135858161_wkrzvw9md",
  "approvalTitle": "Terraform Plan Differences Fix - 4 Differences Analysis and Fix Plan",
  "version": 1,
  "timestamp": "2026-01-23T02:37:38.247Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements: Terraform Plan Differences Fix\n\n## Overview\n\nThis specification addresses the 4 remaining differences identified during `terraform plan` execution in the `examples/import` directory. These differences must be resolved to achieve a clean `terraform plan` with no changes.\n\n## Detected Differences\n\n### Difference 1: rtx_dhcp_scope.scope1 - Network Forces Replacement\n\n**Status:** Must be replaced (forces replacement)\n\n**Terraform Plan Output:**\n```hcl\n-/+ resource \"rtx_dhcp_scope\" \"scope1\" {\n      ~ id          = \"1\" -> (known after apply)\n      + network     = \"192.168.0.0/16\" # forces replacement\n      + range_end   = (known after apply)\n      + range_start = (known after apply)\n        # (1 unchanged attribute hidden)\n\n      ~ options {\n          - dns_servers = [] -> null\n            # (2 unchanged attributes hidden)\n        }\n    }\n```\n\n**Current State:**\n```hcl\nresource \"rtx_dhcp_scope\" \"scope1\" {\n    id          = \"1\"\n    lease_time  = null\n    network     = null\n    range_end   = null\n    range_start = null\n    scope_id    = 1\n\n    options {\n        dns_servers = []\n        domain_name = null\n        routers     = [\"192.168.1.253\"]\n    }\n}\n```\n\n**1-a. RTX Command (Source):**\n```\ndhcp scope 1 192.168.1.20-192.168.1.99/16 gateway 192.168.1.253 expire 12:00 maxexpire 24:00\ndhcp scope option 1 router=192.168.1.253\n```\n\n**1-b. Expected main.tf:**\n```hcl\nresource \"rtx_dhcp_scope\" \"scope1\" {\n  scope_id = 1\n  network  = \"192.168.0.0/16\"\n  # lease_time not imported - provider read limitation\n\n  options {\n    routers = [\"192.168.1.253\"]\n  }\n}\n```\n\n---\n\n### Difference 2: rtx_ipv6_filter_dynamic.main - Will Be Created\n\n**Status:** Will be created (resource not in state)\n\n**Terraform Plan Output:**\n```hcl\n+ resource \"rtx_ipv6_filter_dynamic\" \"main\" {\n      + id = (known after apply)\n\n      + entry {\n          + destination = \"*\"\n          + number      = 101080\n          + protocol    = \"ftp\"\n          + source      = \"*\"\n          + syslog      = false\n        }\n      + entry {\n          + destination = \"*\"\n          + number      = 101081\n          + protocol    = \"domain\"\n          + source      = \"*\"\n          + syslog      = false\n        }\n      # ... 6 more entries (101082-101099)\n    }\n```\n\n**Current State:** No state (resource never imported)\n\n**1-a. RTX Command (Source):**\n```\nipv6 filter dynamic 101080 * * ftp syslog=off\nipv6 filter dynamic 101081 * * domain syslog=off\nipv6 filter dynamic 101082 * * www syslog=off\nipv6 filter dynamic 101083 * * smtp syslog=off\nipv6 filter dynamic 101084 * * pop3 syslog=off\nipv6 filter dynamic 101085 * * submission syslog=off\nipv6 filter dynamic 101098 * * tcp syslog=off\nipv6 filter dynamic 101099 * * udp syslog=off\n```\n\n**1-b. Expected main.tf:**\n```hcl\nresource \"rtx_ipv6_filter_dynamic\" \"main\" {\n  entry {\n    number      = 101080\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"ftp\"\n    syslog      = false\n  }\n\n  entry {\n    number      = 101081\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"domain\"\n    syslog      = false\n  }\n\n  entry {\n    number      = 101082\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"www\"\n    syslog      = false\n  }\n\n  entry {\n    number      = 101083\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"smtp\"\n    syslog      = false\n  }\n\n  entry {\n    number      = 101084\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"pop3\"\n    syslog      = false\n  }\n\n  entry {\n    number      = 101085\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"submission\"\n    syslog      = false\n  }\n\n  entry {\n    number      = 101098\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"tcp\"\n    syslog      = false\n  }\n\n  entry {\n    number      = 101099\n    source      = \"*\"\n    destination = \"*\"\n    protocol    = \"udp\"\n    syslog      = false\n  }\n}\n```\n\n---\n\n### Difference 3: rtx_l2tp.tunnel1 - tunnel_auth_enabled Mismatch\n\n**Status:** Will be updated in-place\n\n**Terraform Plan Output:**\n```hcl\n~ resource \"rtx_l2tp\" \"tunnel1\" {\n        id                 = \"1\"\n        name               = \"ebisu-RTX1210\"\n        # (13 unchanged attributes hidden)\n\n      ~ l2tpv3_config {\n          ~ tunnel_auth_enabled  = true -> false\n          - tunnel_auth_password = (sensitive value) -> null\n            # (6 unchanged attributes hidden)\n        }\n\n        # (1 unchanged block hidden)\n    }\n```\n\n**Current State:**\n```hcl\nresource \"rtx_l2tp\" \"tunnel1\" {\n    # ... other attributes ...\n    l2tpv3_config {\n        tunnel_auth_enabled  = true\n        tunnel_auth_password = (sensitive value)\n        local_router_id      = \"192.168.1.253\"\n        remote_router_id     = \"192.168.1.254\"\n        remote_end_id        = \"shin1\"\n        # ...\n    }\n}\n```\n\n**1-a. RTX Command (Source):**\nBased on the state showing `tunnel_auth_enabled = true`, the RTX configuration likely includes:\n```\nl2tp tunnel 1 auth on\nl2tp tunnel 1 auth password <password>\n```\n\n**1-b. Expected main.tf:**\n```hcl\nresource \"rtx_l2tp\" \"tunnel1\" {\n  tunnel_id          = 1\n  name               = \"ebisu-RTX1210\"\n  version            = \"l2tpv3\"\n  mode               = \"l2vpn\"\n  tunnel_destination = \"itm.ohno.be\"\n  tunnel_dest_type   = \"fqdn\"\n  always_on          = true\n  keepalive_enabled  = true\n  keepalive_interval = 60\n  keepalive_retry    = 3\n  disconnect_time    = 0\n\n  l2tpv3_config {\n    local_router_id     = \"192.168.1.253\"\n    remote_router_id    = \"192.168.1.254\"\n    remote_end_id       = \"shin1\"\n    tunnel_auth_enabled = false  # <-- This is the source of the difference\n  }\n\n  ipsec_profile {\n    enabled   = true\n    tunnel_id = 101\n  }\n}\n```\n\n---\n\n### Difference 4: rtx_nat_masquerade.nat1000 - Will Be Created\n\n**Status:** Will be created (resource not in state)\n\n**Terraform Plan Output:**\n```hcl\n+ resource \"rtx_nat_masquerade\" \"nat1000\" {\n      + descriptor_id = 1000\n      + id            = (known after apply)\n      + outer_address = \"primary\"\n\n      + static_entry {\n          + entry_number        = 2\n          + inside_local        = \"192.168.1.253\"\n          + inside_local_port   = 500\n          + outside_global      = \"primary\"\n          + outside_global_port = 500\n          + protocol            = \"udp\"\n        }\n      # ... more static_entry blocks (3, 4, 900)\n    }\n```\n\n**Current State:** No state (resource never imported)\n\n**1-a. RTX Command (Source):**\nBased on interface configuration referencing `nat descriptor 1000`:\n```\nnat descriptor type 1000 masquerade\nnat descriptor address outer 1000 primary\nnat descriptor masquerade static 1000 1 192.168.1.253 esp\nnat descriptor masquerade static 1000 2 192.168.1.253 udp 500\nnat descriptor masquerade static 1000 3 192.168.1.253 udp 4500\nnat descriptor masquerade static 1000 4 192.168.1.253 udp 1701\nnat descriptor masquerade static 1000 900 192.168.1.20 tcp 55000\n```\n\n**1-b. Expected main.tf:**\n```hcl\nresource \"rtx_nat_masquerade\" \"nat1000\" {\n  descriptor_id = 1000\n  outer_address = \"primary\"\n\n  # Note: Entry 1 (ESP protocol) cannot be expressed with current schema\n  # nat descriptor masquerade static 1000 1 192.168.1.253 esp\n\n  static_entry {\n    entry_number        = 2\n    inside_local        = \"192.168.1.253\"\n    inside_local_port   = 500\n    outside_global      = \"primary\"\n    outside_global_port = 500\n    protocol            = \"udp\"\n  }\n\n  static_entry {\n    entry_number        = 3\n    inside_local        = \"192.168.1.253\"\n    inside_local_port   = 4500\n    outside_global      = \"primary\"\n    outside_global_port = 4500\n    protocol            = \"udp\"\n  }\n\n  static_entry {\n    entry_number        = 4\n    inside_local        = \"192.168.1.253\"\n    inside_local_port   = 1701\n    outside_global      = \"primary\"\n    outside_global_port = 1701\n    protocol            = \"udp\"\n  }\n\n  static_entry {\n    entry_number        = 900\n    inside_local        = \"192.168.1.20\"\n    inside_local_port   = 55000\n    outside_global      = \"primary\"\n    outside_global_port = 55000\n    protocol            = \"tcp\"\n  }\n}\n```\n\n---\n\n## Root Cause Analysis Summary\n\n| Resource | Issue Type | Root Cause |\n|----------|------------|------------|\n| rtx_dhcp_scope.scope1 | Provider Import Bug | Import function doesn't capture `network` field |\n| rtx_ipv6_filter_dynamic.main | Missing Import | Resource never imported to state |\n| rtx_l2tp.tunnel1 | Configuration Mismatch | main.tf doesn't match actual RTX config |\n| rtx_nat_masquerade.nat1000 | Missing Import | Resource never imported to state |\n\n---\n\n## Acceptance Criteria\n\n### AC-1: DHCP Scope Network Field\n- [ ] After import, `network` field should be populated with correct CIDR notation\n- [ ] `terraform plan` shows no changes for rtx_dhcp_scope.scope1\n\n### AC-2: IPv6 Dynamic Filter Import\n- [ ] `terraform import rtx_ipv6_filter_dynamic.main main` succeeds\n- [ ] Imported state matches the RTX configuration\n- [ ] `terraform plan` shows no changes for rtx_ipv6_filter_dynamic.main\n\n### AC-3: L2TP Tunnel Auth Configuration\n- [ ] main.tf is updated to match actual RTX configuration OR\n- [ ] RTX configuration is intentionally changed via terraform apply\n- [ ] `terraform plan` shows no changes for rtx_l2tp.tunnel1\n\n### AC-4: NAT Masquerade Import\n- [ ] `terraform import rtx_nat_masquerade.nat1000 1000` succeeds\n- [ ] Imported state matches the RTX configuration\n- [ ] `terraform plan` shows no changes for rtx_nat_masquerade.nat1000\n\n### AC-5: Overall\n- [ ] Running `terraform plan -parallelism=2` shows \"No changes. Your infrastructure matches the configuration.\"\n",
  "fileStats": {
    "size": 9500,
    "lines": 374,
    "lastModified": "2026-01-23T00:32:49.916Z"
  },
  "comments": []
}