{
  "id": "snapshot_1769257045124_grm4tn0vv",
  "approvalId": "approval_1769257045120_fvv9mtu54",
  "approvalTitle": "Tasks: Terraform Provider Testing Patterns (13 tasks)",
  "version": 1,
  "timestamp": "2026-01-24T12:17:25.124Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document: Terraform Provider Testing Patterns\n\n## Phase 1: Test Infrastructure\n\n- [ ] 1. Create acctest package foundation\n  - File: `internal/provider/acctest/acctest.go`\n  - Implement PreCheck function for router connectivity verification\n  - Implement RandomName helper for unique test resource names\n  - Add provider factory setup for acceptance tests\n  - Purpose: Establish core test infrastructure reused by all acceptance tests\n  - _Leverage: `terraform-plugin-sdk/v2/helper/acctest`, existing provider setup_\n  - _Requirements: 5, 7_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Infrastructure Developer | Task: Create acctest package with PreCheck, RandomName, and provider factory functions as specified in design.md | Restrictions: Do not import production code unnecessarily, follow existing test patterns, ensure PreCheck verifies RTX_HOST and RTX_USER env vars | Success: Package compiles, PreCheck correctly identifies missing prerequisites, RandomName generates unique prefixed names | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 2. Create reusable check functions\n  - File: `internal/provider/acctest/checks.go`\n  - Implement CheckResourceAttrNotEmpty for non-empty attribute verification\n  - Implement CheckNoPlannedChanges wrapper for SDK v2\n  - Implement CheckResourceImportState for import verification\n  - Purpose: Reduce test boilerplate with reusable assertion helpers\n  - _Leverage: `terraform-plugin-sdk/v2/helper/resource`_\n  - _Requirements: 1, 3, 6_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create reusable check functions in acctest/checks.go for common test assertions | Restrictions: Follow terraform-plugin-sdk patterns, return proper TestCheckFunc signatures, handle edge cases gracefully | Success: All check functions compile, work with resource.TestCase, provide clear failure messages | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 3. Create test step builders\n  - File: `internal/provider/acctest/steps.go`\n  - Implement BasicCreateStep for standard resource creation\n  - Implement UpdateStep for update testing\n  - Implement ImportStep for import testing\n  - Implement NoChangeStep for perpetual diff verification\n  - Purpose: Standardize test step construction across all resource tests\n  - _Leverage: `terraform-plugin-sdk/v2/helper/resource`_\n  - _Requirements: 1, 3, 5_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create test step builder functions that return configured resource.TestStep structs | Restrictions: Ensure steps are composable, support optional check functions, follow SDK patterns | Success: Step builders create valid TestStep structs, NoChangeStep correctly verifies empty plans | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 4. Create config builder utilities\n  - File: `internal/provider/acctest/config.go`\n  - Implement ConfigBuilder struct with fluent interface\n  - Add methods for setting resource attributes\n  - Implement Build() to generate valid HCL\n  - Purpose: Generate test configurations programmatically\n  - _Leverage: Standard Go string formatting_\n  - _Requirements: 5, 7_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Developer | Task: Create ConfigBuilder with fluent interface for building HCL test configurations | Restrictions: Generate valid HCL syntax, support all Terraform attribute types, escape special characters properly | Success: ConfigBuilder generates valid HCL, supports nested blocks, handles lists and maps correctly | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 2: State Migration Test Support\n\n- [ ] 5. Create state migration test helpers\n  - File: `internal/provider/acctest/migration.go`\n  - Implement StateMigrationTestCase struct\n  - Implement RunStateMigrationTests function for unit testing upgraders\n  - Add helper for cross-version testing with ExternalProviders\n  - Purpose: Enable systematic testing of state version upgrades\n  - _Leverage: `terraform-plugin-sdk/v2/helper/schema`, `google/go-cmp`_\n  - _Requirements: 8_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create state migration test helpers as specified in design.md section on State Migration Testing | Restrictions: Support multiple schema versions, provide clear diff output on failure, handle nil state gracefully | Success: RunStateMigrationTests correctly validates upgrader functions, failures show clear diffs | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 3: Unit Tests for Test Infrastructure\n\n- [ ] 6. Add unit tests for acctest package\n  - File: `internal/provider/acctest/acctest_test.go`\n  - Test RandomName generates unique names\n  - Test ConfigBuilder produces valid HCL\n  - Test check functions with mock data\n  - Purpose: Ensure test infrastructure itself is reliable\n  - _Leverage: `testing`, `testify/assert`_\n  - _Requirements: 7_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Go Test Developer | Task: Create unit tests for the acctest package functions | Restrictions: Use table-driven tests, test edge cases, do not require external resources | Success: All acctest functions have test coverage, tests pass reliably | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 4: Reference Implementation Tests\n\n- [ ] 7. Create rtx_admin_user perpetual diff test\n  - File: `internal/provider/resource_rtx_admin_user_test.go`\n  - Implement TestAccAdminUser_noDiff following Pattern 1 from design\n  - Verify no changes on re-apply of same config\n  - Purpose: Reference implementation of perpetual diff prevention test\n  - _Leverage: `internal/provider/acctest/`, existing test file if any_\n  - _Requirements: 1_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Test Developer | Task: Create perpetual diff prevention test for rtx_admin_user resource | Restrictions: Use acctest helpers, require TF_ACC flag, clean up test resources | Success: Test passes when resource produces no diff on re-apply, fails if perpetual diff exists | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 8. Create rtx_admin_user import test\n  - File: `internal/provider/resource_rtx_admin_user_test.go`\n  - Implement TestAccAdminUser_import following Pattern 2 from design\n  - Verify import populates all expected attributes\n  - Use ImportStateVerifyIgnore for write-only fields\n  - Purpose: Reference implementation of import test\n  - _Leverage: `internal/provider/acctest/`_\n  - _Requirements: 3_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Test Developer | Task: Create import test for rtx_admin_user resource | Restrictions: Use ImportStep helper, ignore password field in verification, clean up resources | Success: Test passes when import correctly populates state, fails if import is broken | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 9. Create rtx_admin_user Optional+Computed preservation test\n  - File: `internal/provider/resource_rtx_admin_user_test.go`\n  - Implement TestAccAdminUser_preserveAdministrator following Pattern 4 from design\n  - Verify administrator field preserved when not specified in update\n  - Purpose: Regression test for administrator lockout scenario\n  - _Leverage: `internal/provider/acctest/`_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Test Developer | Task: Create Optional+Computed preservation test for administrator field | Restrictions: Test both setting and removing the field from config, verify state values | Success: Test passes when administrator is preserved, fails if reset to default | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 10. Create WriteOnly attribute test for password\n  - File: `internal/provider/resource_rtx_admin_user_test.go`\n  - Implement TestAccAdminUser_passwordHandling following Pattern 5 from design\n  - Verify password is applied but not readable from state\n  - Purpose: Verify sensitive field handling\n  - _Leverage: `internal/provider/acctest/`_\n  - _Requirements: 9_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Test Developer | Task: Create test verifying password field is not stored or is marked sensitive in state | Restrictions: Do not log actual password values, verify behavior not implementation | Success: Test confirms password is handled securely, not exposed in state | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n## Phase 5: Documentation and Expansion\n\n- [ ] 11. Create test pattern documentation\n  - File: `docs/testing-patterns.md`\n  - Document all test patterns with examples\n  - Include decision tree for choosing test types\n  - Add troubleshooting guide for common test failures\n  - Purpose: Enable developers to write consistent tests\n  - _Leverage: Design document examples_\n  - _Requirements: 5, 7_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Create comprehensive testing patterns documentation | Restrictions: Use clear examples, reference actual code, keep it practical | Success: Documentation helps developers write tests correctly, covers all patterns | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 12. Add tests to rtx_admin resource\n  - File: `internal/provider/resource_rtx_admin_test.go`\n  - Apply all test patterns from Phase 4 to rtx_admin\n  - Adapt patterns to resource-specific attributes\n  - Purpose: Expand test coverage to second resource\n  - _Leverage: `internal/provider/acctest/`, rtx_admin_user tests as reference_\n  - _Requirements: 1, 2, 3_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Test Developer | Task: Apply all test patterns to rtx_admin resource | Restrictions: Follow established patterns, adapt to resource specifics, maintain consistency | Success: rtx_admin has comprehensive test coverage matching rtx_admin_user | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n\n- [ ] 13. Audit and add tests to remaining resources\n  - Files: All `internal/provider/resource_*_test.go`\n  - Identify resources lacking test coverage\n  - Apply test patterns to each resource\n  - Purpose: Achieve comprehensive test coverage across provider\n  - _Leverage: `internal/provider/acctest/`, existing tests as reference_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec terraform-provider-testing-patterns, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Terraform Provider Test Developer | Task: Audit all resources and add missing test coverage | Restrictions: Prioritize high-risk resources, maintain pattern consistency, document any resource-specific considerations | Success: All resources have at least basic, import, and no-diff tests | Instructions: Mark task as [-] in tasks.md when starting, use log-implementation tool after completion with detailed artifacts, then mark as [x] when done_\n",
  "fileStats": {
    "size": 13513,
    "lines": 138,
    "lastModified": "2026-01-24T12:17:18.575Z"
  },
  "comments": []
}