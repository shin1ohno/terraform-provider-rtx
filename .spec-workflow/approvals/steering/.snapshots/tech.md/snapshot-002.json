{
  "id": "snapshot_1768816473861_7bbwcxzb4",
  "approvalId": "approval_1768816395100_agu33pawd",
  "approvalTitle": "Update tech.md with Terraform state handling policy",
  "version": 2,
  "timestamp": "2026-01-19T09:54:33.861Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Technology Stack\n\n## Project Type\n\nTerraform Provider plugin for Yamaha RTX series routers. This is a Go-based infrastructure automation tool that integrates with HashiCorp Terraform to enable Infrastructure as Code (IaC) management of network devices.\n\n## Core Technologies\n\n### Primary Language(s)\n- **Language**: Go 1.23\n- **Toolchain**: go1.23.12\n- **Package Management**: Go modules (go.mod/go.sum)\n\n### Key Dependencies/Libraries\n- **terraform-plugin-sdk/v2 v2.37.0**: HashiCorp's SDK for building Terraform providers\n- **terraform-plugin-go v0.27.0**: Low-level Terraform plugin protocol implementation\n- **terraform-plugin-log v0.9.0**: Structured logging for Terraform providers\n- **golang.org/x/crypto**: SSH client implementation for RTX router communication\n- **hcl/v2 v2.23.0**: HashiCorp Configuration Language parser\n- **go-cty v1.16.2**: Type system for Terraform values\n- **stretchr/testify v1.10.0**: Testing utilities and assertions\n\n### Application Architecture\n- **Plugin Architecture**: Implements Terraform's gRPC-based plugin protocol\n- **Resource-Oriented Design**: Each RTX feature maps to Terraform resources/data sources\n- **Parser Registry Pattern**: Centralized parser registration for RTX CLI output parsing\n- **Stateless Communication**: Each operation establishes fresh SSH connection to router\n\n### Data Storage\n- **Primary Storage**: Terraform state file (managed by Terraform core)\n- **Router Storage**: RTX router's persistent configuration memory\n- **Data Format**: HCL for configuration, JSON for state, plain text for RTX CLI\n\n### Terraform State Handling\n- Persist only configuration attributes in Terraform state\n- Do not store operational/runtime status values to avoid perpetual diffs\n\n### External Integrations\n- **Protocols**: SSH for RTX router CLI access\n- **Authentication**: SSH password or public key authentication\n- **Target Device**: Yamaha RTX series routers (RTX810, RTX830, RTX1200, RTX1210, RTX1220, etc.)\n\n## Development Environment\n\n### Build & Development Tools\n- **Build System**: Make + Go build\n- **Package Management**: Go modules\n- **Local Installation**: `make install` deploys to ~/.terraform.d/plugins/\n\n### Code Quality Tools\n- **Static Analysis**: golangci-lint\n- **Formatting**: gofmt, terraform fmt\n- **Testing Framework**: Go testing package + testify\n- **Documentation**: terraform-plugin-docs (tfplugindocs)\n\n### Version Control & Collaboration\n- **VCS**: Git\n- **Branching Strategy**: Feature branches merged to main\n- **Code Review Process**: Pull request based\n\n## Deployment & Distribution\n\n- **Target Platform(s)**: Cross-platform (Linux, macOS, Windows)\n- **Distribution Method**:\n  - Local build via `make install`\n  - Future: Terraform Registry publication\n- **Installation Requirements**:\n  - Terraform >= 1.0\n  - Network access to RTX router via SSH\n- **Update Mechanism**: Terraform provider version constraints\n\n## Technical Requirements & Constraints\n\n### Performance Requirements\n- SSH connection establishment: < 5 seconds\n- Command execution timeout: Configurable, default 30 seconds\n- Concurrent operations: Sequential per router (SSH session limitation)\n\n### Compatibility Requirements\n- **Platform Support**: Linux (amd64, arm64), macOS (amd64, arm64), Windows (amd64)\n- **Terraform Versions**: >= 1.0.0\n- **RTX Firmware**: Tested with Rev.15.x and later\n- **Go Version**: >= 1.23\n\n### Security & Compliance\n- **Security Requirements**:\n  - SSH encryption for all router communication\n  - Credential handling via Terraform's secure variable mechanism\n  - No credential storage in state file\n- **Threat Model**:\n  - Protect router access credentials\n  - Validate all user inputs before sending to router\n  - Prevent command injection in SSH sessions\n\n### Scalability & Reliability\n- **Expected Load**: Single router per provider instance (multi-router via aliases)\n- **Availability Requirements**: Graceful handling of router unreachability\n- **Error Recovery**: Automatic retry with exponential backoff for transient failures\n\n## Technical Decisions & Rationale\n\n### Decision Log\n1. **terraform-plugin-sdk/v2 over plugin-framework**: SDK v2 chosen for mature ecosystem and extensive documentation; migration to framework possible in future\n2. **SSH over Telnet/API**: SSH provides encryption, authentication, and is universally supported on RTX routers; no REST API available on RTX\n3. **Parser Registry Pattern**: Enables modular parsing of different RTX CLI outputs; each feature can register its own parsers\n4. **Stateless SSH Sessions**: Each CRUD operation opens new SSH connection for reliability; connection pooling considered but adds complexity\n\n## Known Limitations\n\n- **Sequential Operations**: SSH sessions are not multiplexed; concurrent operations on same router may conflict\n- **CLI Parsing Fragility**: RTX CLI output format may vary between firmware versions; parsers need version-specific handling\n- **No Transaction Support**: RTX router doesn't support atomic multi-command transactions; partial failures possible\n- **Limited Dry-Run**: `terraform plan` cannot fully validate against router state without actual SSH connection\n",
  "fileStats": {
    "size": 5144,
    "lines": 114,
    "lastModified": "2026-01-19T09:53:05.301Z"
  },
  "comments": []
}