{
  "id": "snapshot_1768816475455_dxyfa8ehl",
  "approvalId": "approval_1768816390800_w2kzw8k6v",
  "approvalTitle": "Update product.md with Terraform state handling principle",
  "version": 3,
  "timestamp": "2026-01-19T09:54:35.455Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Product Overview\n\n## Product Purpose\n\nTerraform Provider for Yamaha RTX series routers enables Infrastructure as Code (IaC) management of enterprise-grade network infrastructure. It provides comprehensive coverage of all RTX router featuresâ€”from basic networking and routing to advanced VPN, security, and QoS configurations. The provider solves the challenge of manually configuring and maintaining RTX router settings by providing declarative, version-controlled, and reproducible network configurations.\n\n## Target Users\n\n- **Network Administrators**: Managing enterprise networks with Yamaha RTX routers\n- **DevOps Engineers**: Integrating network infrastructure into CI/CD pipelines\n- **System Integrators**: Deploying consistent network configurations across multiple sites\n- **IT Teams in Japan**: Primary market where RTX routers are widely deployed\n\n### User Pain Points\n- Manual CLI configuration is error-prone and time-consuming\n- No version control for network configurations\n- Difficult to replicate configurations across environments\n- Lack of automation for network infrastructure changes\n\n## Key Features\n\nThis provider implements comprehensive support for all Yamaha RTX router features:\n\n### Network & Routing\n- **IP Configuration**: IP addresses, routing tables, static routes, policy routing\n- **OSPF/OSPFv3**: Dynamic routing with OSPF for IPv4 and IPv6\n- **BGP**: Border Gateway Protocol configuration and peer management\n- **IPv6**: Full IPv6 support including addressing and routing\n\n### Network Services\n- **DHCP**: Scopes, static bindings, relay, and advanced options\n- **DNS**: DNS server, resolver, and forwarding configuration\n- **NAT/NAPT**: Network address translation rules and mappings\n- **NAT46/DNS46**: IPv4-IPv6 translation mechanisms\n\n### VPN & Tunneling\n- **IPsec**: IKE/IPsec VPN tunnels with full parameter control\n- **L2TP**: Layer 2 Tunneling Protocol configuration\n- **PPTP**: Point-to-Point Tunneling Protocol\n- **IPIP Tunneling**: IP-in-IP encapsulation\n- **Cloud VPN**: Integration with cloud service VPN connections\n\n### Security & Filtering\n- **Ethernet Filters**: Layer 2 packet filtering\n- **IP Filters**: Layer 3/4 packet filtering and firewall rules\n- **URL Filters**: Web content filtering\n\n### Quality of Service\n- **QoS/Traffic Shaping**: Priority control and bandwidth management\n- **DPI**: Deep Packet Inspection configuration\n\n### Interfaces & Connectivity\n- **VLAN**: Virtual LAN configuration\n- **Bridge Interface**: Layer 2 bridging\n- **Flexible LAN/WAN Ports**: Port role assignment\n- **PPP/PPPoE**: Point-to-Point Protocol configuration\n- **Mobile Internet**: Mobile broadband connectivity\n- **ISDN/PRI**: Legacy connectivity options\n\n### Monitoring & Management\n- **SNMP**: SNMP agent and trap configuration\n- **RADIUS**: Authentication server integration\n- **SIP**: VoIP/SIP functionality\n- **Logging**: Syslog and logging configuration\n- **Statistics**: Traffic and performance statistics\n- **Diagnostics**: Network diagnostic tools\n\n### Automation & Integration\n- **Schedules**: Time-based automation rules\n- **Email Notifications**: Trigger-based alerts\n- **HTTP Server**: Built-in web server configuration\n- **Lua Scripts**: Custom scripting support\n- **UPnP**: Universal Plug and Play settings\n- **L2MS/YNO**: Yamaha Network Organizer integration\n\n### System Management\n- **Configuration Persistence**: Automatic saving to persistent memory\n- **Import Support**: Import existing configurations into Terraform state\n- **USB/External Memory**: External storage configuration\n- **NetVolante DNS**: Dynamic DNS service integration\n\n## Business Objectives\n\n- Enable complete IaC management of Yamaha RTX router configurations\n- Reduce configuration errors through declarative definitions and validation\n- Support enterprise deployment patterns with proper state management\n- Provide seamless integration with existing Terraform workflows\n\n## Success Metrics\n\n- **Test Coverage**: Comprehensive unit and acceptance tests for all resources\n- **Documentation**: Complete schema documentation and usage examples\n- **Reliability**: Stable SSH connections and proper error handling\n- **Adoption**: Usage in production environments for RTX router management\n\n## Product Principles\n\n1. **Cisco-Compatible Syntax**: Align resource and attribute naming with Cisco IOS XE Terraform provider (`CiscoDevNet/iosxe`) conventions wherever possible. This enables network administrators to manage both Cisco and RTX devices with minimal learning curve and consistent Terraform configurations.\n2. **Follow RTX CLI Semantics**: Where Cisco conventions don't apply, mirror RTX router terminology for familiarity\n3. **Fail Safely**: Validate configurations before applying; provide clear error messages\n4. **Leverage Existing Patterns**: Reuse established Terraform provider conventions and Go SSH infrastructure\n5. **Minimal Scope**: Only implement features that provide clear value for IaC management\n6. **State Clarity**: Persist only configuration in Terraform state; do not store operational/runtime status to avoid perpetual diffs\n\n## API Design Philosophy: Cisco Compatibility\n\nTo maximize interoperability and reduce cognitive load for network engineers, this provider follows Cisco IOS XE Terraform provider naming conventions:\n\n### Resource Naming\n| RTX Resource | Cisco Equivalent | Pattern |\n|--------------|------------------|---------|\n| `rtx_static_route` | `iosxe_static_route` | `<provider>_static_route` |\n| `rtx_ospf` | `iosxe_ospf` | `<provider>_ospf` |\n| `rtx_bgp` | `iosxe_bgp` | `<provider>_bgp` |\n| `rtx_vlan` | `iosxe_vlan` | `<provider>_vlan` |\n| `rtx_nat` | `iosxe_nat` | `<provider>_nat` |\n| `rtx_access_list` | `iosxe_access_list_extended` | `<provider>_access_list*` |\n| `rtx_interface` | `iosxe_interface_ethernet` | `<provider>_interface*` |\n\n### Attribute Naming Conventions\n| Attribute | Example | Notes |\n|-----------|---------|-------|\n| `process_id` | OSPF process ID | Not just `id` |\n| `router_id` | OSPF/BGP router ID | Dotted decimal format |\n| `asn` | BGP AS number | String for 4-byte ASN support |\n| `vlan_id` | VLAN identifier | Integer 1-4094 |\n| `prefix` / `mask` | Route destination | Separate prefix and mask |\n| `next_hops` | Route next hops | List of objects |\n| `networks` | OSPF/BGP networks | List of network objects |\n| `neighbors` | Routing neighbors | List of neighbor objects |\n| `entries` | ACL/filter rules | List of rule entries |\n| `shutdown` | Admin state | Boolean, true = disabled |\n\n### Nested Block Patterns\n```hcl\n# Cisco-style nested blocks for RTX\nresource \"rtx_ospf\" \"backbone\" {\n  process_id = 1\n  router_id  = \"1.1.1.1\"\n\n  networks = [\n    {\n      ip       = \"10.0.0.0\"\n      wildcard = \"0.0.0.255\"\n      area     = \"0\"\n    }\n  ]\n\n  neighbors = [\n    {\n      ip       = \"2.2.2.2\"\n      priority = 10\n      cost     = 100\n    }\n  ]\n}\n\nresource \"rtx_static_route\" \"default\" {\n  prefix = \"0.0.0.0\"\n  mask   = \"0.0.0.0\"\n\n  next_hops = [\n    {\n      next_hop = \"192.168.1.1\"\n      distance = 10\n      name     = \"primary_gateway\"\n    }\n  ]\n}\n```\n\n### Benefits of Cisco Compatibility\n- **Unified Workflow**: Manage Cisco and RTX devices with similar Terraform configurations\n- **Transferable Knowledge**: Skills learned on one provider apply to the other\n- **Copy-Paste Friendly**: Easier migration of configurations between vendors\n- **Reduced Errors**: Consistent naming reduces configuration mistakes\n\n## Monitoring & Visibility\n\n- **CLI-based**: Standard Terraform CLI output and logging\n- **Debug Logging**: TF_LOG environment variable for detailed operation tracing\n- **State File**: Terraform state tracks all managed resources\n- **Plan Output**: Clear diff visualization before applying changes\n\n## Future Vision\n\n### Potential Enhancements\n- **Multi-Router Support**: Manage multiple RTX routers from a single configuration\n- **Configuration Backup**: Export and restore complete router configurations\n- **Configuration Diff**: Compare running and saved configurations\n- **Cluster Support**: HA/failover cluster management\n- **Terraform Cloud Integration**: Remote state and collaboration features\n- **Provider Versioning**: Compatibility across different RTX firmware versions\n",
  "fileStats": {
    "size": 8202,
    "lines": 194,
    "lastModified": "2026-01-19T09:52:59.513Z"
  },
  "comments": []
}