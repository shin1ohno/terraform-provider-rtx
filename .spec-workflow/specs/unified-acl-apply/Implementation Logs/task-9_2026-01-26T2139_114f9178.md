# Implementation Log: Task 9

**Summary:** Completely redesigned rtx_access_list_ip from an individual filter resource (using sequence as ID) to a group-based resource (using name as ID). Added entry blocks for multiple filters, apply blocks for interface bindings, and sequence_start/sequence_step for automatic sequence calculation.

**Timestamp:** 2026-01-26T21:39:43.916Z
**Log ID:** 114f9178-f183-4444-a580-1dcf5331e121

---

## Statistics

- **Lines Added:** +625
- **Lines Removed:** -311
- **Files Changed:** 1
- **Net Change:** 314

## Files Modified
- internal/provider/resource_rtx_access_list_ip.go

## Files Created
_No files created_

---

## Artifacts

### Components

#### resourceRTXAccessListIP
- **Type:** Terraform Resource
- **Purpose:** Group-based IP access list resource managing multiple IP filter entries under a single name identifier with automatic or manual sequence numbering and interface apply blocks
- **Location:** internal/provider/resource_rtx_access_list_ip.go:21
- **Props:** name (required, ForceNew), sequence_start (optional), sequence_step (optional, default 10), apply (optional list), entry (required list)
- **Exports:** resourceRTXAccessListIP()

### Functions

#### validateAccessListIPEntries
- **Purpose:** CustomizeDiff validation for IP filter entry constraints (established only for TCP, ports only for TCP/UDP)
- **Location:** internal/provider/resource_rtx_access_list_ip.go:138
- **Signature:** (ctx context.Context, diff *schema.ResourceDiff, meta interface{}) error
- **Exported:** No

#### resourceRTXAccessListIPCreate
- **Purpose:** Create handler for the group resource - creates all IP filter entries and applies to interfaces
- **Location:** internal/provider/resource_rtx_access_list_ip.go:168
- **Signature:** (ctx context.Context, d *schema.ResourceData, meta interface{}) diag.Diagnostics
- **Exported:** No

#### resourceRTXAccessListIPRead
- **Purpose:** Read handler - reads all filter entries by their sequences and updates state
- **Location:** internal/provider/resource_rtx_access_list_ip.go:196
- **Signature:** (ctx context.Context, d *schema.ResourceData, meta interface{}) diag.Diagnostics
- **Exported:** No

#### resourceRTXAccessListIPUpdate
- **Purpose:** Update handler - handles entry changes and apply block changes, deletes removed sequences
- **Location:** internal/provider/resource_rtx_access_list_ip.go:261
- **Signature:** (ctx context.Context, d *schema.ResourceData, meta interface{}) diag.Diagnostics
- **Exported:** No

#### resourceRTXAccessListIPDelete
- **Purpose:** Delete handler - removes apply blocks first, then deletes all filter entries
- **Location:** internal/provider/resource_rtx_access_list_ip.go:330
- **Signature:** (ctx context.Context, d *schema.ResourceData, meta interface{}) diag.Diagnostics
- **Exported:** No

#### resourceRTXAccessListIPImport
- **Purpose:** Import handler - supports format name:seq1,seq2,seq3 to import specific filter sequences
- **Location:** internal/provider/resource_rtx_access_list_ip.go:368
- **Signature:** (ctx context.Context, d *schema.ResourceData, meta interface{}) ([]*schema.ResourceData, error)
- **Exported:** No

#### buildIPFiltersFromResourceData
- **Purpose:** Builds client.IPFilter structs from Terraform resource data, handling auto/manual sequence mode
- **Location:** internal/provider/resource_rtx_access_list_ip.go:435
- **Signature:** (d *schema.ResourceData) []client.IPFilter
- **Exported:** No

#### getIPExpectedSequences
- **Purpose:** Returns expected sequence numbers based on current state (auto or manual mode)
- **Location:** internal/provider/resource_rtx_access_list_ip.go:476
- **Signature:** (d *schema.ResourceData) []int
- **Exported:** No

#### applyIPFiltersToInterfacesFromResourceData
- **Purpose:** Handles apply blocks during create - applies filters to interfaces
- **Location:** internal/provider/resource_rtx_access_list_ip.go:505
- **Signature:** (ctx context.Context, d *schema.ResourceData, apiClient *apiClient) error
- **Exported:** No

#### readIPApplyBlocksFromRouter
- **Purpose:** Reads apply block state from the router for state refresh
- **Location:** internal/provider/resource_rtx_access_list_ip.go:528
- **Signature:** (ctx context.Context, d *schema.ResourceData, apiClient *apiClient) error
- **Exported:** No

#### extractIPFilterIDsFromApply
- **Purpose:** Extracts filter IDs from apply map, falling back to entry sequences if not specified
- **Location:** internal/provider/resource_rtx_access_list_ip.go:559
- **Signature:** (applyMap map[string]interface{}, d *schema.ResourceData) []int
- **Exported:** No

#### extractIPSequencesFromEntryList
- **Purpose:** Extracts sequences from an entry list for change detection
- **Location:** internal/provider/resource_rtx_access_list_ip.go:573
- **Signature:** (entries []interface{}, d *schema.ResourceData) []int
- **Exported:** No

#### findIPRemovedSequences
- **Purpose:** Finds sequences that were in old list but not in new list for deletion
- **Location:** internal/provider/resource_rtx_access_list_ip.go:601
- **Signature:** (old, new []int) []int
- **Exported:** No

#### normalizePort
- **Purpose:** Converts empty or missing port to * for consistent state representation
- **Location:** internal/provider/resource_rtx_access_list_ip.go:618
- **Signature:** (port string) string
- **Exported:** No

### Integrations

#### Integration
- **Description:** Resource uses existing Client interface methods for IP filter CRUD operations
- **Frontend Component:** resourceRTXAccessListIP
- **Backend Endpoint:** client.CreateIPFilter, client.GetIPFilter, client.UpdateIPFilter, client.DeleteIPFilter
- **Data Flow:** TF config -> buildIPFiltersFromResourceData -> client.CreateIPFilter -> Router SSH -> SaveConfig

#### Integration
- **Description:** Resource uses existing Client interface methods for interface apply operations
- **Frontend Component:** resourceRTXAccessListIP (apply blocks)
- **Backend Endpoint:** client.ApplyIPFiltersToInterface, client.GetIPInterfaceFilters, client.RemoveIPFiltersFromInterface
- **Data Flow:** TF apply block -> extractIPFilterIDsFromApply -> client.ApplyIPFiltersToInterface -> Router SSH

#### Integration
- **Description:** Resource uses CommonApplySchema from acl_schema_common.go for apply block schema
- **Frontend Component:** resourceRTXAccessListIP schema
- **Backend Endpoint:** N/A (schema definition)
- **Data Flow:** CommonApplySchema() returns schema.Resource for apply blocks

#### Integration
- **Description:** Resource uses ValidateACLSchema from acl_schema_common.go for auto/manual mode validation
- **Frontend Component:** resourceRTXAccessListIP CustomizeDiff
- **Backend Endpoint:** N/A (validation)
- **Data Flow:** CustomizeDiff -> ValidateACLSchema -> validates sequence mode consistency

