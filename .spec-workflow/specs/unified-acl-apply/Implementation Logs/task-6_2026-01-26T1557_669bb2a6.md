# Implementation Log: Task 6

**Summary:** Created ACL apply service for managing filter-to-interface bindings with command mapping for different ACL types (ip, ipv6, mac)

**Timestamp:** 2026-01-26T15:57:29.818Z
**Log ID:** 669bb2a6-965c-4920-a8be-41477757d59d

---

## Statistics

- **Lines Added:** +420
- **Lines Removed:** -4
- **Files Changed:** 2
- **Net Change:** 416

## Files Modified
- internal/client/acl_service.go

## Files Created
- internal/client/acl_apply_service.go

---

## Artifacts

### Functions

#### NewACLApplyService
- **Purpose:** Factory function to create new ACLApplyService instance
- **Location:** internal/client/acl_apply_service.go:18
- **Signature:** (executor Executor, client *rtxClient) *ACLApplyService
- **Exported:** Yes

#### ApplyFiltersToInterface
- **Purpose:** Binds filter sequences to an interface using command mapping per ACL type (ip: ip secure filter, ipv6: ipv6 secure filter, mac: ethernet filter)
- **Location:** internal/client/acl_apply_service.go:31
- **Signature:** (ctx context.Context, iface, direction string, aclType ACLType, filterIDs []int) error
- **Exported:** Yes

#### RemoveFiltersFromInterface
- **Purpose:** Removes filter bindings from an interface, gracefully handles 'not found' errors
- **Location:** internal/client/acl_apply_service.go:88
- **Signature:** (ctx context.Context, iface, direction string, aclType ACLType) error
- **Exported:** Yes

#### GetInterfaceFilters
- **Purpose:** Reads current filter bindings for a specific interface and direction
- **Location:** internal/client/acl_apply_service.go:144
- **Signature:** (ctx context.Context, iface, direction string, aclType ACLType) ([]int, error)
- **Exported:** Yes

#### ValidateInterface
- **Purpose:** Validates interface name format and ACL type compatibility (e.g., MAC filters not allowed on PP interfaces)
- **Location:** internal/client/acl_apply_service.go:206
- **Signature:** (ctx context.Context, iface string, aclType ACLType) error
- **Exported:** Yes

#### ApplyFiltersToInterfaceWithDynamic
- **Purpose:** Applies both static and dynamic filters to an interface in a single command
- **Location:** internal/client/acl_apply_service.go:305
- **Signature:** (ctx context.Context, iface, direction string, aclType ACLType, staticFilterIDs, dynamicFilterIDs []int) error
- **Exported:** Yes

#### GetAllInterfaceFiltersForType
- **Purpose:** Retrieves all interface filter bindings for a specific ACL type
- **Location:** internal/client/acl_apply_service.go:370
- **Signature:** (ctx context.Context, aclType ACLType) (map[string]map[string][]int, error)
- **Exported:** Yes

#### getInterfaceType
- **Purpose:** Helper to extract interface type prefix (lan, pp, bridge, tunnel) from interface name
- **Location:** internal/client/acl_apply_service.go:286
- **Signature:** (iface string) string
- **Exported:** No

### Classes

#### ACLApplyService
- **Purpose:** Service for managing ACL filter bindings to interfaces, supporting IP, IPv6, and MAC filter types with command mapping
- **Location:** internal/client/acl_apply_service.go:12
- **Methods:** ApplyFiltersToInterface, RemoveFiltersFromInterface, GetInterfaceFilters, ValidateInterface, ApplyFiltersToInterfaceWithDynamic, GetAllInterfaceFiltersForType
- **Exported:** Yes

### Integrations

#### Integration
- **Description:** ACLApplyService uses parsers package for building RTX commands and parsing show config output
- **Frontend Component:** ACLApplyService
- **Backend Endpoint:** parsers.BuildInterfaceSecureFilterCommand, parsers.BuildInterfaceIPv6SecureFilterCommand, parsers.BuildInterfaceEthernetFilterCommand
- **Data Flow:** ACLApplyService.ApplyFiltersToInterface() -> parser builds command -> Executor.Run() -> router executes -> SaveConfig()

#### Integration
- **Description:** ACLApplyService shares ACLType constants with ACLService for consistent type handling
- **Frontend Component:** ACLApplyService
- **Backend Endpoint:** ACLService constants (ACLTypeIP, ACLTypeIPv6, ACLTypeMAC, etc.)
- **Data Flow:** Both services use same ACLType enum defined in acl_service.go

